# 『メモリ』

（最終更新： 2023-01-15）


## 目次

1. [メモリ](#メモリ)
1. [記憶階層](#記憶階層)
1. [主記憶装置の種類](#主記憶装置の種類)
	1. [RAM](#ram)
	1. [ROM](#rom)
1. [メモリの誤り検出と訂正](#メモリの誤り検出と訂正)
1. [キャッシュメモリ](#キャッシュメモリ)
	1. [ヒット率](#ヒット率)
	1. [実行アクセス時間](#実行アクセス時間)
	1. [ダイレクトマップ方式](#ダイレクトマップ方式)
	1. [フルアソシアティブ方式](#フルアソシアティブ方式)
	1. [セットアソシアティブ方式](#セットアソシアティブ方式)
	1. [ライトスルー方式](#ライトスルー方式)
	1. [ライトバック方式](#ライトバック方式)
1. [メモリインタリーブ](#メモリインタリーブ)
1. [記憶領域の管理方式](#記憶領域の管理方式)
	1. [ファーストフィット方式](#ファーストフィット方式)
	1. [ベストフィット方式](#ベストフィット方式)


## メモリ

**メモリ**とは、コンピュータ上でデータを保持しておくための記憶装置。


## 記憶階層

**記憶階層**とは、速度や容量の異なる複数の記憶装置を階層的に組み合わせることで、全体として効率の良い記憶システムを構築したもの。それぞれの記憶装置の間に**緩急記憶装置**を置くことで、各装置の速度ギャップを埋めることができる。

記憶階層は速度が早いものから順に、レジスタ、主記憶装置、補助記憶装置となっている。また緩急記憶装置として、レジスタと主記憶装置の間に[キャッシュメモリ](#キャッシュメモリ)、主記憶装置と補助記憶装置の間にディスクキャッシュがある。


## 主記憶装置の種類

### RAM

**RAM**(Random Access Memory)とは、読み書きが可能なメモリ。電源の供給がなくなると内容が消えてしまうという性質から、**揮発性メモリ**とも呼ばれる。

**DRAM**(Dynamic RAM)とは、一定時間たつとデータが消失してしまうという性質を持っており、低速で高消費電力である代わりに、安価で大容量である。1ビットの情報を記憶するメモリセルが、コンデンサとトランジスタで構成されている。また、放置しておくと自然に放電してしまうため、一定時間間隔でコンデンサを再充電する**リフレッシュ動作**が必要となる。現在ではほとんどの場合、システムのバスと同期して動作する**SDRAM**(Synchronous DRAM)となっている。

**SRAM**(Static RAM)とは、電源を切らない限り内容を保持し続けるという性質を持っており、高速で低消費電力である代わりに、高価で少容量である。レジスタやキャッシュメモリとして用いられる。1ビットの情報を記憶するメモリセルが、フリップフロップ回路で構成される。DRAMのようなリフレッシュ動作は不要。

### ROM

**ROM**(Read Only Memory)とは、読み出し専用のメモリ。種類によっては全消去や書き込み、追記が可能なものもある。電源の供給がなくても記憶を保持することが可能であるという性質から、**不揮発性メモリ**とも呼ばれる。

**マスクROM**は、出荷時にデータが書き込まれており、内容の変更ができないROM。

**PROM**(Programmable ROM)は、特殊な装置により一度だけ書き込むことができるが、一度書き込んだものを消去できない。基本的に読み出し専用であり、RAMに比べると書き込みには時間がかかる。また、PROMの中でも**EPROM**は紫外線照射により内容の消去が可能で、再書き込みも可能。**EEPROM**は電気的にバイト単位での内容の書き換えが可能なもので、BIOSや電子機器の制御プログラム格納のために使用される。

**フラッシュメモリ**は、ブロック単位もしくは一括での大容量のデータの消去や書き込みができるように最適化されたROM。USBメモリやSSDに利用されているが、本来はROMであるため、何度も書き換えを行うと劣化してしまう。


## メモリの誤り検出と訂正

メモリが持つ誤り検出や訂正の方法としては、[パリティ](../../../../basics/communication_theory/_/chapters/transmission_theory.md#パリティ)や**ECC**(Error Correcting Code)（[ハミング符号](../../../../basics/communication_theory/_/chapters/transmission_theory.md#ハミング符号)を用いた信頼性の高いエラー訂正機構）、[CRC](../../../../basics/communication_theory/_/chapters/transmission_theory.md#crc)などが用いられる。


## キャッシュメモリ

**キャッシュメモリ**とは、プロセッサとメモリの性能差を埋めるために両者の間で用いられるメモリ。直近に使用したデータをキャッシュメモリに一時的に蓄えておくことで、同じデータを再利用したい場合に高速で読み出すことができるようになる。これは、プログラムは最近アクセスした命令やデータに再度アクセスすることが多い、という**プログラムの局所性**を利用している。

高速である必要があり、CPUのチップに内蔵されることが一般的。また、キャッシュメモリを多段構成にして、CPUから近い順に**1次キャッシュ**、**2次キャッシュ**とするものもある。

### ヒット率

**ヒット率**とは、キャッシュメモリを用いてCPUとメモリがやり取りをするときに、データがキャッシュメモリ上にある確率のこと。ヒット率が高いほどキャッシュメモリが使用される確率が高く、高速な処理が可能となる。

一方で、呼び出したいデータがキャッシュメモリ上に無い確率を**NFP**(Not Found Probability)という。

### 実行アクセス時間

**実行アクセス時間**（**平均メモリアクセス時間**）とは、キャッシュメモリにデータが存在する場合と存在しない場合を含めた平均的なデータへのアクセス時間を求めることができる。

```math
実行アクセス時間 = キャッシュメモリへのアクセス時間 \times ヒット率 + メモリへのアクセス時間 \times (1 - ヒット率)
```

### ダイレクトマップ方式

**ダイレクトマップ方式**とはキャッシュメモリにおけるデータの格納方法のひとつで、メモリのアドレスごとにキャッシュメモリの格納場所がひとつに決まる。データの検索が高速であるが、衝突が起こりやすくなりヒット率が下がる。

### フルアソシアティブ方式

**フルアソシアティブ方式**とはキャッシュメモリにおけるデータの格納方法のひとつで、キャッシュメモリの空いているブロックにメモリのデータを格納する。衝突は少ないものの、データの使用時に毎回検索が必要になるので低速。

**連想メモリ**(**CAM**: Content Addressable Memory)を使用することで検索を高速化している。

### セットアソシアティブ方式

**セットアソシアティブ方式**とはキャッシュメモリにおけるデータの格納方法のひとつで、キャッシュメモリを複数のグループに分け、そのグループ内ならどこでも使えるようにしたもの。

フルアソシアティブ方式と同様[連想メモリ](#フルアソシアティブ方式)によって検索を高速化している。

### ライトスルー方式

**ライトスルー方式**とはキャッシュメモリにおけるデータの更新方法のひとつで、プロセッサがキャシュメモリに書き込みを行った場合に、同時にメモリにもその内容を転送する。スループットは下がるが、**コヒーレント**（データの一貫性）は保たれる。

### ライトバック方式

**ライトバック方式**とはキャッシュメモリにおけるデータの更新方法のひとつで、プロセッサがキャシュメモリに書き込みを行った場合に、すぐにはメモリにその内容を転送しない。条件を満たした場合にのみメモリに書き込まれるため、スループットは上がるが、コヒーレントが保たれないことがある。


## メモリインタリーブ

**メモリインタリーブ**とは、CPUとメモリのデータ転送を高速化するための技術のひとつで、データを複数の**メモリバンク**に順番に分割して配置しておく方法。データを読み出すときに複数のメモリバンクにほぼ同時にアクセスすることで、効率よくデータを取り出すことができる。


## 記憶領域の管理方式

### ファーストフィット方式

**ファーストフィット方式**とは記憶領域を管理するアルゴリズムのひとつで、記憶領域の空き領域をアドレスの下位から順番に検索して最初に見つかった空き領域を割り当てる。

### ベストフィット方式

**ベストフィット方式**とは記憶領域を管理するアルゴリズムのひとつで、空き領域のうち要求されたサイズを満たす最小のものを割り当てる。


## 参考文献

- [角谷一成.令和05年 基本情報技術者合格教本.株式会社技術評論社, 2022, 575](https://gihyo.jp/book/2022/978-4-297-13164-7)
- [瀬戸美月.徹底攻略 応用情報技術者教科書 令和4年度.株式会社インプレス, 2021, 814](https://book.impress.co.jp/books/1121101057)
