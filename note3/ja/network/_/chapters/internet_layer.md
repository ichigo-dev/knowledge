# 『インターネット層』

（最終更新： 2023-02-06）


## 目次

1. [IP](#ip)
	1. [データグラム](#データグラム)
1. [IPアドレス](#ipアドレス)
	1. [ネットワーク部](#ネットワーク部)
	1. [ホスト部](#ホスト部)
	1. [ネットワークアドレス](#ネットワークアドレス)
	1. [ブロードキャストアドレス](#ブロードキャストアドレス)
	1. [クラス](#クラス)
	1. [IPマルチキャスト](#ipマルチキャスト)
	1. [サブネットワーク](#サブネットワーク)
	1. [サブネットマスク](#サブネットマスク)
	1. [CIDR](#cidr)
	1. [グローバルIPアドレス](#グローバルipアドレス)
	1. [プライベートIPアドレス](#プライベートipアドレス)
	1. [WHOIS](#whois)
	1. [ループバックアドレス](#ループバックアドレス)
1. [ルーティング](#ルーティング)
	1. [ホップ](#ホップ)
	1. [ルーティングテーブル](#ルーティングテーブル)
	1. [スタティックルーティング](#スタティックルーティング)
	1. [ダイナミックルーティング](#ダイナミックルーティング)
	1. [ホップバイホップルーティング](#ホップバイホップルーティング)
	1. [アドホック](#アドホック)
1. [フラグメンテーション](#フラグメンテーション)
	1. [最大転送単位](#最大転送単位)
	1. [経路MTU探索](#経路mtu探索)

1. [エニキャスト]()


## IP

**IP**(Internet Protocol)は、TCP/IPのインターネット層における代表的なプロトコル。エンドツーエンドの通信を実現する役割を果たす。データリンクが1区間のノードを結ぶプロトコルを持っているのに対して、IPは最終目的地までの通信を実現するためのプロトコル。

### データグラム

**データグラム**は、インターネット層におけるデータのまとまりのこと。


## IPアドレス

**IPアドレス**は、個々のホストを特定するための識別子で、32ビットの整数値で表される。人間がわかりやすいように8ビットずつに区切り、境目にドットを入れた**ドット・デシマル・ノーテーション**の記法がよく用いられる。

### ネットワーク部

**ネットワーク部**は、IPアドレス中でデータリンクのセグメントごとに割り当てられた固有の値。世界中のネットワークからどのネットワークセグメントであるかを特定するために用いられる。

### ホスト部

**ホスト部**は、データリンクが属するセグメント内で、各機器に割り当てられた固有の値。セグメント内のホストを特定するために用いられる。

### ネットワークアドレス

**ネットワークアドレス**は、IPアドレスのホスト部をすべて0にしたアドレスで、そのセグメントのネットワーク自体を表す。

### ブロードキャストアドレス

**ブロードキャストアドレス**は、ホスト部をすべて1とし、そのネットワークに属しているすべてのホストにパケットを送信するためのアドレス。そのコンピュータ自身が属しているセグメント内へのブロードキャストを**ローカルブロードキャスト**、異なるIPネットワークへのブロードキャストを**ダイレクトブロードキャスト**という。

### クラス

**クラス**は、IPアドレスのネットワーク部とホスト部を識別するために用いられていた概念。IPアドレスをクラスA〜クラスDの4つのグループに分類し、IPアドレスの先頭ビットをクラスの判別のために用いていた。

クラスDはIPマルチキャスト通信に使われていたため、実際にホストに割り当てられてはいない。

また、クラス単位でのIPアドレスの割当は、利用されないアドレスが発生しやすく、限られたアドレス空間を有効に利用できないため、CIDR方式を用いるのが一般的。

### IPマルチキャスト

**IPマルチキャスト**は、特定のグループに属するすべてのホストにパケットを送信するために利用される方法で、クラスDのIPアドレスが用いられる。

### サブネットワーク

**サブネットワーク**は、クラスで区切られたネットワーク空間をさらに細かいネットワークに分割したもの。クラスを用いた方法よりも柔軟に接続可能なホストの台数を制御できる。

### サブネットマスク

**サブネットマスク**は、IPアドレスのネットワーク部とホスト部を識別するために用いるアドレス。ネットワーク部がすべて1、ホスト部がすべて0のアドレスとなっており、IPアドレスに対してマスクする（論理積を取る）ことでそれぞれの部分を抽出することができる。

先頭から何ビットがネットワーク部であるか（サブネットマスクが1であるビット数）は、 `172.10.0.1/32` のようにIPアドレスの末尾に付けて表現される。

### CIDR

**CIDR**(Classless InterDomain Routing)は、サブネットマスクによってネットワーク部の長さを識別する方式。これにより、ネットワークアドレスの長さを固定せずに分割して扱えるため、各組織に余分なIPアドレス空間を割り当てることを防げる。

### グローバルIPアドレス

**グローバルIPアドレス**は、ネットワークに接続された機器に割り当てられているIPアドレス。グローバルIPアドレスの割り当ては、**ICANN**(Internet Corporation for Assigned Names and Numbers)で一元管理されており、日本国内では**JPNIC**(Japan Network Information Center)がグローバルIPアドレスの割り当てを行っている。

### プライベートIPアドレス

**プライベートIPアドレス**は、ネットワークに直接接続されない、組織内などで固有のIPアドレス。インターネットに接続するための**ブロードバンドルータ**にグローバルIPアドレスを割り当て、組織内の機器はルータを介して接続するといった運用が一般的。

### WHOIS

**WHOIS**は、IPアドレスを管理している組織や管理者の連絡先情報。インターネットの通信経路の途中で異常が発生している装置を突き止める目的などで設定する。

### ループバックアドレス

**ループバックアドレス**は、同じコンピュータ内部のプログラム間で通信したい場合などに利用される、その機器自身を表すアドレス。どの機器にも固定で `127.0.0.1` が割り当てられており、 `localhost` というホスト名がエイリアスとして利用される。


## ルーティング

**ルーティング**（**経路制御**）は、宛先IPアドレスのホストまでパケットを届けるための仕組み。宛先のホストまでパケットを届けるために、すべてのホストやルータは経路制御表という情報を持っている。

### ホップ

**ホップ**は、TCP/IPにおいてネットワークの区間をIPパケットが移動する際の単位。1区間のことを**1ホップ**（**ワンホップ**）という。

### ルーティングテーブル

**ルーティングテーブル**（**経路制御表**）は、経路制御においてパケットを宛先に届けるための、ホスト機器への経路情報が書かれた表。すべての経路情報を持つことは難しいため、登録されていないアドレスをルーティングスルための**デフォルトルート**を設定する。

### スタティックルーティング

**スタティックルーティング**（静的経路制御）は、管理者が事前にホストの情報をルーティングテーブルに設定する方法。

### ダイナミックルーティング

**ダイナミックルーティング**（動的経路制御）は、他のルータとの情報交換によって自動的にルーティングテーブルの情報を更新する方法。IP自体には経路情報を交換するための機能は備わっていないため、ダイナミックルーティングを行うためには専用のルーティングプロトコルが必要になる。

### ホップバイホップルーティング

**ホップバイホップルーティング**は、IPにおける経路制御の方法で、経路制御表に宛先の情報がなかった場合、次のホストが無計画に決定される。パケットが行き当たりばったり（アドホック）に移動する様子からこのように呼ばれる。

### アドホック

**アドホック**は、パケットが通信経路上を無計画に移動すること。


## フラグメンテーション

**フラグメンテーション**（**分割処理**）は、データリンクにおける最大転送単位の差異を吸収するために、IPによってパケットを分割する処理。パケットはルータを経由するたびにこの処理が行われるため、徐々に小さなデータグラムに分割されていく。一方で、データグラムの再構築は、終点ノードのホストでのみ行われる。

経路中でフラグメンテーションを行うと、分割された小さなデータの一部が失われただけで全体の情報を再送する必要がある。そのため、送信元ホストで事前に経路上のMTUに分割してパケットを送信するための、最大MTU探索が行われることが多い。

### 最大転送単位

**最大転送単位**（**MTU**: Maximum Transmission Unit）は、データリンクにおいて機器が一度に転送できる最大パケットサイズ。

### 経路MTU探索

**経路MTU探索**は、ICMPの到達不能メッセージを利用して、送信元ホストから宛先ホストまでの経路におけるMTUの大きさにデータを分割してからパケットを送信する方法。これにより、フラグメンテーションの発生を防ぎながら最大効率でパケットを送信することができるようになる。
