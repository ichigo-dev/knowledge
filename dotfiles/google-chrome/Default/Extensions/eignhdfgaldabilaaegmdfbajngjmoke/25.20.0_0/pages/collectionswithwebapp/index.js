"use strict";cjce.registerTemplate("bm-p-collectionswithwebapp",function(r,d){var e=cjBasics.uniqueId.generate(),c="0"===d.account.authuser?null:d.account.authuser,n="https://www.google.com",t=n+"/collections",i={bm_cid:"collectionswithwebapp",bm_iid:e,bm_wiz:"1",bm_cst:"1",authuser:c,pageId:d.account.pageId,hl:cjBasics.lang.current},a=[],l=(c&&a.push("authuser="+c),d.account.pageId&&a.push("pageId="+d.account.pageId),0<a.length?"?"+a.join("&"):""),o="https://save-pa.googleapis.com/$rpc/google.search.platform.save.v2.SaveService/",m=!0,s={home:{id:"home",iconName:"__mdi:home",label:cjBasics.lang.i18n("cj_i18n_00291","Home"),shortcutId:"359",divider:!0},relatedHeader:{header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_01539","Related apps")},search:{iconName:"__mdi:search",label:cjBasics.lang.i18n("cj_i18n_01365","Google Search"),shortcutId:"157"},maps:{label:cjBasics.lang.i18n("cj_i18n_01364","Google Maps"),iconName:"__mdi:place",shortcutId:"101"},shopping:{label:cjBasics.lang.i18n("cj_i18n_00059","Google Shopping"),iconName:"__mdi:local_offer",shortcutId:"129"},destinations:{label:cjBasics.lang.i18n("cj_i18n_01774","Travel Guide"),iconName:"__mdi:explore",shortcutId:"764"}};function u(e,c){e=e?"/collections/list/"+encodeURIComponent(e):"/collections",e=cjBasics.urlParams.attach(e,i);c?A.src=n+e:A.cjceSendFrameCommand({method:"bmCstUpdateState",value:e},n)}var _=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:"save",serviceLabel:cjBasics.lang.i18n("cj_i18n_00432","Collections"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),bmApis:d,onNewTab:function(){A.cjceGetCleanUrl(n).then(function(e){e=e||cjgShortcuts.getUrl("359",d.account);d.openTab(e)})},onBack:function(){u(null)}}),p=(r.appendChild(_),_.cjceDrawerEl),h=cjce.createElement("bm-navlist",{selectedId:"home",items:s,onClick:function(e){"home"!==e&&d.pageManager.navigate(e)},onNewTab:function(e,c){c=c.newTabUrl||cjgShortcuts.getUrl(c.shortcutId,d.account);d.openTab(c)}}),j=(p.appendChild(h),!1),b=(B().then(function(e){(j=0<e.length)&&(h.remove(),h=cjce.createElement("bm-navlist",{selectedId:"home",isSelector:!0,items:j?[s.home].concat(e):s,onChange:function(e){u("home"===e?null:e)},onNewTab:function(e,c){d.openTab(t+("home"===e?"":"/list/"+e)+l)}}),p.appendChild(h))}),cjBasics.urlParams.attach(t,i));function g(e,c,n){c=c||{},c.alt="json",c.prettyPrint="false",e=cjBasics.urlParams.attach(o+e,c);return cjgApis.request(e,{method:"POST",fetchAs:"json",headers:{"Content-Type":"application/json+protobuf"},body:JSON.stringify(n||[])},{account:d.account,pa:!0,key:window.atob("QUl6YVN5QnMtR0pFRHFCQW4wTmlFdjAzbmtXZ0NVVHIydmxhVmww")})}cjBasics.webRequest.handleIframeHeaders([n+"/*bm_iid="+e+"*"],{useMobileUserAgent:!0,handleFirefoxInject:!0,handleSecVariables:!0});var f={IMAGE:"__mdi:image",ITINERARY:"__mdi:assignment",JOB:"__mdi:work_outline",PLACE:"__mdi:place",RECIPE:"__mdi:restaurant",SHOPPING_PRODUCT:"__mdi:local_offer",SCREENSHOT:"__mdi:photo",TVM_ENTITY:"__mdi:play_circle_outline",WEB_PAGE:"__mdi:news"};function v(){return g("ListLists",{pageSize:"200",fields:"lists(listDescriptor(listId,itemTypes),displayName)"}).then(function(e){var t=[];return e.lists.forEach(function(e){var c=e.listDescriptor,n=c&&c.listId;n&&t.push({id:n,supportsAdditions:!Array.isArray(c.itemTypes)||-1!==c.itemTypes.indexOf("WEB_PAGE"),label:(n=(n=e.displayName)||"").charAt(0).toUpperCase()+n.slice(1),iconName:function(e){var c=e.listDescriptor&&e.listDescriptor.itemTypes;if(Array.isArray(c))for(var n=0;n<c.length;n++){var t=f[c[n]];if(t)return t}return"__mdi:bookmark_border"}(e),newTabUrl:!0})}),t.sort(function(e,c){var n=e.label.toLowerCase(),t=c.label.toLowerCase();return n===t?e.id>c.id?1:-1:t<n?1:-1}),t}).catch(function(){return[]})}function I(){return cjgApis.cache.getItem(d.account,"bm_cache_v33__collections__lists").then(function(e){return Array.isArray(e)?e:[]})}function C(e){return cjgApis.cache.setItem(d.account,"bm_cache_v33__collections__lists",e),e}var w=null;function B(){return w=w||v().then(C,I)}function E(e){var n=cjce.createElement("cjmd-container",{solid:!0,floating:!0}),c=cjce.createElement("bm-ogb",{displayBack:!0,serviceIcon:"save",serviceLabel:cjBasics.lang.i18n("cj_i18n_00432","Collections"),pageLabel:cjBasics.lang.i18n("cj_i18n_06324","Save new item"),onBack:function(){n.remove()},bmApis:d}),t=(n.appendChild(c),cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll"})),i=(n.appendChild(t),document.createElement("div")),a=(i.className="bm-p-collections-form",t.appendChild(i),cjce.createElement("ccbm-textfield",{label:cjBasics.lang.i18n("cj_i18n_06316","Name")})),l=(i.appendChild(a),cjce.createElement("ccbm-textfield",{label:cjBasics.lang.i18n("cj_i18n_06317","Location (URL)")})),o=(i.appendChild(l),"_bm_choose_list"),s=(B().then(function(e){var c=[{value:"_bm_choose_list",label:cjBasics.lang.i18n("cj_i18n_06320","Add to collection")+"..."}],n=(e.forEach(function(e){e.supportsAdditions&&c.push({value:e.id,label:e.label})}),cjce.createElement("ccbm-button--select",{outline:!0,items:c,selectedId:o,onChange:function(){o=n.cjceSelectedId}}));n.classList.add("bm-p-collections-form__selectbox"),i.appendChild(n)}),cjce.createElement("ccbm-button",{label:cjBasics.lang.i18n("cj_i18n_01363","Save"),fill:!0,color:!0,onClick:function(){var e,c;_.cjceSetLoading(!0),s.disabled=!0,s.textContent=cjBasics.lang.i18n("cj_i18n_06327","Saving"),A.src="about:blank",e={listId:"_bm_choose_list"!==o&&o||null,webPageUrl:l.cjceValue,title:a.cjceValue},c=[null,null,e.title||null,null,null,null,null,null,[e.webPageUrl||null]],g("AddItems",{fields:"listItems/title"},[null,e.listId?[e.listId]:[null,2,[5]],[c]]).then(function(){m=!0,A.src=b+"&",n.remove()})}})),t=(c.cjceAppendChild(s),e&&e.title),c=(t&&(a.cjceValue=t),e&&e.bkmk);c&&(l.cjceValue=c),r.appendChild(n),setTimeout(function(){a.cjceSelect()})}var S,A=cjce.createElement("bm-iframe",{src:b,solid:"#fff",shadow:!0,onMessage:function(e){var c,n,t;"collectionswithwebappUpdatePath"===e.bm_method&&(t=-1!==(e=e.bm_value).indexOf("new-list"),c=-1!==e.indexOf("/list/"),_.cjceSetBackState(t||c),n="home",t?n="new-list":c&&(n=e.split("/list/")[1].split("/")[0]),h.cjceSelectedId=n,t=t?cjBasics.lang.i18n("cj_i18n_06321","New collection"):c?(e=j&&h.cjceGetItemElement(n))&&e.textContent||cjBasics.lang.i18n("cj_i18n_06322","Collection"):cjBasics.lang.i18n("cj_i18n_00291","Home"),_.cjceSetPageLabel(t))},onLoad:function(){m&&(m=!1,_.cjceSetLoading(!1))}}),T=(r.appendChild(A),cjce.createElement("ccbm-fab",{mini:!0,color:!0,iconName:"__mdi:link",label:cjBasics.lang.i18n("cj_i18n_06323","Save this"),onClick:function(){E({bkmk:S.url,title:S.title})}})),c=(cjBasics.navigator.getActionableUrl().then(function(e){e?(S=e,T.title=cjBasics.lang.i18n("cj_i18n_06323","Save this")+" ("+S.url+")"):T.parentNode.remove()}),cjce.createElement("ccbm-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_06324","Save new item"),onClick:function(){E()}}),T]}));r.appendChild(c),d.setOnPageDisplayHandler(function(e){e=e.listId;e&&u(e,!0)})});