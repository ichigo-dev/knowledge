"use strict";!function(){var q=document;cjce.registerTemplate("bm-p-bookswithgapi",function(n,s){var a,o,t,c,i,l,r,u,d="books"===s.instanceParameters.productId,b=["https://www.googleapis.com/auth/books"],h=window.atob("QUl6YVN5QVBncHJvLXAtRXc1ZGtTRDlUVW5aZENJZGJDS1VOQ0Zj"),m=12,_=(d&&n.style.setProperty("--ccc-accent-color","#0179ca"),"https://play.google.com"),p="https://books.google.com",j="https://www.google.com",f=p+"/books?op=library",g=(d?f=_+"/books?authuser="+s.account.authuser:"0"!==s.account.authuser&&(f+="&authuser="+s.account.authuser),"eBooks"),k={libraryHeader:{header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_00807","My library")},historyHeader:{header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_01685","My history")},favorites:{label:cjBasics.lang.i18n("cj_i18n_00692","Favorites"),shelfId:0,iconName:"__mdi:star_outline",newTabUrl:v(0)},purchases:{label:d?cjBasics.lang.i18n("cj_i18n_00310","Purchases"):cjBasics.lang.i18n("cj_i18n_01686","Purchased"),shelfId:1,iconName:"__mdi:local_offer",newTabUrl:e("books/purchases")},toRead:{label:cjBasics.lang.i18n("cj_i18n_01690","To read"),shelfId:2,iconName:"__mdi:notifications",newTabUrl:v(2)},readingNow:{label:cjBasics.lang.i18n("cj_i18n_01687","Reading now"),shelfId:3,iconName:"__mdi:visibility",newTabUrl:v(3)},haveRead:{label:cjBasics.lang.i18n("cj_i18n_01688","Have read"),shelfId:4,iconName:"__mdi:history",newTabUrl:v(4)},reviewed:{label:cjBasics.lang.i18n("cj_i18n_01689","Reviewed"),shelfId:5,iconName:"__mdi:rate_review",newTabUrl:v(5)},recentlyViewed:{label:cjBasics.lang.i18n("cj_i18n_01107","Recently viewed"),shelfId:6,iconName:"__mdi:schedule",newTabUrl:v(6)},eBooks:{label:d?cjBasics.lang.i18n("cj_i18n_00807","My library"):cjBasics.lang.i18n("cj_i18n_01693","Ebooks"),shelfId:7,iconName:"__mdi:library_books",newTabUrl:e("books")},forYou:{label:d?cjBasics.lang.i18n("cj_i18n_01055","For you"):cjBasics.lang.i18n("cj_i18n_01684","Books for you"),shelfId:8,iconName:"__mdi:person",newTabUrl:d?e("store/books"):v(8)},browsingHistory:{label:cjBasics.lang.i18n("cj_i18n_01692","Browsing history"),shelfId:9,external:!0,iconName:"__mdi:history",newTabUrl:v(9)},audiobooks:{label:cjBasics.lang.i18n("cj_i18n_01678","Audiobooks"),external:!0,iconName:"__mdi:headset",newTabUrl:e("books/audiobooks")},play:{label:cjBasics.lang.i18n("cj_i18n_00134","Shop"),iconName:"__mdi:shop",newTabUrl:e("store/books"),divider:!0,external:!cjBasics.webRequest.wrifSupported},uploads:{label:cjBasics.lang.i18n("cj_i18n_01680","Uploads"),external:!0,iconName:"__mdi:file_upload",newTabUrl:e("books/uploads")},rentals:{label:cjBasics.lang.i18n("cj_i18n_01682","Rentals"),external:!0,iconName:"__mdi:newsstand",newTabUrl:e("books/rentals")},samples:{label:cjBasics.lang.i18n("cj_i18n_01681","Samples"),external:!0,iconName:"__mdi:book",newTabUrl:e("books/samples")},family:{label:cjBasics.lang.i18n("cj_i18n_01219","Family"),external:!0,iconName:"__mdi:people",newTabUrl:e("books/family"),divider:!0},classicbooks:{label:cjBasics.lang.i18n("cj_i18n_01911","Google Books"),iconName:"__mdi:collections_bookmark",newTabUrl:v(null)}};function e(e){return _+"/"+e+"?authuser="+s.account.authuser}function v(e){return cjBasics.urlParams.attach(p+"/books",{as_coll:e,authuser:"0"===s.account.authuser?null:s.account.authuser})}function w(e){return k[e].shelfId}function y(e){var a;e&&"not_authorized"===e.cjg_error&&(n.textContent="",a=cjce.createElement("bm-fulldialog",{bmApis:s,onNewTab:function(){s.openTab(f)},lockup:{label:d?cjBasics.lang.i18n("cj_i18n_00285","Play Books"):cjBasics.lang.i18n("cj_i18n_00460","Books")},iconName:d?"play_books":"books",message:cjBasics.lang.i18n("cj_i18n_00321","Before you can use this page, you need to give access to load your Google Books. In case you only want to search for books, navigate to the search page in this extension."),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(s.account,e.cjg_missing_scopes)}}),n.appendChild(a))}function B(e,a){a=a||{},a.hl=cjBasics.lang.current,a.prettyPrint="false",e=cjBasics.urlParams.attach("https://content.googleapis.com/books/v1/"+e,a);return cjgApis.request(e,{fetchAs:"json"},{pa:"optional",account:s.account,key:h,requiredScopes:b})}function I(e){return u.cjceSetLoading(!0),function o(t){var c=void 0!==t.shelf;if(c&&!0!==t.noCache&&7===t.shelf)return cjgApis.cache.getItem(s.account,"bm_cache_v33__books__mybooks").then(function(e){return t.noCache=!0,e?{result:e,newRequest:!0,freshRequest:function(){return o(t)}}:o(t)});t.startIndex=t.startIndex||0;var e="volumes";return B(e=t.shelf?"mylibrary/bookshelves/"+t.shelf+"/volumes":e,{q:t.q,maxResults:t.maxResults,fields:"items(id,volumeInfo(title,previewLink,authors))",filter:c?null:t.searchFilter,startIndex:t.startIndex}).then(function(e){var a=e.items,n=[],a=(a&&a.forEach(function(e){var a=e.volumeInfo;n.push({id:e.id,title:a.title,previewLink:a.previewLink,authors:a.authors,openBook:Boolean(t.shelf)})}),{result:n,newRequest:0===t.startIndex});return c&&0===t.startIndex&&7===t.shelf&&cjgApis.cache.setItem(s.account,"bm_cache_v33__books__mybooks",n),e.items=e.items||[],e.totalItems-t.startIndex-e.items.length!=0&&(a.followupRequest=function(){return t.startIndex+=t.maxResults,o(t)}),a},y)}({maxResults:m,searchFilter:o.cjceSelectedId,shelf:e.shelf,q:e.q})}function T(e){var e=e.id;return d?_+"/books/reader?id="+encodeURIComponent(e)+"&authuser="+s.account.authuser:(e=e,e=j+"/books/edition/_/"+encodeURIComponent(e),"0"!==s.account.authuser&&(e+="?authuser="+encodeURIComponent(s.account.authuser)),e)}function C(e){var a,n=e&&e.followupRequest,o=(n&&c.cjceSetInfiniteScroll(function(){n().then(C)}),e&&Array.isArray(e.result)?e.result:[]);e&&e.newRequest&&(c.textContent="",t=cjce.createElement("cjmd-grid"),c.appendChild(t),0===o.length)&&(a=cjce.createElement("cjmd-emptystate",{color:!0,label:cjBasics.lang.i18n("cj_i18n_00322","No books found"),iconName:"__mdi:book"}),c.appendChild(a)),0<o.length&&o.forEach(function(e){e=function(a){var e,n=cjce.createElement("cjmd-griditem",{onClick:function(){var e=T(a);s.openTab(e)}}),o=cjBasics.urlParams.attach("https://books.google.com/books/content/reader",{printsec:"frontcover",img:"1",zoom:"1",id:a.id}),t=q.createElement("div");t.className="cjmd-griditem__thumbnail bm-p-bookswithgapi-griditem__thumbnail",t.style.backgroundImage='url("'+o+'")',n.appendChild(t),(o=q.createElement("div")).className="cjmd-griditem__bottom",n.appendChild(o);(t=q.createElement("div")).className="cjmd-griditem__textcontainer",o.appendChild(t);var c=q.createElement("div"),i=(c.textContent=a.title,t.appendChild(c),20);return Array.isArray(a.authors)&&((e=q.createElement("div")).className="cjmd-secondarytext",e.textContent=a.authors.join(" "),t.appendChild(e)),a.previewLink&&!a.openBook&&(i-=5,t=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:visibility",label:cjBasics.lang.i18n("cj_i18n_01161","Preview"),onClick:function(){s.openTab(a.previewLink+"&authuser="+s.account.authuser)}}),o.appendChild(t)),a.title.length>i&&(c.title=a.title),n}(e);t.appendChild(e)}),e&&e.freshRequest?e.freshRequest().then(C):u.cjceSetLoading(!1)}function N(){c.textContent="";var e=i.value;a=e,o.hidden=!1,I({q:e}).then(C)}function x(e){e=cjBasics.urlParams.attach(_+"/store/search",{q:e,c:"books",authuser:s.account.authuser});s.openTab(e)}function R(e){e=cjBasics.urlParams.attach(j+"/search",{q:e,tbm:"bks",authuser:"0"===s.account.authuser?null:s.account.authuser});s.openTab(e)}function U(e){return e.map(function(e){var a=k[e];return a.id=e,a})}function S(){var i,a;cjce.applyTemplate(l,"bm-loading"),i=[],a=["historyHeader","purchases","reviewed","recentlyViewed","browsingHistory"],(d?(i=U(["eBooks","audiobooks","play","forYou","purchases","uploads","rentals","samples","family","classicbooks"]),Promise.resolve(i)):(i=U(["libraryHeader","eBooks","favorites","readingNow","toRead","haveRead","forYou"]),B("mylibrary/bookshelves",{fields:"items(id,title,volumeCount)"}).then(function(e){var c=[],e=(e.items.forEach(function(e){var a=e.id;if("number"==typeof a)if(a<10)for(var n=0;n<i.length;n++)i[n].shelfId===a&&(i[n].infoSuffix=e.volumeCount);else{var o="bookshelf-"+a,t={id:o,shelfId:a,label:e.title,infoSuffix:e.volumeCount,iconName:"__mdi:newsstand",newTabUrl:v(a)};k[o]=t,c.push(t)}}),c.sort(function(e,a){return e.label>a.label?-1:1}),i=i.concat(c),U(a));return i=i.concat(e)}))).then(function(e){r=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:"eBooks",compact:!d,items:e,onChange:function(e,a){"classicbooks"===e?(s.pageManager.navigate(e),r.cjceSelectedId=g):"play"===e?(r.cjceSelectedId=g,s.pageManager.navigate(e,{typeId:"books"})):(g=e,c.textContent="",a&&(f=a.newTabUrl,u.cjceSetPageLabel(a.label)),I({shelf:w(e)}).then(C))},onNewTab:function(e,a){s.openTab(a.newTabUrl)}}),l.appendChild(r),l.cjceSetLoading(!1)},y)}u=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:d?"play_books":"books",serviceLabel:d?cjBasics.lang.i18n("cj_i18n_00285","Play Books"):cjBasics.lang.i18n("cj_i18n_00460","Books"),pageLabel:k[g].label,searchbox:{suggestHandler:function(e){return cjgApis.suggestquery.get({gAccount:s.account,hl:cjBasics.lang.current,q:e,ds:"bo"})},submitInNewTab:d,onSubmit:d?x:N,onMetaSubmit:d?x:R,onClear:function(){a="",o.hidden=!0,I({shelf:w(g)}).then(C)}},bmApis:s,onNewTab:function(){a?(d?x:R)(a):s.openTab(f)}}),n.appendChild(u),l=u.cjceDrawerEl,i=u.cjceSearchboxEl,S(),(o=cjce.createElement("ccbm-button--select",{onChange:N,selectedId:"ebooks",items:[{value:"ebooks",label:cjBasics.lang.i18n("cj_i18n_00198","All prices")},{value:"free-ebooks",label:cjBasics.lang.i18n("cj_i18n_00199","Free")},{value:"paid-ebooks",label:cjBasics.lang.i18n("cj_i18n_00200","Paid")}]})).hidden=!0,u.cjceAppendChild(o),c=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll",infiniteScroll:!0}),s.setOnPageDisplayHandler(i.select),n.appendChild(c),I({shelf:7}).then(C)})}();