"use strict";!function(){var D=window,y=document,I="undefined"!=typeof chrome&&chrome||{};cjce.registerTemplate("bm-p-portal",function(e,i){e.classList.add("bm-p-portal");var c,o,n=["applauncher","customize","notifications","extensionsettings","accountchooser","removedialog"],s="",r="search",d="search",l=!1;function p(e){if(e.shortcutId){var a=cjgShortcuts.getUrl(e.shortcutId,i.account);if(a)return void i.openTab(a)}e.url&&i.openTab(e.url)}i.darkMode&&e.style.setProperty("--background-color","#2d2d2d");var a,t,m,u,g,v,f,b,_,h,j,L={},C={};function E(a,e){var t=i.servicesDatabase[a],n=t.iconName||"placeholder",c=(i.darkMode&&"googleg"===n&&(n="search"),cjce.createElement("cjmd-item",{icon:{serviceName:n},label:t.label}));return c.classList.add("bm-p-portal-pageitem"),c.dataset.id=a,c.tabIndex=0,c.style.color=(n=t.color)?!0===n?i.darkMode?"#669df6":"#1a73e8":n:i.darkMode?"rgba(255, 255, 255, 0.8)":"#212121",e?(c.draggable=!0,(n=cjce.createElement("cjmd-icon",{name:"__mdi:drag_indicator",size:20})).classList.add("bm-p-portal-pageitem__dragicon"),c.appendChild(n),(e=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:delete",label:cjBasics.lang.i18n("cj_i18n_01164","Remove from menu"),onClick:function(e){i.userServices.remove(a),c.remove(),s=s.replace("_"+a+"_","_"),e.stopPropagation()}})).classList.add("bm-p-portal-pageitem__remove"),c.appendChild(e)):(t.shortcutId||t.url)&&((n=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:open_in_new",label:cjBasics.lang.i18n("cj_i18n_00084","Open service in new tab"),onClick:function(e){p(t),e.stopPropagation()}})).classList.add("bm-p-portal-pageitem__open-in-new"),c.appendChild(n)),c}function k(e){e===r?i.pageManager.navigate(d):i.pageManager.navigate(e)}function x(){var t=(-1!==location.search.indexOf("debug")||!i.account.pageId)&&l,n=y.createDocumentFragment(),e=((c||[]).forEach(function(e){var a;i.servicesDatabase[e]&&(a=E(e,t),C[e]=a,n.appendChild(a))}),C[r]);e&&e.classList.add("cjmd-item--selected"),o.textContent="",o.appendChild(n),e&&M(e)}function M(e){var a=o.scrollTop,e=e.offsetTop,t=e-60;(t<a||a<(t=e-o.offsetHeight-4))&&(o.scrollTop=t)}function B(e){var a=c.indexOf(r),a=(a=c[a+(e?-1:1)])||(e?c[c.length-1]:c[0]);i.pageManager.navigate(a)}function z(e){"removedialog"===r&&i.pageManager.navigate("customize")}function S(e){e.preventDefault()}function N(e){e.preventDefault();var a=e.dataTransfer.getData("serviceId"),t=e.target,n=t,e=(n=24<e.offsetY&&t.nextSibling?t.nextSibling:n).dataset.id,n=c.indexOf(e);t===o||-1===n?i.userServices.add(a):(-1!==(e=c.indexOf(a))&&c.splice(e,1),c.splice(n,0,a),i.userServices.set(c)),z()}function w(e){i.pageManager.navigate("removedialog"),e.dataTransfer.setData("serviceId",e.target.dataset.id)}i.darkMode&&e.classList.add("cjmd--dark"),t=cjce.createElement("cjmd-appbar"),(h=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:apps",label:cjBasics.lang.i18n("cj_i18n_00216","Apps"),onClick:function(){k("applauncher")}})).classList.add("bm-p-portal-pageicon"),L.applauncher=h,t.appendChild(h),(h=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),onClick:function(){k("extensionsettings")}})).classList.add("bm-p-portal-pageicon"),L.extensionsettings=h,t.appendChild(h),i.account.validSession?((m=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:notifications",label:cjBasics.lang.i18n("cj_i18n_00296","Notifications"),onClick:function(e){k("notifications")}})).classList.add("bm-p-portal-pageicon"),L.notifications=m,t.insertBefore(m,h),m=i.account.displayName,i.account.pageId&&(m+="\n"+cjBasics.lang.i18n("cj_i18n_00363","Brand account")),i.account.displayEmail&&(m+="\n"+i.account.displayEmail),a=cjce.createElement("ccbm-iconbutton",{label:m,icon:{size:32,avatar:!0,url:cjgApis.url.avatar(i.account.photoUrl,32)},onClick:function(){k("accountchooser")}}),(L.accountchooser=a).classList.add("bm-p-portal-pageicon"),t.appendChild(a),cjgApis.info.getIsOne(i.account).then(function(e){e&&a.classList.add("bm-p-portal-accountbutton--one")})):((h=cjce.createElement("ccbm-button",{label:cjBasics.lang.i18n("cj_i18n_01544","Sign in"),fill:!0,color:!0,onClick:function(){cjgApis.account.signin(i.account)}})).classList.add("bm-p-portal-signin"),t.appendChild(h)),m=t,e.appendChild(m),(o=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"transparentOnScroll"})).setAttribute("role","navigation"),o.addEventListener("click",function(e){var a=e.target.dataset.id;a&&(cjBasics.events.hasMeta(e)?p(i.servicesDatabase[a]):i.pageManager.navigate(a))}),o.addEventListener("mousedown",function(e){e=e.target.dataset.id;e&&i.loadPage(e)}),o.addEventListener("auxclick",function(e){var a;1===e.button&&(a=e.target.dataset.id)&&(p(i.servicesDatabase[a]),e.preventDefault())}),o.addEventListener("keydown",function(e){if(!cjBasics.events.hasModifier(e)){var a=e.key,t=y.activeElement;if("ArrowUp"===a)(t.previousSibling||t.parentNode.lastChild).focus();else if("ArrowDown"===a)(t.nextSibling||t.parentNode.firstChild).focus();else{if("Enter"!==a&&" "!==a)return;t.click()}e.preventDefault()}}),i.userServices.onChange(function(e){var a="_"+e.join("_")+"_";s!==a&&(c=e,s=a,x())}),i.pageManager.onChange(function(e){var a,t;e!==r&&((t=L[a=r])?t.setAttribute("aria-selected","false"):(t=C[a])&&t.classList.remove("cjmd-item--selected"),-1===n.indexOf(e)&&(d=e),(a="customize"===(r=e)||"removedialog"===e)!==l?(l=a,x(),o.classList.toggle("bm-p-portal-pagelist--customize",l),t=l,b&&(u.classList.toggle("bm-p-portal-customize--finish",t),v.hidden=t,f.hidden=!t,g||(b.textContent=t?j:_),t?(D.addEventListener("dragend",z),o.addEventListener("dragover",S),o.addEventListener("drop",N),o.addEventListener("dragstart",w)):(D.removeEventListener("dragend",z),o.removeEventListener("dragover",S),o.removeEventListener("drop",N),o.removeEventListener("dragstart",w)))):(a=L[e])?a.setAttribute("aria-selected","true"):(t=C[e])&&(t.classList.add("cjmd-item--selected"),M(t)))}),e.appendChild(o),(u=y.createElement("div")).className="bm-p-portal-page bm-p-portal-customize",g=Boolean(i.account.pageId),u.dataset.id=g?"accountchooser":"customize",(v=cjce.createElement("cjmd-icon",{name:g?"__mdi:account_circle":"__mdi:edit",color:i.darkMode?null:"#5f6368"})).classList.add("bm-p-portal-customize__icon"),u.appendChild(v),(f=cjce.createElement("cjmd-icon",{name:"__mdi:done"})).hidden=!0,f.classList.add("bm-p-portal-customize__icon"),u.appendChild(f),b=y.createElement("div"),_=cjBasics.lang.i18n("cj_i18n_01713","Customize"),h=cjBasics.lang.i18n("cj_i18n_01543","Switch account"),j=cjBasics.lang.i18n("cj_i18n_01715","Finish"),b.textContent=g?h:_,b.className="bm-p-portal-customize__label",u.appendChild(b),u.addEventListener("click",function(){var e;g?i.pageManager.navigate("accountchooser"):(e=l?d:"customize",i.pageManager.navigate(e))}),e.appendChild(u),"object"==typeof I.commands&&I.commands.onCommand&&I.commands.onCommand.addListener&&I.commands.onCommand.addListener(function(e){"portal-next-page"===e?B(!1):"portal-previous-page"===e&&B(!0)})})}();