"use strict";!function(){var C=document;cjce.registerTemplate("bm-p-adsense",function(e,i){var a,n,t,c,s,r,l,m={},o=(new Date).getDate(),d=["https://www.googleapis.com/auth/adsense.readonly"],_=window.atob("QUl6YVN5QXBVTVBOVFlnbW55UVUwcGdSSXdEcm42OHdGbXZ2bVp3");function u(e,a){e=e,a=a,n="https://www.google.com/adsense/new/",t=i.account.authuser,r?n+="u/"+t+"/"+r+"/":"0"!==t&&((a=a||{}).authuser=t),n+=e||"home";var n,t=a?cjBasics.urlParams.attach(n,a):n;i.openTab(t)}function p(e){var a=new Date;return a.setDate(o-e),{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()}}function g(e){if(e&&e.body&&e.body.indexOf("noAdSenseAccount"))return f();var a;"not_authorized"===e.cjg_error&&(a=e,y({message:cjBasics.lang.i18n("cj_i18n_00235","Before you can use this page, you need to give access to load your Google AdSense data"),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(i.account,a.cjg_missing_scopes)}}))}function h(e,a){a=a||{},a.prettyPrint="false",e=cjBasics.urlParams.attach("https://adsense.googleapis.com/v2/"+e,a);return cjgApis.request(e,{fetchAs:"json"},{account:i.account,pa:"optional",key:_,requiredScopes:d}).catch(g)}var j,b=[{label:cjBasics.lang.i18n("cj_i18n_00225","Today so far"),reportId:"today",range:"TODAY",start:"today",end:"today"},{label:cjBasics.lang.i18n("cj_i18n_00226","Yesterday"),reportId:"yesterday",range:"YESTERDAY",start:"today-1d",end:"today-1d",previous:{label:cjBasics.lang.i18n("cj_i18n_00227","vs same day last week"),start:"today-8d",end:"today-8d",startDate:p(8),endDate:p(8)}},{label:cjBasics.lang.i18n("cj_i18n_01181","Last 28 days").replace("28","7"),range:"LAST_7_DAYS",start:"today-7d",end:"today-1d",reportId:"last7days",previous:{label:cjBasics.lang.i18n("cj_i18n_01180","vs previous 28 days").replace("28","7"),start:"today-14d",end:"today-8d",startDate:p(14),endDate:p(8)}},{label:cjBasics.lang.i18n("cj_i18n_00228","This month so far"),reportId:"thismonth",range:"MONTH_TO_DATE",start:"startOfMonth",end:"today",previous:{label:cjBasics.lang.i18n("cj_i18n_01179","vs same period last year"),start:"startOfMonth-1y",end:"today-1y",startDate:p(365+o),endDate:p(365)}}];function y(e){c.cjceSetLoading(!1),s||(s=!0,t&&(t.hidden=!0),a.textContent="",e=cjce.createElement("bm-fulldialog",{inline:!0,bmApis:i,onNewTab:function(){u("home")},lockup:{label:cjBasics.lang.i18n("cj_i18n_00179","AdSense")},iconName:"ad_sense",message:e.message,actionLabel:e.actionLabel,actionG:e.actionG,action:e.action}),a.appendChild(e))}function f(){y({message:cjBasics.lang.i18n("cj_i18n_00233","There is no AdSense account attached to this Google account"),actionLabel:cjBasics.lang.i18n("cj_i18n_01543","Switch account"),action:function(){i.pageManager.navigate("accountchooser")}})}function v(e){var a,n,t;if(r)return a="accounts/"+r+"/reports",t=cjBasics.lang.current.replace("-","_"),n={fields:"headers/currency,totals",metric:"EARNINGS",startDate:e.start,endDate:e.end,useTimezoneReporting:"true",locale:t},a+=":generate",n={dateRange:e.range,languageCode:t,fields:"*",metrics:"ESTIMATED_EARNINGS"},(t=e.range)?n.dateRange=t:(n["startDate.year"]=e.startDate.year,n["startDate.month"]=e.startDate.month,n["startDate.day"]=e.startDate.day,n["endDate.year"]=e.endDate.year,n["endDate.month"]=e.endDate.month,n["endDate.day"]=e.endDate.day),h(a,n).then(function(e){var a=e.headers[0];return{revenue:(e=(e=e.totals)||[],Array.isArray(e)?e[0]||0:(e=e.cells,Array.isArray(e)&&0!==e.length&&(e=e[0])&&e.value||0)),currency:a.currencyCode||a.currency}});throw f(),new Error("No AdSense Account")}function A(){var a="bm_cache_v33__adsense__mainaccount",n=h("accounts",{fields:"accounts/name"}).then(function(e){var e=e.accounts||e.items;return Array.isArray(e)?((e=e[0]||{}).name||e.id||"").replace("accounts/",""):null}).then(function(e){return(r=e)?cjgApis.cache.setItem(i.account,a,e):f(),e});return cjgApis.cache.getItem(i.account,a).then(function(e){if(!r&&e&&"string"==typeof e)return r=e}).then(function(e){if(!e)return n})}function w(r,o,d){return c=r,s=function(e){var a,n,t,c,s=e[0].revenue,i=e[0].currency;o.textContent=s+" "+i,r.previous&&e[1]&&(t=e[1].revenue,e[1].currency===i)&&(a=0<(a=e=s-t)?"up":a<0?"down":"neutral",n=C.createDocumentFragment(),(c=cjce.createElement("cjmd-icon",{name:"down"==a?"__mdi:trending_down":"__mdi:trending_up"})).classList.add("bm-p-adsense-card__changeicon"),n.appendChild(c),c=s,s=(0<(c=Math.round(1e3*(c/t-1))/10)?"+":"")+c+"%",t=e,c=i,(e=(t=(Math.round(100*Math.abs(t))/100).toString()).split(".")[1])?e.length<2&&(t+="0"):t+=".00",i=t+" "+c+" ("+s+")",(e=C.createElement("span")).className="bm-p-adsense-card__changetext",e.textContent=i,n.appendChild(e),d.textContent="",d.dataset.type=a,d.appendChild(n))},new Promise(function(a,e){var n="bm_cache_v33__adsense__reports__"+c.start+"__"+c.end,t=!1;cjgApis.cache.getItem(i.account,n).then(function(e){!t&&e&&s(e)}),l.then(function(){m[n]=!0;var e=[v(c)];return c.previous&&e.push(v(c.previous)),Promise.all(e)}).then(function(e){t=!0,s(e),cjgApis.cache.setItem(i.account,n,e),a()},function(){})});var c,s}function B(){var i,r;s||(i=C.createDocumentFragment(),r=[],b.forEach(function(e){a=e,(e=cjce.createElement("cjmd-card",{withPadding:!0,interactive:!0,onClick:function(){u("reporting",{rt:"d",uim:"d",d:a.reportId,ct:a.reportCt||null})}})).classList.add("bm-p-adsense-card"),(s=C.createElement("div")).className="bm-p-adsense-card__date",s.textContent=a.label,e.appendChild(s),(c=C.createElement("div")).className="bm-p-adsense-card__amount",c.textContent=cjBasics.lang.i18n("cj_i18n_00325","Loading…"),e.appendChild(c),a.previous&&((t=C.createElement("div")).className="cjmd-secondarytext bm-p-adsense-card__comparison",t.textContent=a.previous.label,s.appendChild(t),(n=C.createElement("div")).className="bm-p-adsense-card__change",n.textContent="⁣",e.appendChild(n)),e.cjceAdsenseLoadContent=function(){return w(a,c,n)};var a,n,t,c,s=e;r.push(s.cjceAdsenseLoadContent()),i.appendChild(s)}),Promise.all(r).then(function(){c.cjceSetLoading(!1)}),a.textContent="",a.appendChild(i))}c=cjce.createElement("bm-ogb",{drawer:!0,loading:!0,serviceIcon:"ad_sense",serviceLabel:cjBasics.lang.i18n("cj_i18n_00179","AdSense"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),bmApis:i,onNewTab:function(){u("home")}}),e.appendChild(c),n=c.cjceDrawerEl,t=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:refresh",label:cjBasics.lang.i18n("cj_i18n_01182","Refresh reports"),onClick:function(){c.cjceSetLoading(!0),cjgApis.cache.remove(i.account,Object.keys(m)).then(B)}}),c.cjceAppendChild(t),j=cjce.createElement("bm-navlist",{items:[{id:"home",iconName:"__mdi:home",label:cjBasics.lang.i18n("cj_i18n_00291","Home"),newTabUrl:!0,adsensePath:"home"},{iconName:"__mdi:picture_in_picture",label:cjBasics.lang.i18n("cj_i18n_01530","Ads"),newTabUrl:!0,adsensePath:"main/myads-viewall-adunits",adsenseParams:{product:"SELF_SERVICE_CONTENT_ADS"},external:!0},{iconName:"__mdi:admob",label:cjBasics.lang.i18n("cj_i18n_00580","AdMob"),newTabUrl:!0,adsensePath:"main/adMob",adsenseParams:{product:"SELF_SERVICE_G_MOB_DISPLAY_APP"},external:!0},{iconName:"__mdi:campaign_search_display",label:cjBasics.lang.i18n("cj_i18n_01149","Ads for search"),newTabUrl:!0,adsensePath:"main/myads-viewall-adunits",adsenseParams:{product:"SELF_SERVICE_SEARCH_ADS"},external:!0},{iconName:"__mdi:web",label:cjBasics.lang.i18n("cj_i18n_01150","Sites"),newTabUrl:!0,adsensePath:"sites/my-sites",external:!0,divider:!0},{iconName:"__mdi:user",label:cjBasics.lang.i18n("cj_i18n_07006","Privacy & messaging"),newTabUrl:!0,adsensePath:"privacymessaging",external:!0,divider:!0},{iconName:"__mdi:block",label:cjBasics.lang.i18n("cj_i18n_01151","Blocking controls"),newTabUrl:!0,adsensePath:"main/allowAndBlockAds",external:!0},{iconName:"__mdi:assessment",label:cjBasics.lang.i18n("cj_i18n_01152","Reports"),newTabUrl:!0,adsensePath:"main/viewreports",adsenseParams:{rt:"d",uim:"d"},external:!0},{iconName:"__mdi:trending_up",label:cjBasics.lang.i18n("cj_i18n_01153","Optimalization"),newTabUrl:!0,adsensePath:"opt/opportunities",external:!0,divider:!0},{iconName:"__mdi:payments",label:cjBasics.lang.i18n("cj_i18n_01154","Payments"),newTabUrl:!0,adsensePath:"payments",external:!0},{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),newTabUrl:!0,adsensePath:"settings",external:!0}],selectedId:"home",bmApis:i,onNewTab:function(e,a){u(a.adsensePath,a.adsenseParams)}}),n.appendChild(j),a=cjce.createElement("cjmd-container",{scrollable:"noScroll",shadow:"transparentOnScroll"}),e.appendChild(a),l=A(),B()})}();