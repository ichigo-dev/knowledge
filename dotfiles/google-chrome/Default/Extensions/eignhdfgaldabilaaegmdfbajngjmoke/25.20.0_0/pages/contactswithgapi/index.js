"use strict";!function(){var J=document,W=browserStorage.sync.getItem("bm_pref__contacts__lastname");cjce.registerTemplate("bm-p-contactswithgapi",function(o,r){var s,l,d,m,u,e,i,a,p="https://contacts.google.com/"+r.wizPath,U="https://people.googleapis.com/v1/",x="https://www.google.com/m8/feeds/",n=["https://www.googleapis.com/auth/contacts.readonly"],F=Math.ceil(40*window.devicePixelRatio),h=p,b="home",f=null,D=25,R=["contactGroups/coworkers","contactGroups/family","contactGroups/friends"],_=!1,t=W.then(function(e){_=Boolean(e)}),g="connections(resourceName,names(displayName,displayNameLastFirst),photos/url,memberships/contactGroupMembership/contactGroupId),nextPageToken",c=null,j=!1,y=function(){if(cjgApis.info.getIsConsumerGmail(r.account))return Promise.resolve(!1);return cjgApis.cache.getItem(r.account,"bm_pref__contacts__directory").then(function(e){return"boolean"==typeof e?e:L().then(function(){return!0},function(){return!1}).then(function(e){return cjgApis.cache.setItem(r.account,"bm_pref__contacts__directory",e),e})})}().then(function(e){e&&(j=!0,g=g.replace("resourceName,","resourceName,metadata/sources(type,id),"))}),C=!1,v={};function N(e,a){u.cjceSetLoading(!0),b=e,f=a,C&&I()}function q(){Promise.all([cjgApis.cache.getItem(r.account,"bm_cache_v33__contacts__library"),t]).then(function(e){C||(s=e[0])&&(C=!0,I())}),Promise.all([y,t]).then(function(e){var a=function(e,a,t,n){var c=t||[];t="other"===e?"otherContacts":"people/me/connections";return w(t,{pageToken:n,pageSize:"2000",personFields:"memberships,metadata,names,photos",fields:g,sortOrder:a}).then(function(e){return Array.isArray(e.connections)&&(e.connections.forEach(function(e){e=S(e);e&&c.push(e)}),e.nextPageToken,0),c})}("main",_?"LAST_NAME_ASCENDING":"FIRST_NAME_ASCENDING");return j?Promise.all([L().then($),a]).then(function(e){var a=e[0],e=e[1],t=a.map(function(e){return e.id});return e.forEach(function(e){-1===t.indexOf(e.id)&&a.push(e)}),k(a),a}):a}).then(function(e){C=!0,s&&JSON.stringify(s).length===JSON.stringify(e).length||(cjgApis.cache.setItem(r.account,"bm_cache_v33__contacts__library",e),s=e,I())})}function w(a,t){var e=t||{},e=(e.prettyPrint="false",cjBasics.urlParams.attach(U+a,e));return cjgApis.request(e,{fetchAs:"json"},{account:r.account,requiredScopes:n}).catch(function(){return new Promise(function(e){setTimeout(function(){w(a,t).then(e)},4e3)})})}function E(){return cjce.createElement("ccbm-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_01285","Create contact"),onClick:function(){r.openTab(p+"new")}})]})}function T(e,a,t){return"string"!=typeof e?"/images/avatar.svg":((e=e.startsWith("http://")?e.replace("http://","https://"):e).startsWith("https://www.google.com/s2/")&&(e=e.replace("www","profiles")),cjgApis.url.avatar(e,a,t))}function S(e){var a=function(e){var a=e.resourceName;if(j&&a.startsWith("people/c")){var t=e.metadata&&e.metadata.sources;if(Array.isArray(t))for(var n=0;n<t.length;n++)if("DOMAIN_PROFILE"===t[n].type)return"people/"+t[n].id}return a}(e),t=e&&e.names&&e.names[0]||v[a];if(t){var n,c=t.displayName||"",t=t.displayNameLastFirst||c;if(c)return n=[],Array.isArray(e.memberships)&&(n=e.memberships.map(function(e){return e.contactGroupMembership?e.contactGroupMembership.contactGroupId:"GSUITE_DIRECTORY_GROUP"})),{id:a,displayName:c,displayNameLastFirst:t,sortValue:c.toLowerCase(),sortValueLastFirst:t.toLowerCase(),photo:e.photos&&e.photos[0].url||null,memberships:n}}}function $(e){for(var a=[],t=[],n=0;n<e.length;n+=50){var c=w("people:batchGet",{resourceNames:e.splice(0,50),fields:"responses(requestedResourceName,person(names(displayName,displayNameLastFirst),photos/url,memberships/contactGroupMembership/contactGroupId))",personFields:"names,photos,memberships"}).then(function(e){e.responses.forEach(function(e){e.person.resourceName=e.requestedResourceName;e=S(e.person);e&&a.push(e)})});t.push(c)}return Promise.all(t).then(function(){return a})}function L(){return c=c||cjgApis.info.getUserDomain(r.account).then(function(e){e=cjBasics.urlParams.attach(x+"gal/"+(e||"default")+"/full",{alt:"json","max-results":"50000"});return cjgApis.request(e,{fetchAs:"json",headers:{"GData-Version":"1.0"}},{account:r.account,requiredScopes:n})}).then(function(e){var i=[],e=e&&e.feed&&e.feed.entry;return Array.isArray(e)&&e.forEach(function(e){var a,t,n,c=function(e){if(!(e=e.id&&e.id.$t&&e.id.$t.split("full/P.")[1]))return null;for(var a=cjBasics.numbers.hex2dec(e);a.length<20;)a="0"+a;return a=a.length<21?"1"+a:a}(e);c&&(a=c="people/"+c,(e=(e=e).gd$name)&&(t=e.gd$fullName&&e.gd$fullName.$t,n=e.gd$givenName&&e.gd$givenName.$t,e=e.gd$familyName&&e.gd$familyName.$t,v[a]={displayName:t||n||e,displayNameLastFirst:e&&n?e+", "+n:null}),i.push(c))}),i})}function A(a){return s.filter(function(e){return-1!==e.memberships.indexOf(a)})}function B(e,a){var n=J.createDocumentFragment();a.forEach(function(e){a=e,e=_&&a.displayNameLastFirst||a.displayName,t={size:40},a.photo?(t.url=T(a.photo,0,F),t.avatar=!0):(t.withShell=!0,t.symbol=e[0]||"-"),(t=cjce.createElement("cjmd-item",{icon:t,label:e})).classList.add("bm-p-contactswithgapi-listitem"),t.cjceContactsData=a,(e=cjce.createElement("ccbm-iconbutton",{label:cjBasics.lang.i18n("cj_i18n_06290","Edit contact"),iconName:"__mdi:edit",onClick:function(){O(a.id,!0)}})).classList.add("bm-p-contactswithgapi-listitem__tool"),t.appendChild(e),(e=cjce.createElement("ccbm-iconbutton",{label:cjBasics.lang.i18n("cj_i18n_01545","Open in a new tab"),iconName:"__mdi:open_in_new",onClick:function(){O(a.id)}})).classList.add("bm-p-contactswithgapi-listitem__tool"),t.appendChild(e);var a,t,e=t;n.appendChild(e)}),e.appendChild(n)}function I(){u.cjceSetLoading(!0);var t,a,n,e,c,i=cjce.createElement("cjmd-container",{scrollable:!0,fabPadding:!0,infiniteScroll:!0,shadow:"thinOnScroll"});"home"===b?(0<(e=A("starred")).length&&(c=cjce.createElement("cjmd-subheader",{color:!0,label:cjBasics.lang.i18n("cj_i18n_00004","Starred")}),i.appendChild(c),B(c=cjce.createElement("cjmd-list"),e),i.appendChild(c),e=cjce.createElement("cjmd-subheader",{color:!0,label:cjBasics.lang.i18n("cj_i18n_00314","Contacts")}),i.appendChild(e)),t=A("myContacts")):"search"===b?(a=f,t=s.filter(function(e){return-1!==JSON.stringify(e).indexOf(a)})):"directory"===b?t=A("GSUITE_DIRECTORY_GROUP"):"other"===b?t=A("SPECIAL_OTHER"):"label"===b&&(t=A(f)),0<t.length?(n=cjce.createElement("cjmd-list"),function e(){var a=t.splice(0,D);B(n,a),0!==t.length&&setTimeout(function(){i.cjceSetInfiniteScroll(e)})}(),i.appendChild(n)):(c=b,e=cjce.createElement("cjmd-emptystate",{color:!0,label:cjBasics.lang.i18n("cj_i18n_01275","No contacts found"),subLabel:"search"===c?cjBasics.lang.i18n("cj_i18n_00116","Try a synonym or more general keyword"):null,iconName:"search"===c?"__mdi:search":"__mdi:contacts_product"}),i.appendChild(e)),d.textContent="",d.appendChild(i),u.cjceSetLoading(!1)}function G(e,a){var t=a.resourceName.replace("contactGroups/",""),n=a.formattedName,c=n,a=a.memberCount;0<a&&(c+=" ("+a+")"),e.push({id:t,iconName:"__mdi:label",label:c,navigatorLabel:n,newTabUrl:p+"label/"+t})}function k(e){var t=_?"sortValueLastFirst":"sortValue";e.sort(function(e,a){return e[t]<a[t]?-1:1})}function M(){cjce.applyTemplate(m,"bm-loading");var n=[{id:"home",label:cjBasics.lang.i18n("cj_i18n_00314","Contacts"),navigatorLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),iconName:"__mdi:person",newTabUrl:p,divider:!0}],c=[{label:cjBasics.lang.i18n("cj_i18n_01276","Frequently contacted"),iconName:"__mdi:history",newTabUrl:p+"frequent",external:!0},{label:cjBasics.lang.i18n("cj_i18n_01277","Duplicates"),iconName:"__mdi:assistant",newTabUrl:p+"merge",external:!0},{label:cjBasics.lang.i18n("cj_i18n_01278","Other contacts"),iconName:"__mdi:archive",newTabUrl:p+"other",divider:!0}],i=J.createElement("div"),e=(m.appendChild(i),w("contactGroups",{pageSize:"500",fields:"contactGroups(resourceName,groupType,formattedName,memberCount)"}));Promise.all([e,t,y]).then(function(e){var t=[],a=(j&&(n[0].divider=!1,n.push({id:"directory",label:cjBasics.lang.i18n("cj_i18n_01279","Directory"),iconName:"__mdi:business",newTabUrl:p+"directory",divider:!0})),e[0].contactGroups.forEach(function(e){var a;"USER_CONTACT_GROUP"===e.groupType?G(t,e):"contactGroups/myContacts"===e.resourceName?0<(a=e.memberCount)&&(n[0].label+=" ("+a+")"):-1!==R.indexOf(e.resourceName)&&0<e.memberCount&&G(t,e)}),0<t.length&&(n.push({header:!0,label:cjBasics.lang.i18n("cj_i18n_01280","Labels")}),t.sort(function(e,a){return e.label.toLowerCase()<a.label.toLowerCase()?-1:1}),t[t.length-1].divider=!0,n=n.concat(t)),n=n.concat(c),l=cjce.createElement("bm-navlist",{compact:!0,isSelector:!0,selectedId:"home",items:n,onChange:function(e,a){h=a.newTabUrl||p,"home"===e||"directory"===e||"other"===e?N(e):N("label",e),u.cjceSetPageLabel(a.navigatorLabel||a.label)},onNewTab:function(e,a){r.openTab(a.newTabUrl)}}),i.appendChild(l),cjce.createElement("bm-drawerdropdown",{iconName:"__mdi:cj_sort_by_alpha",label:cjBasics.lang.i18n("cj_i18n_01281","Sort"),selectedId:_?"last":"first",items:[{value:"last",label:cjBasics.lang.i18n("cj_i18n_01282","Sort by last name")},{value:"first",label:cjBasics.lang.i18n("cj_i18n_01283","Sort by first name")}],onChange:function(){var e;e="last"===a.cjceSelectedId,_=e,browserStorage.sync.setItem("bm_pref__contacts__lastname",_),C&&(k(s),I())}}));m.appendChild(a),m.cjceSetLoading(!1)})}function P(a){var e=cjce.createElement("cjmd-item"),t=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:content_copy",label:cjBasics.lang.i18n("cj_i18n_07125","Copy to clipboard"),onClick:function(e){cjBasics.clipboard.copy(a.value),i||(i=cjce.createElement("ccbm-snackbar",{label:cjBasics.lang.i18n("cj_i18n_07124","Copied to clipboard")}),o.appendChild(i)),i.cjceShow()}}),n=(a.onClick?e.addEventListener("click",function(e){e=e.target;e===t||t.contains(e)||a.onClick()}):e.classList.add("no-action"),cjce.createElement("cjmd-icon",{name:a.iconName})),n=(e.appendChild(n),J.createElement("div")),c=(n.className="cjmd-item__body",e.appendChild(n),J.createElement("div"));return c.className="cjmd-item__header",c.textContent=a.value,n.appendChild(c),a.subLabel&&(c=cjce.createElement("cjmd-secondarytext",{label:a.subLabel}),n.appendChild(c)),e.appendChild(t),e}function O(e,a){e=p+e.replace("people/","person/");a&&(e+="?edit=true"),r.openTab(e)}function V(e){return Array.isArray(e)&&0!==e.length?e:null}function z(e){e=encodeURIComponent(e);r.openTab(p+"search/"+e)}function H(){var e=l.cjceSelectedId;"home"===e||"directory"===e||"other"===e?N(e):N("label",e)}u=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:"contacts",serviceLabel:cjBasics.lang.i18n("cj_i18n_00314","Contacts"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),searchbox:{color:!0,onClear:H,onInput:function(e){e?N("search",e):H()},onSubmit:function(){d.querySelector(".cjmd-item").click()},onMetaSubmit:z},bmApis:r,onNewTab:function(){"search"===b?z(f):r.openTab(h)}}),o.appendChild(u),m=u.cjceDrawerEl,e=u.cjceSearchboxEl,a=E(),o.appendChild(a),r.setOnPageDisplayHandler(e.select),(d=cjce.createElement("cjmd-container")).addEventListener("click",function(e){var a,t,c,n,i,e=e.target.cjceContactsData;e&&(a=e,(t=cjce.createElement("cjmd-container",{solid:!0})).classList.add("bm-p-contactswithgapi-details"),e=cjce.createElement("bm-ogb",{floating:!0,displayBack:!0,onBack:function(){t.remove()},bmApis:r,onNewTab:function(){O(a.id)}}),t.appendChild(e),n=cjce.createElement("ccbm-iconbutton",{label:cjBasics.lang.i18n("cj_i18n_06290","Edit contact"),iconName:"__mdi:edit",onClick:function(){O(a.id,!0)}}),e.cjceAppendChild(n),(c=J.createElement("div")).className="bm-p-contactswithgapi-details__top",t.appendChild(c),e=_&&a.displayNameLastFirst||a.displayName,n={size:80},a.photo?(n.url=T(a.photo,80),n.avatar=!0):(n.symbol=e[0]||"-",n.withShell=!0),(n=cjce.createElement("cjmd-icon",n)).classList.add("bm-p-contactswithgapi-details__photo"),c.appendChild(n),(n=cjce.createElement("cjmd-title",{label:e})).classList.add("bm-p-contactswithgapi-details__name"),c.appendChild(n),e=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thickOnScroll"}),t.appendChild(e),i=cjce.createElement("cjmd-list"),e.appendChild(i),w(a.id,{fields:"addresses,birthdays,emailAddresses,phoneNumbers"}).then(function(e){var t=J.createDocumentFragment(),a=V(e.emailAddresses),n=(a&&a.forEach(function(e){var a=P({iconName:"__mdi:email",value:e.value,subLabel:e.formattedType,onClick:function(){r.openTab("mailto:"+e.value)}});t.appendChild(a)}),V(e.phoneNumbers));n&&n.forEach(function(e){var a=P({iconName:"__mdi:call",value:e.value,subLabel:e.formattedType,onClick:function(){r.openTab("tel:"+e.canonicalForm)}});t.appendChild(a)}),a&&(n=a[0].value,a=[{iconName:"__mdi:email",label:cjBasics.lang.i18n("cj_i18n_07233","Send email"),newTabUrl:"mailto:"+n},{iconName:"__mdi:event",label:cjBasics.lang.i18n("cj_i18n_07234","Schedule event"),newTabUrl:cjBasics.urlParams.attach("https://meet.google.com/new",{authuser:"0"===r.account.authuser?null:r.account.authuser,calleeId:n})},{iconName:"__mdi:meet",label:cjBasics.lang.i18n("cj_i18n_07235","Start video call"),newTabUrl:cjBasics.urlParams.attach("https://calendar.google.com/calendar/r/eventedit",{authuser:"0"===r.account.authuser?null:r.account.authuser,add:n})}],n=cjce.createElement("ccbm-biglinks",{bottom:!0,items:a,onClick:function(e,a){a=a.newTabUrl;r.openTab(a)}}),c.appendChild(n)),Array.isArray(e.addresses)&&0<e.addresses.length&&e.addresses.forEach(function(e){var a=P({iconName:"__mdi:place",value:e.formattedValue,subLabel:e.formattedType,onClick:function(){r.openTab(cjBasics.urlParams.attach("https://maps.google.com/",{authuser:"0"===r.account.authuser?null:r.account.authuser,q:e.formattedValue}))}});t.appendChild(a)}),Array.isArray(e.birthdays)&&0<e.birthdays.length&&e.birthdays.forEach(function(e){e=P({iconName:"__mdi:cake",value:e.text});t.appendChild(e)}),0===t.children.length&&((a=J.createElement("div")).className="bm-p-contactswithgapi-noinfo",a.textContent=cjBasics.lang.i18n("cj_i18n_01284","No more contact info found"),t.appendChild(a)),i.appendChild(t),u.cjceSetLoading(!1)}),o.appendChild(t))}),o.appendChild(d),q(),M(),cjgApis.auth.requireToken(r.account,n).catch(function(e){var a=cjce.createElement("bm-fulldialog",{bmApis:r,onNewTab:function(){r.openTab(h)},lockup:{label:cjBasics.lang.i18n("cj_i18n_00314","Contacts")},iconName:"contacts",message:cjBasics.lang.i18n("cj_i18n_01286","Before you can use this page, you need to give access to load your Google Contacts"),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(r.account,e.cjg_missing_scopes)}}),t=E();a.appendChild(t),o.appendChild(a)})})}();