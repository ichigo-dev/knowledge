"use strict";cjce.registerTemplate("bm-p-currentshybrid",function(n,i){var c,t,a,s,o,e,l,r,m,d,b,u,p,h,j,g,f,_,v,w,C=!cjBasics.webRequest.wrifSupported||!i.account.validSession,O="#1a73e8",B=cjBasics.lang.i18n("cj_i18n_01772","Currents"),S="/"+i.wizPath,T="https://currents.google.com",U="https://plus.google.com",A=U+S,x=T+S,R=x,D=x,N=i.account.obfuscatedId,W=!1,q=["stream","tags","communities","me","people","notifications","discover","collections","explore","settings"],k={stream:{label:cjBasics.lang.i18n("cj_i18n_00291","Home"),iconName:"__mdi:home",newTabUrl:""},tags:{label:cjBasics.lang.i18n("cj_i18n_06609","Tags"),iconName:"__mdi:tag",newTabUrl:"tags"},discover:{label:cjBasics.lang.i18n("cj_i18n_00926","Discover"),iconName:"__mdi:explore",newTabUrl:"discover"},explore:{label:cjBasics.lang.i18n("cj_i18n_00485","Whatâ€™s hot"),iconName:"__mdi:whatshot",newTabUrl:"explore",divider:!0},collections:{label:cjBasics.lang.i18n("cj_i18n_00292","Collections"),iconName:"__mdi:google_collections",newTabUrl:"collections"},communities:{label:cjBasics.lang.i18n("cj_i18n_00293","Communities"),iconName:"__mdi:communities",newTabUrl:"communities"},me:{label:cjBasics.lang.i18n("cj_i18n_00294","Profile"),iconName:"__mdi:account_circle",newTabUrl:N},people:{label:cjBasics.lang.i18n("cj_i18n_00295","People"),iconName:"__mdi:people",newTabUrl:"people"},notifications:{label:cjBasics.lang.i18n("cj_i18n_00296","Notifications"),iconName:"__mdi:notifications",newTabUrl:"notifications/all",divider:!0},settings:{label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),iconName:"__mdi:settings",newTabUrl:"settings"},up:{label:cjBasics.lang.i18n("cj_i18n_06610","Join Currents"),iconName:"__mdi:login",newTabUrl:"up"}};function L(e){return e.map(function(e){var n=k[e];return n.id=e,n})}function y(e){i.openTab(R+e)}function H(e,n){y(n.newTabUrl)}function z(e,n){var n=n.newTabUrl,i=("collections"===e||"communities"===e||"people"===e||"stream"===e)&&o.value;i&&(n="s/"+encodeURIComponent(i),"stream"!==e)&&(n+="/"+e),y(n)}function F(e){y("s/"+encodeURIComponent(e))}function G(){y("")}function P(){C=!0,n.textContent="",a=cjce.createElement("bm-ogb",{serviceIcon:"currents",serviceLabel:B,pageLabel:cjBasics.lang.i18n("cj_i18n_01167","Links"),searchbox:{color:O,submitInNewTab:!0,onSubmit:F},bmApis:i,onNewTab:G}),n.appendChild(a),o=a.cjceSearchboxEl,i.setOnPageDisplayHandler(o.select);var e=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll"});n.appendChild(e),d=L(q),s=cjce.createElement("bm-navlist",{color:!0,items:d,onClick:z,onNewTab:z}),e.appendChild(s)}function J(){r.cjceGetCleanUrl(T).then(function(e){e?i.openTab(e):y("back"===u?"":u)})}function M(e){var n=cjBasics.urlParams.attach(e,f),i=++g;j.then(function(){g===i&&r.cjceSendFrameCommand({method:"bmCstUpdateState",value:n})})}function E(e,n){var i=k[e];!n&&u===e||(u=e,M(S+i.newTabUrl),a.cjceSetPageLabel(i.label))}function V(){s=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:u,items:d,onChange:function(e){E(e)},onNewTab:H}),e.textContent="",e.appendChild(s)}function K(){return cjBasics.urlParams.attach(D+(s&&(e=s.cjceSelectedId,"string"==typeof(e=k[e].newTabUrl))?e:""),f);var e}function Q(e){!1===h&&(h=!0,p()),u="/"===(e=e)||"/stream"===e||"/stream/"===e?"stream":"/discover"===e||"/discover/"===e?"discover":e.startsWith("/settings")?"settings":e.startsWith("/people")||e.startsWith("/circles")?"people":e.startsWith("/notifications")?"notifications":e.startsWith("/tags")?"tags":"/me"===e||"/me/"===e||e==="/"+N||e==="/"+N+"/"||e==="/"+N+"/posts"||e==="/"+N+"/posts/"?"me":e.startsWith("/explore")?"explore":e.startsWith("/up")?"up":"/s"===e||e.startsWith("/s/")?"search":"/collections"===e||"/collections/"===e||e.startsWith("/collections/featured")||e.startsWith("/collections/followed")||e.startsWith("/collections/yours")?"collections":"/communities"===e||"/communities/"===e||e.startsWith("/communities/member")||e.startsWith("/communities/member/")||e.startsWith("/communities/yours")||e.startsWith("/communities/yours/")?"communities":"back",l.hidden="back"!==u,a.cjceSetBackState("search"===u),m.hidden=!W||!("stream"===u||"search"===u),"back"!==u&&(s.cjceSelectedId=u,k[u])&&a.cjceSetPageLabel(k[u].label)}function I(){o.value="",o.focus(),a.cjceSetNavigatorCollapseState(!1),E(b,!0)}function X(){var e;c||(c=!0,d=L(["communities","notifications","collections","discover","explore","up"]),u=b="up",a.cjceSetPageLabel(k[u].label),V(),e=K(),r?r.src=e:j.then(function(){r.src=e}))}function Y(e){t&&!e||(t=!0,P())}function Z(){cjgApis.info.getUserDomain(i.account).then(function(e){e||Y()}),(i.account.validSession?cjBasics.ajax(A).then(function(e){return e||""},function(e){return e&&e.body||""}).then(function(e){return-1!==e.indexOf("Join Google+")||-1!==e.indexOf('rel="canonical" href="https://plus.google.com/discover')?"disabled":-1!==e.indexOf("<title>Google</title>")?"disabledAdministrator":"enabled"}):Promise.resolve("invalidSession")).then(function(e){!0!==e&&("disabled"===e||"invalidSession"===e?X():"disabledAdministrator"===e&&Y(!0))})}C?P():(C=!0,setTimeout(function(){C&&!t&&P()},4e3),d=L(q),u=b="stream",h=!1,j=new Promise(function(e){p=e}),g=0,_=cjBasics.uniqueId.generate(),f={bm_cid:"currentshybrid",bm_cst:"2",bm_wiz:"1",bm_iid:_,hl:cjBasics.lang.current},cjBasics.webRequest.handleIframeHeaders([T+"/*bm_iid="+_+"*",U+"/*bm_iid="+_+"*"],{handleFirefoxInject:!0}),Z(),_=cjce.createElement("cjmd-container"),w=K(),r=cjce.createElement("bm-iframe",{src:w,solid:"#fff",onLoad:function(){a.cjceSetLoading(!1)},onMessage:function(e){var n=e.bm_method,e=e.bm_value;"currentshybridWebsiteOrigin"===n?(C=!1,e===U&&(D=e+S)):"currentshybridPageTitle"===n?"back"===u&&l.cjceSetPageLabel(e):"currentshybridUpdateView"===n?Q(e):"currentshybridWorkspaceLimit"===n?(m.cjceChecked=e,W||(W=!0,"stream"!==u&&"search"!==u)||(m.hidden=!1)):"bmCstOpenUrl"===n&&(n=cjBasics.cleanBmUrl(e),i.openTab(n))}}),v=cjBasics.webRequest.addListener("onBeforeRedirect",function(e){e.redirectUrl.startsWith(x+"up")&&(X(),v.removeListener(),v=null)},{types:["sub_frame"],urls:[w]}),_.appendChild(r),w=_,a=cjce.createElement("bm-ogb",{drawer:{color:!0},loading:!0,serviceIcon:"currents",serviceLabel:B,pageLabel:k[u].label,searchbox:{color:O,onClear:I,onSubmit:function(e){M("s/"+encodeURIComponent(e))},onMetaSubmit:F},bmApis:i,onNewTab:J,onBack:I}),n.appendChild(a),e=a.cjceDrawerEl,o=a.cjceSearchboxEl,(m=cjce.createElement("ccbm-switch",{compact:!0,icon:"__mdi:business",onChange:function(){a.cjceSetLoading(!0),r.cjceSendFrameCommand({method:"bmCstClickDomElement",value:'c-wiz > div[data-checked-veid][data-unchecked-veid][jslog][role="checkbox"][title][aria-checked][aria-label]'},T)}})).hidden=!0,a.cjceAppendChild(m),(l=cjce.createElement("bm-ogb",{displayBack:!0,floating:!0,serviceLabel:B,pageLabel:cjBasics.lang.i18n("cj_i18n_01174","Loading"),bmApis:i,onNewTab:J,onBack:I})).hidden=!0,n.appendChild(l),V(),i.setOnPageDisplayHandler(o.select),n.appendChild(w),E(u))});