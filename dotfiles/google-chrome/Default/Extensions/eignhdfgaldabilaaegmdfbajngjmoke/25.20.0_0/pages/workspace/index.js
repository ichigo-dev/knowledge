"use strict";cjce.registerTemplate("bm-p-workspace",function(t,r){var n,e,i,a,M,q,F,l,L,U,s,d,o,m,u,c,z,h="https://tasks.google.com",_="https://chat.google.com",p="https://mail.google.com",R="/u/"+r.account.authuser+"/",f="/"+r.wizPath+"embed/",H=h+f,W=_+R,j=!1,J=Math.ceil(32*window.devicePixelRatio),f=r.instanceParameters.productId,b="tasks"===f,g="chat"===f,v="rooms"===f,V=f,G=(g&&t.style.setProperty("--ccc-accent-color","#34a853"),cjBasics.lang.i18n("cj_i18n_00439","Tasks")),K=cjBasics.lang.i18n("cj_i18n_00819","Chat"),Q=cjBasics.lang.i18n("cj_i18n_07056","Spaces"),X=cjBasics.lang.i18n("cj_i18n_00291","Home"),w=cjBasics.lang.i18n("cj_i18n_06917","My Tasks"),k=b?w:X,Y="list/",I=b?"list/~default":"welcome",Z=!1,$=!1,A=g?"welcome":"tasks",B=I,y={id:B,label:k},ee=["tasks","drive","hangouts","meet","chat"],C=[{id:I,label:k}],E=[],S=[],ce="",ae="",T="bm_cache_v33__"+f+"__activeview",x={welcome:{init:function(){return cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll"})}},files:{init:function(){return U=r.requirePage("doclist"),cjce.createElement("cjmd-container")},load:function(c){c.textContent="";var a=B.split("space/")[1];U.then(function(){var e=cjce.createElement("cjg-doclist",{gAccount:r.account,darkMode:r.darkMode,listview:!0,shadow:"thinOnScroll",openInNew:r.openTab,onLoadingChange:function(e){O("files",e)},cachingId:"bm_cache_v33__workspace__files_"+a,orderBy:"modifiedTime desc",q:"'".concat(y.email,"' in readers")});c.appendChild(e)})}},tasks:{init:function(){n=cjBasics.uniqueId.generate(),i={bm_cid:"taskswithcompanion",bm_iid:n,bm_cst:"2",bm_wiz:"1",hl:cjBasics.lang.current,fullWidth:"1"};var e=cjgApis.companion.getInitData(),c=(q=e.id,M=e.hash,e.parameters),a=(Object.keys(c).forEach(function(e){i[e]=c[e]}),cjBasics.webRequest.handleIframeHeaders([h+"/*bm_iid="+n+"*"],{handleFirefoxInject:!0,handleSwCache:!0}),cjce.createElement("bm-iframe",{solid:"#fff",shadow:!0,sandbox:"allow-scripts allow-forms allow-same-origin allow-popups",onLoad:function(){"about:blank"!==a.src&&O("tasks",!1)},onMessage:function(e){var c,a;b&&"object"==typeof e&&"taskswithcompanionData"===e.bm_method?(Z=!0,a=e.bm_value,B=a.activeView||I,l=B,0<(a=a.tasklists).length&&(C=a,cjgApis.cache.setItem(r.account,"bm_cache_v33__workspace__tasklists",C)),B.startsWith("list/")&&(c={},[S,E,C].forEach(function(e){e.forEach(function(e){e.id===B&&(c=e)})}),c.id=B,cjgApis.cache.setItem(r.account,T,c)),re()):(a=cjgApis.companion.handleOpenUrlMessage(e,q,r.account))&&r.openTab(a)}}));return a},load:function(e){O("tasks",!0);var c=B.replace("space/","room/"),c=cjBasics.urlParams.attach(H+c,i)+M;e.src=c}},chat:{init:function(){return e=cjBasics.uniqueId.generate(),a={bm_iid:e,bm_cid:"chatforworkspace",bm_cst:"2",bm_wiz:"1",origin:cjBasics.webRequest.wrifSupported?null:p,shell:"1",hl:cjBasics.lang.current},cjBasics.webRequest.handleIframeHeaders([p+"/*",p+"/*bm_iid="+e+"*",_+"/*bm_iid="+e+"*"],{handleFirefoxInject:!0,handleSwCache:!0,disableOgs:_}),O("chat",!0),cjce.createElement("bm-iframe",{src:cjBasics.urlParams.attach(W,a),solid:"#fff",shadow:!0,onLoad:function(){setTimeout(function(){F=!0},200),O("chat",!1)}})},load:function(e){var c="welcome"===B;c&&!l||(c=c?l:B,F?e.cjceSendFrameCommand({method:"bmCstClickDomElement",value:'div[role="list"] > [role="listitem"][data-group-id="'+c+'"] > div'},_):(c=c.replace("space/","room/"),e.src!==(c=cjBasics.urlParams.attach(W+c,a))&&(e.src=c)))}}};function te(e){e=p+"/"+(j?"mail":"chat")+R+"#"+e;r.openTab(e)}function ne(e){te((j?"search/chat/":"search/")+encodeURIComponent(e))}function ie(e){var c;"tasks"===A?(c=(c=e)?c.replace("space/","room/"):Y,c=cjBasics.urlParams.attach(H+c,{fullWidth:"1",origin:p}),r.openTab(c)):te("chat/"+(e||"").replace("room/","space/"))}function N(e){e=e&&e.label||k;s.cjceSetPageLabel(e)}function se(e){return!e.pinned}function oe(e,c){var a,t,n,i,s,o;e&&(i=c,t=[],g&&!i&&t.push({id:"welcome",iconName:"__mdi:home",label:X,shortcutId:"559"}),b&&(a={id:"list/~starred",label:cjBasics.lang.i18n("cj_i18n_00004","Starred"),iconName:"__mdi:star_border"},t.push(a,{header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_07059","Tasklists")}),C.forEach(function(e){e.iconName="__mdi:list_alt",e.newTabUrl=!0,e.id===B&&N(e),t.push(e)}),"list/~starred"===B)&&N(a),g&&(a=[].concat(E,S)).some(function(e){return e.pinned})&&(t.push({header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_01580","Pinned")}),a.forEach(function(e){e.pinned&&(e.newTabUrl=!0,t.push(e))})),g&&Array.isArray(S)&&0<(a=S.filter(se)).length&&(t.push({header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_00185","Chats")}),a.forEach(function(e){e.newTabUrl=!0,t.push(e)})),Array.isArray(E)&&0<(a=g?E.filter(se):E).length&&(t.push({header:!0,color:!0,label:Q}),a.forEach(function(e){e.newTabUrl=!0,e.id===B&&N(e),t.push(e)})),!v&&!g||i||(t.push({header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_01539","Related apps")}),v&&t.push({id:"chat",iconName:"__mdi:chat_bubble_outline",label:cjBasics.lang.i18n("cj_i18n_00819","Chat"),shortcutId:"559",external:!r.servicesDatabase.chat}),t.push({id:"meet",iconName:"__mdi:meet",label:cjBasics.lang.i18n("cj_i18n_00809","Meet"),shortcutId:"545",external:!r.servicesDatabase.meet,additionalFragment:cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:video_call",label:cjBasics.lang.i18n("cj_i18n_06916","New meeting"),onClick:function(){var e=cjgShortcuts.getUrl("1188",r.account);r.openTab(e)}})},{id:"tasks",iconName:"__mdi:tasks",label:cjBasics.lang.i18n("cj_i18n_00439","Tasks"),shortcutId:"140"},{id:"drive",label:cjBasics.lang.i18n("cj_i18n_00390","Drive"),iconName:"__mdi:drive",shortcutId:"48"})),0<(a=t).length&&c&&O("welcome",!1),i=c?ae:ce,(n=JSON.stringify(a.map(function(e){return[e.id,e.label]})))!==i)&&(c?ae=n:ce=n,s=c,i=o=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:B,items:a,onChange:function(e,c){var a;-1!==ee.indexOf(e)?(r.pageManager.navigate(e),o.cjceSelectedId=l):(s?u.cjceSelectedId=e:m&&(m.cjceSelectedId=e),B=e,y=c,b?(D("tasks"),d&&(a=e.startsWith("space/"),d.hidden=a)):v?fe():g&&je(B),(v||g)&&(c.id||(c.id=e),cjgApis.cache.setItem(r.account,T,c)),N(c))},onNewTab:function(e){ie(e)}}),c?m=i:u=i,e.textContent="",e.appendChild(i))}function re(){oe(s.cjceDrawerEl)}function le(){re(),oe(x.welcome.frameEl,!0)}function de(e,c){var a=c.indexOf(e);return c.slice(Math.max(0,a+e.length))}function me(e,c){e=c.lastIndexOf(e);return c.slice(0,Math.max(0,e))}function ue(e){var c=function(e){var c=e[47];if("string"==typeof c)return c;try{return e[17][0][2].replace("","")}catch(e){}try{return e[46][1][2].replace("","")}catch(e){}return""}(e),a=function(e){var c,a=e[0];if(Array.isArray(a))return(c=a[0])&&"string"==typeof c?c.replace("room/","space/"):(c=a[1])&&"string"==typeof c?(null===e[48]?"dm/":"space/")+c:void 0}(e)||cjBasics.uniqueId.generate(),c=-1===c.indexOf("images/room_avatars")?cjgApis.url.avatar(c,0,J):c,t=e[48];return{color:"currentColor",id:a,pinned:e[12],icon:{size:32,avatar:!t,radius:t&&4,url:c},email:t,label:e[2]}}function he(e){var e=de("AF_initDataCallback({key: 'ds:1'",e),e=(e=me("sideChannel:",de(" data:",e)),e=me("]",e)+"]",JSON.parse(e)),c=[],a=[];try{c=(e[5]||e[8]).map(ue)}catch(e){}try{a=e[4].map(ue)}catch(e){}return{spaces:c,chats:a}}function P(){x.tasks.frameEl.cjceSendFrameCommand({method:"bmCstClickDomElement",value:'body > div > c-wiz > div[role="menu"] div[role="separator"] + [aria-label][role="menuitem"]'},h)}function O(e,c){x[e].loading=c,A===e&&s.cjceSetLoading(c)}function _e(e,c){var a,t;e&&e!==A&&(a=A,A=e,(a=(a=x[a])&&a.frameEl)&&(a.hidden=!0),(t=(a=x[e])&&a.frameEl)&&(t.hidden=!1),s.cjceSetLoading(a.loading),v&&cjgApis.cache.setItem(r.account,"bm_cache_v33__rooms__activeservice",e),o)&&!c&&(o.cjceSelectedId=e)}function pe(e){var c=x[e],a=c.init();return e!==A&&(a.hidden=!0),c.frameEl=a,t.appendChild(a),a}function D(e){var c,a;"chat"!==e&&((c=x[e]).loading=!0,a=(a=c.frameEl)||pe(e),c.load(a))}function fe(){setTimeout(function(){D(A)}),setTimeout(function(){"chat"!==A&&D("chat"),"tasks"!==A&&D("tasks"),"files"!==A&&D("files")},200)}function je(e,c){var a="welcome"===e;_e(a?e:"chat"),s.cjceSetBackState(!a),s.cjceSearchboxEl.hidden=!a,m.cjceSelectedId=e,u.cjceSelectedId=e,a?c&&N(y={id:B=e,label:k}):(D("chat"),N(y))}w=g?{submitInNewTab:!0,color:!0,onSubmit:ne}:null,s=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:V,bmApis:r,searchbox:w,serviceLabel:g?K:v?Q:G,pageLabel:k,onNewTab:function(){ie(B)},onBack:function(){je("welcome",!0)}}),t.appendChild(s),g&&r.setOnPageDisplayHandler(s.cjceSearchboxEl.select),b?(d=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:post_add",label:cjBasics.lang.i18n("cj_i18n_06919","Create a new list"),onClick:function(){x.tasks.frameEl.cjceSendFrameCommand({method:"bmCstClickDomElement",value:"h2 + div > div:first-child[data-allow-task-list-reordering] > div"},h),setTimeout(P),setTimeout(P,10),setTimeout(P,50),setTimeout(P,100),setTimeout(P,200),setTimeout(P,300),setTimeout(P,500)}}),s.cjceAppendChild(d)):(w=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:video_call",label:cjBasics.lang.i18n("cj_i18n_06916","New meeting"),onClick:function(){var e=cjgShortcuts.getUrl("1188",r.account);r.openTab(e)}}),s.cjceAppendChild(w)),v&&(o=cjce.createElement("ccbm-tabs",{items:{chat:K,files:cjBasics.lang.i18n("cj_i18n_00122","Files"),tasks:G},onChange:function(e){"chat"===e?(A=e,ie(B)):_e(e,!0)},selectedId:A}),s.appendChild(o)),c=_+"/"+r.wizPath,z=cjBasics.ajax(c+"?shell=9").then(he).catch(function(){return cjBasics.ajax(c+"?shell=8").then(he)}).catch(function(){return null}).then(function(e){var c;$=!0,e&&(c=e.chats,Array.isArray(c)&&(S=c,cjgApis.cache.setItem(r.account,"bm_cache_v33__workspace__chats",c)),c=e.spaces,Array.isArray(c)&&(E=c,v&&"welcome"===B&&(y=E[0],B=y.id,l=B,N(y),cjgApis.cache.setItem(r.account,T,y)),cjgApis.cache.setItem(r.account,"bm_cache_v33__workspace__spaces",c)),le())}),w=cjgApis.cache.getItem(r.account,T).then(function(e){if(!e||"object"!=typeof e)return g?void 0:z;l=(L=e).id,g||(B=l,N(y=L))}),f=cjgApis.cache.getItem(r.account,"bm_cache_v33__workspace__spaces").then(function(e){$||Array.isArray(e)&&0!==e.length&&(E=e)}),browserStorage.sync.getItem("bm_pref__main__workspace_gmail").then(function(e){j=Boolean(e)}),w=[w,f],b?(f=cjgApis.cache.getItem(r.account,"bm_cache_v33__workspace__tasklists").then(function(e){Z||Array.isArray(e)&&0!==e.length&&(C=e)}),w.push(f)):g?(f=cjgApis.cache.getItem(r.account,"bm_cache_v33__workspace__chats").then(function(e){$||Array.isArray(e)&&0!==e.length&&(S=e)}),w.push(f)):v&&cjgApis.cache.getItem(r.account,"bm_cache_v33__rooms__activeservice").then(function(e){_e(e)}),Promise.all(w).then(function(e){g?(pe("welcome"),(l?D:pe)("chat")):b?D("tasks"):v&&fe(),le()})});