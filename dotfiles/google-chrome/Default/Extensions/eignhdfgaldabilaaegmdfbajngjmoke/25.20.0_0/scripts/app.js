"use strict";!function(){var M,s,T,l=window,R=l.location,d=document,c="undefined"!=typeof chrome&&chrome||{},N=[],n=[],i=[],r=[],o={},u=!1,H=new Promise(function(e){T=e});function p(s){n=[],i=[],Object.keys(o).forEach(function(e){var a=-1!==s.indexOf(e),t=o[e].hidden;(!t||a&&"unused"===t||u&&"permanent"!==t)&&(a?n:i).push(e)}),n=n.sort(function(e,a){return s.indexOf(e)<s.indexOf(a)?-1:1}),i=i.sort(function(e,a){return o[e].label<o[a].label?-1:1})}var U=["aboutme","gplus","youtube","ytstudio","mybusiness","adwordsexpress","photos","albumarchive","myaccount","contacts","save","poly","play"],g={webmastertools:"searchconsole",tiltbrushsketches:"poly",hangouts:"chat",vrblocks:"poly",playmusic:"music",chromeapps:"browserapps",chromebookmarks:"browserbookmarks",chrometopsites:"browsertopsites",gmaillite:"gmail",appmaker:"script",calendarlite:"calendar",publicalerts:"covid19",keeplite:"keep","keep-pro":"keep",googlepay:"gpay",payments:"gpay",adwords:"ads",music:"ytmusic",shortlists:"save",express:"shopping",gplus:"currents",flightsandhotels:"googletravel",flightshotels:"googletravel",packages:"googletravel",vacations:"googletravel",destinations:"googletravel",trips:"googletravel",travelpackages:"googletravel",trackedflightprices:"flights"};function z(e){r=e.defaultServices||[],u=e.debug||!1,o=e.servicesDatabase||{};var a=browserStorage.sync.get(["bm_pref__portal__services"]).then(function(e){return e.bm_pref__portal__services}),a=[browserStorage.local.getItem("bm_pref__portal__lastused"),a,e.servicesDatabaseRequest,e.accountRequest],e=Promise.all(a).then(function(e){var a=g[e[0]]||e[0],t=e[1]||r;if(o=e[2],M=e[3],s=a||t[0],!u&&M.pageId)return-1===(n=Object.keys(o).filter(function(e){return o[e].brandAccount&&!o[e].hidden}).sort(function(e,a){return U.indexOf(e)-U.indexOf(a)})).indexOf(s)&&(s="aboutme"),null;Array.isArray(t)?(e=t.join(" "),Object.keys(g).forEach(function(e){var a=t.indexOf(e);-1!==a&&(t[a]=g[e])}),p(t),e!==n.join(" ")&&browserStorage.sync.setItem("bm_pref__portal__services",n)):(s=a||r[0],p(r))});T(e)}function f(e){p(e),browserStorage.sync.setItem("bm_pref__portal__services",n),N.forEach(function(e){e(n,i)})}function F(e,a){a=a||n.indexOf(e);-1!==a&&(n.splice(a,1),f(n))}function G(){return H.then(function(){return 0<n.length?{serviceId:s}:{serviceId:"customize",sessionParameters:{welcome:!0}}})}var m,b,v,h,y,k,W,V,_,J=Object.freeze({__proto__:null,add:function(e){f(n.concat(e))},contains:function(e){return-1!==n.indexOf(e)},getLastUsed:G,init:z,onChange:function(e){var a;N.push(e),a=e,H.then(function(){a(n,i)})},remove:F,replace:function(e,a){var t,s;-1!==i.indexOf(a)&&-1!==(t=n.indexOf(e))&&(-1===(s=n.indexOf(a))?(n[t]=a,f(n)):F(e,s))},set:f}),e="object"==typeof c.i18n&&"function"==typeof c.i18n.getMessage&&c.i18n,a=new URLSearchParams(R.search),w=d.documentElement,K=!1,j=!1,P=a.get("page"),I=a.get("environment"),Q="1"===a.get("debug"),x=!1,S=cjgApis.account.missingAccountData,X="";function Y(e){return S=e,X=cjgApis.url.createWizPath(S),S}var L=cjgApis.session.init(Y).then(Y);function Z(i,e){var r,o;i&&(r=e||{},o=!1,c.tabs.query({currentWindow:!0},function(e){for(var a=i.replace("/u/0/","/"),t=e.length;0<t;t--){var s=e[t-1],n=s.pendingUrl||s.url;if("string"==typeof n&&(n.replace("/u/0/","/")===a||n.replace("/u/0/","/").split("?")[0].split("#")[0]===a)){c.tabs.update(s.id,{active:!0}),o=!0;break}}o||("newtab"===I?c.tabs.update({active:!0,url:i}):c.tabs.create({url:i})),"popup"!==I||r.noClose||l.close()}))}D=P||"search",A=!($={accountchooser:!(B=!(O=[])),contentblocking:!0,customize:!0,missingpermissions:!0,newtab:!0,pagestateupdate:!0,portal:!0,removedialog:!0});var B,O,D,$,A,t,C={navigate:E,lock:function(e){E(e),B=!0},onChange:function(e){O.push(e),e(D)}};function E(e,a){if(a&&a.softInit){if(A)return}else A=!0;var t,s,n;function i(){e===D&&t.onPageDisplayHandler(a||{})}B||((t=v[e])&&t.linkOnly?E(t.pageId,t.pageParameters||a):(t&&!t.loaded&&(t.loaded=!0,ae(e)),s=D=e,n=b.querySelector(":scope > .selected"),s!==(n&&n.dataset.id||null)&&(s=b.querySelector(':scope > [data-id="'+s+'"]'),n&&n.classList.remove("selected"),s)&&s.classList.add("selected"),O.forEach(function(e){e(D)}),$[D]||P||browserStorage.local.setItem("bm_pref__portal__lastused",D),t&&(t.onPageDisplayHandler?i():t.lastPageDisplayCallback=i)))}function ee(e){var a=(e=e||{}).serviceData||{},t=e.instanceParameters||{},s={onNewTab:!0,portal:cjBasics.navigator.firefoxMobile,notifications:P&&a.showNotifications&&S.validSession,accountchooser:P&&S.validSession,signin:P&&!S.validSession};return{missingGooglePermission:x,debugMode:Q,instanceParameters:t,darkMode:a.preferDarkMode?!K:j,setOnPageDisplayHandler:e.setOnPageDisplayHandler,account:S,wizPath:X,openTab:Z,requirePage:q,loadPage:ae,environment:I,standaloneService:P,pageManager:C,userServices:J,servicesDatabase:v,ogbFeatures:s}}function q(e){var a=v[e]||{},t=a.loadPromise;if(!t){var s="/pages/"+e+"/index.js",n=[h,k,L],i=("portal"!==e&&n.push(y,_,V),a.preload||[]),r=(a.pageId&&a.pageId!==e?i.push(a.pageId):n.push(cjBasics.resources.loadScript(s)),a.extraCss&&n.push(cjBasics.resources.loadStyle("/pages/"+e+"/index.css")),a.dnsPrefetch);if(r)for(var o=0;o<r.length;o++){var c=d.createElement("link");c.rel="dns-prefetch",c.href=r[o],d.head.appendChild(c)}Array.isArray(i)&&l.requestIdleCallback&&l.requestIdleCallback(function(){i.forEach(q)},{timeout:2e3}),Array.isArray(a.dependencies)&&a.dependencies.forEach(function(e){n.push(q(e))}),t=Promise.all(n),a.loadPromise=t}return t}function ae(e){var a=v[e],t=a.pageId||e,s=a.pageParameters,n=!cjBasics.webRequest.wrifSupported&&a.wrifFallbackPageId,n=(n&&(v[n]?t=n:(t="pagestateupdate",s={productId:e})),cjBasics.navigator.firefox&&a.firefoxFallbackPageId),n=v[t=n?n:t];x&&!n.noGooglePermissionNeeded?(t="pagestateupdate",s={productId:e,missingPermissions:!0}):cjBasics.webRequest.hasFirefoxContentBlocking&&"valid"===n.requireSignin?(t="pagestateupdate",s={productId:e,contentBlocking:!0}):!S.validSession&&n.requireSignin?(t="pagestateupdate",s={productId:e,signinRequired:!0}):!S.pageId||a.brandAccount&&n.brandAccount||(t="pagestateupdate",s={productId:e,brandAccountUnsupported:!0});n=ee({serviceData:a,setOnPageDisplayHandler:function(e){a.onPageDisplayHandler=e,setTimeout(function(){"function"==typeof a.lastPageDisplayCallback&&a.lastPageDisplayCallback(),a.lastPageDisplayCallback=null})},instanceParameters:s}),s=cjce.createElement("bm-app",{bmApis:n,pageId:t});s.dataset.id=e,b.appendChild(s)}function te(a){return new Promise(function(e){c.permissions.contains({origins:[a]},e)})}function se(){var n=matchMedia("(prefers-color-scheme: dark)");(j=n.matches)&&w.classList.add("bm-style-flag--dark"),n.addEventListener&&n.addEventListener("change",function(){j=n.matches,w.classList.toggle("bm-style-flag--dark",j);for(var e=b.children,a=0;a<e.length;a++){var t=e[a],s=t.dataset.id;v[s].preferDarkMode||t.classList.toggle("cjmd--dark",j)}})}function ne(){d.body.textContent="",(m=d.createElement("div")).className="bm-ele-main",d.body.appendChild(m),W=browserStorage.sync.getItem("bm_pref__main__language").then(function(e){return cjBasics.lang.overwriteLanguage(e)}),h=cjBasics.ajax("/pages.json",{fetchAs:"json"}).then(function(t){return W.then(function(){return Object.keys(t).forEach(function(e){var a=t[e].labelI18n;a&&(t[e].label=cjBasics.lang.i18n(a,t[e].label))}),cjBasics.geo.isUsaCheck()&&(t.movies.color=!0,t.movies.iconName="tv",t.movies.label=cjBasics.lang.i18n("cj_i18n_06402","Google TV")),v=t})}),y=cjBasics.webRequest.restoreWrifSupported(),k="options"===I?(se(),Promise.resolve()):browserStorage.sync.getItem("bm_pref__main__theme").then(function(e){if(e&&"auto"!==e){if("light"===e)K=!0;else{if("dark"!==e)return;j=!0,w.classList.add("bm-style-flag--dark")}e=d.querySelector('meta[name="color-scheme"]');e&&(e.content=j?"dark":"light")}else se()});var a,t,e=["search","maps","translate","news","youtube","gmail","calendar","drive","keep","tasks"],e=("newtab"===I&&(d.title="New Tab for Googleâ„¢",e=["chromtopsites","chromebookmarks","calendar","keep","news","drive","gmail","tasks","maps","contacts"]),z({debug:Q,defaultServices:e,accountRequest:L,servicesDatabaseRequest:h}),c.runtime.onMessage.addListener(function(e){e.reloadAllInstances&&R.reload()}),!P&&"sidebar"!==I&&!cjBasics.navigator.firefoxMobile);e&&((a=d.createElement("div")).className="bm-ele-mainportal",t="portal","newtab"===I?(t="newtab",a.classList.add("bm-ele-mainportal--newtab")):a.classList.add("bm-ele-mainportal--sideportal"),m.appendChild(a),Promise.all([h]).then(function(){var e=v[t],e=cjce.createElement("bm-app",{pageId:t,bmApis:ee({serviceData:e})});a.appendChild(e)})),e=e,(b=d.createElement("div")).className="bm-ele-mainwindow","newtab"===I?b.classList.add("bm-ele-mainwindow--newtab"):e&&b.classList.add("bm-ele-mainwindow--sideportal"),m.appendChild(b),setTimeout(function(){cjBasics.navigator.safari?w.classList.add("bm-style-flag--loaded"):cjBasics.resources.loadStyle("/styles/app-delayed.css").then(function(){w.classList.add("bm-style-flag--loaded")})},10),_=("object"!=typeof c.permissions?Promise.resolve(!0):Promise.all([te("https://*.google.com/*"),te("https://*.google.com/cjg-apis/*")]).then(function(e){return e[0]||e[1]})).then(function(e){x=!e}),V=cjBasics.navigator.getTabId(),Promise.all([h,L,y,_,k]).then(function(){P?C.navigate(P,{softInit:!0}):G().then(function(e){C.navigate(e.serviceId,{softInit:!0})})})}P&&"sidebar"!==I&&w.classList.add("bm-style-flag--singlepage"),cjBasics.navigator.firefox&&(w.classList.add("bm-style-flag--firefox"),"options"===I)&&w.classList.add("bm-style-flag--firefox-options"),"popup"===I&&(w.classList.add("bm-style-flag--ext-popup"),cjBasics.navigator.mac&&c.runtime.sendMessage({closeAuthPopup:!0}),cjBasics.navigator.firefox||cjBasics.navigator.mac&&!cjBasics.navigator.safari)&&(t=1600,function e(){w.classList.add("bm-style-flag--macfix"),setTimeout(function(){w.classList.remove("bm-style-flag--macfix")},20),0<t&&(setTimeout(e,500),t-=500)}()),e&&(a=e.getMessage("@@bidi_dir")||"ltr",e=e.getUILanguage().replace("_","-"),d.documentElement.dir=a,d.documentElement.lang=e),"popup"===I?"complete"===d.readyState?setTimeout(ne,100):l.addEventListener("load",function(){setTimeout(ne,100)}):ne()}();