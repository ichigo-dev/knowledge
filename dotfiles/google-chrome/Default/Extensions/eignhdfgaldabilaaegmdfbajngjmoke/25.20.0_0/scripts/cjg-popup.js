"use strict";!function(){var i,s,t,a=window,c=a.location,e=document,o="undefined"!=typeof chrome&&chrome||{},u="https://www.google.com",r=o.runtime.getURL("PATH/").replace("/PATH/",""),g=r.startsWith("safari-web-extension://"),n="object"==typeof o.i18n&&"function"==typeof o.i18n.getMessage&&o.i18n,l=n&&n.getMessage("@@extension_id")||r.split("://")[1]||"",p=c.href;function h(){s||o.runtime.sendMessage({closeAuthPopup:!0})}function f(){o.runtime.sendMessage({reloadAllInstances:!0},h)}function m(t){cjgApis.session.changeAccount(t,!0).then(f,f),setTimeout(f,1e3)}function d(){cjgApis.account.list({listPages:!1}).then(function(t){Array.isArray(t)?0!==t.length&&t[0].validSession?m(function(t){for(var e=t[0],n=0;n<t.length;n++){var s=t[n];if(s.validSession){if(s.authuser===i)return s;s.authuser>e.authuser&&(e=s)}}return e}(t)):m(cjgApis.account.noAccountData):m(cjgApis.account.missingAccountData)})}function A(t){Promise.all([cjgApis.account.list({authuser:i}),cjgApis.auth.getTokenInfo(t)]).then(function(t){t=function(t,e){for(var n=0;n<t.length;n++){var s=t[n];if(s.obfuscatedId===e)return s}return null}(t[0],t[1].sub);t?m(t):f()},f)}!function(){var t=a.top!==a.self,e=p.startsWith(u+"/cjg-auth/"+l);if(t)return e&&(o.runtime.sendMessage({cjgAuthUrl:p}),g)&&a.parent.postMessage({cjgAuthUrl:p},r);var t=p.startsWith(u+"/cjg-apis/"+l),n=p.startsWith(o.runtime.getURL("views/cjg-popup.html"));(e||t||n)&&(i=(p.match(/authuser=(\d)/)||[])[1]||null,e=(p.split("access_token=")[1]||"").split("&")[0],t=c.hash.split("--macpopup"),s=t[1]&&cjBasics.navigator.mac&&!cjBasics.navigator.opera,n=t[0].replace("#",""),"signin"===(t=c.pathname.split("/")[3])||"signin"===n?d():("signout"!==t&&"signout"!==n||m(cjgApis.account.noAccountData),e?A(e):(s?f:h)()))}(),void 0!==e&&(e.documentElement.textContent="",n)&&(t=n.getMessage("@@bidi_dir")||"ltr",n=n.getUILanguage().replace("_","-"),e.documentElement.dir=t,e.documentElement.lang=n)}();