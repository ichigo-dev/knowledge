# 『並行プログラミング特有のバグと問題点』ノート

（最終更新： 2023-09-02）


## 目次

1. [デッドロック](#デッドロック)
1. [ライブロック](#ライブロック)
1. [再帰ロック](#再帰ロック)
1. [飢餓](#飢餓)
1. [疑似覚醒](#疑似覚醒)
1. [メモリバリア](#メモリバリア)


## デッドロック

**デッドロック**は、[並行プログラミング](../../README.md)やマルチスレッド環境において、複数の[プロセス](./concurrency_and_parallelism.md#プロセス)が互いに必要なリソースを獲得できず、停滞状態に陥る問題。デッドロックは次の4つの条件が同時に成立すると発生する。

- 相互排他条件: 少なくとも1つのリソースが排他的に利用される状態（一度に1つの[プロセス](./concurrency_and_parallelism.md#プロセス)しかリソースを利用できない状態）
- 保持・待ち条件: [プロセス](./concurrency_and_parallelism.md#プロセス)が少なくとも1つのリソースを獲得している状態で、さらに別のリソースを要求する状態（リソースの保持と新しいリソースの待ちが同時に発生する状態）
- 無駄な待ち条件: [プロセス](./concurrency_and_parallelism.md#プロセス)が保持しているリソースを他の[プロセス](./concurrency_and_parallelism.md#プロセス)から強制的に奪うことができない状態
- 循環待ち条件: 複数の[プロセス](./concurrency_and_parallelism.md#プロセス)が循環的に互いのリソースを待っている状態


## ライブロック

**ライブロック**は、[並行プログラミング](../../README.md)やマルチスレッド環境において、複数の[プロセス](./concurrency_and_parallelism.md#プロセス)が一貫して動作を続けているものの、全体として進行が停滞している状態。[デッドロック](#デッドロック)とは異なり、リソースの待機状態による停滞は発生しない。

典型的な例として、2つ以上の[プロセス](./concurrency_and_parallelism.md#プロセス)が共有リソースにアクセスし、それらのリソースを獲得するために互いに優先権を譲り合い、進行できなくなる状況が考えられる。この場合、[プロセス](./concurrency_and_parallelism.md#プロセス)がリソースへのアクセス権を持ち続けてしまうことは防げている一方で、全体としては処理が進まない。


## 再帰ロック

**再帰ロック**は、[並行プログラミング](../../README.md)やマルチスレッド環境において、リソースを獲得中の[プロセス](./concurrency_and_parallelism.md#プロセス)が、そのリソースを解放する前に再度そのリソースを獲得しようとすることによって、処理が進まなくなる問題。再帰ロックを行っても処理が続行可能であるようなロックを**再入可能ロック**という。


## 飢餓

**飢餓**(Starvation)は、[並行プログラミング](../../README.md)やマルチスレッド環境において、特定の[プロセス](./concurrency_and_parallelism.md#プロセス)がリソースをほぼ永久的に獲得できない状況。飢餓状態は、リソースの割当やスケジューリングの不公平な扱いに起因する。例えば、優先度の低い[プロセス](./concurrency_and_parallelism.md#プロセス)が優先度の高いものに比べてリソースを獲得する機会が極端に少ない場合などに発生し得る。


## 疑似覚醒

**疑似覚醒**は、[並行プログラミング](../../README.md)やマルチスレッド環境において、ある条件が満たされるまで待機している[プロセス](./concurrency_and_parallelism.md#プロセス)が、条件が満たされていないにも関わらず[実行状態](./concurrency_and_parallelism.md#実行状態)へ遷移する現象。例えば、[プロセス](./concurrency_and_parallelism.md#プロセス)の外側から送信される[シグナル](../../../../computer/linux/_/chapters/process_and_job.md#シグナル)によって疑似覚醒が発生する可能性がある。このような理由もあり、マルチスレッドと[シグナル](../../../../computer/linux/_/chapters/process_and_job.md#シグナル)は一般的に悪いとされる。


## メモリバリア

**メモリバリア**（**メモリフェンス**）は、[メモリ](../../../../computer/hardware/_/chapters/memory.md#メモリ)アクセスの順番を制御するための処理。

[CPU](../../../../computer/hardware/_/chapters/processor.md#cpu)の最適化手法のひとつである**アウトオブオーダ実行**では、[メモリ](../../../../computer/hardware/_/chapters/memory.md#メモリ)の読み込みや保存の順序を入れ替えて実行する場合がある。これは[並行プログラミング](../../README.md)やマルチスレッド環境において、予測不能の動作を生じる原因となる。メモリバリアは、このようなアウトオブオーダ実行の弊害から[プログラム](../../../../programming/_/chapters/programming.md#プログラム)を保護するために使用される。
