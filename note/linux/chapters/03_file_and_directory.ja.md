# ファイルとディレクトリ


## 目次

1. [ファイルとディレクトリ](#ファイルとディレクトリ-1)
	1. [実行ファイルとデータファイル](#実行ファイルとデータファイル)
	1. [テキストファイルとバイナリファイル](#テキストファイルとバイナリファイル)
	1. [ファイルフォーマットと拡張子](#ファイルフォーマットと拡張子)
1. [ディレクトリとパス](#ディレクトリとパス)
	1. [ルートディレクトリとカレントディレクトリとホームディレクトリ](#ルートディレクトリとカレントディレクトリとホームディレクトリ)
	1. [パス](#パス)
	1. [絶対パスと相対パス](#絶対パスと相対パス)
1. [ファイルシステム](#ファイルシステム)
	1. [パーティション](#パーティション)
	1. [マウントとアンマウント](#マウントとアンマウント)
	1. [ジャーナリング機能](#ジャーナリング機能)
	1. [仮想ファイルシステム](#仮想ファイルシステム)
1. [ハードリンクとシンボリックリンク](#ハードリンクとシンボリックリンク)
1. [Linuxのディレクトリ構造](#linuxのディレクトリ構造)
1. [ファイルとディレクトリ操作のコマンド](#ファイルとディレクトリ操作のコマンド)
	1. [ファイルの一覧取得](#ファイルの一覧取得)


## ファイルとディレクトリ

**ファイル**はコンピュータ上で扱うデータをひとまとまりにしたもので、コンピュータに接続されたHDDやSSD、USBメモリ、CD/DVDなどの記憶装置に保存される。Linuxでは扱われるすべての情報はファイルの形式で保存されている。

**ディレクトリ**は複数のファイルをひとまとまりにするための仕組みで、ディレクトリの下にさらにディレクトリを作るといったツリー構造にすることができる。Linuxではディレクトリはファイルの一種として扱われる。WindowsやMacOSにおいては、Linuxのディレクトリにあたる機能を**フォルダ**と呼ぶ。

**ツリー構造**（**階層構造**）はデータを管理するための構造のひとつで、ファイルをディレクトリにより分類し、ディレクトリ同士に親子関係を持たせたもの。ファイルにはユーザが任意の識別子（ファイル名）をつけることができるが、同じ階層に同じ識別子を持つファイルを作成することはできない。

コンピュータが扱うデータは全て**バイナリデータ**（2進数で表現された情報）となっているが、その役割やユーザ目線での利用方法などによって分類することもできる。

### 実行ファイルとデータファイル

**実行ファイル**（実行可能ファイル）はコンピュータがそのまま解釈して実行することができるファイルのことで、プログラミング言語で書かれたソースコードをコンパイルした結果として得られる。コンピュータにインストールされるアプリケーションは実行ファイルとなっている。Windowsでは実行ファイルの拡張子として `.exe` が用いられるが、Linuxには決められた拡張子が存在しないため、拡張子なしの実行ファイルや `.exe` 以外の拡張子を用いた実行ファイルが存在する。

**データファイル**は実行中のプログラムによって解析されることでコンピュータが処理できるようになるファイル。テキストファイルや画像ファイル、サウンドファイルなどといったアプリケーションにより処理されるファイルなどがこれに含まれる。

実行ファイルもデータファイルもバイナリデータであることには変わりないので、どちらもコンピュータによって実行を試みることはできる。実際に正しく実行できる形式となっているのは実行ファイルだけで、データファイルは実行に失敗する。

### テキストファイルとバイナリファイル

**テキストファイル**は自然言語で記述されたファイルのことで、テキストエディタなどのソフトウェアを使って人間が直接読んだり編集したりできるもの。

**バイナリファイル**はデータを生のバイナリ列として扱うファイルのこと。画像ファイルやサウンドファイルなどはバイナリファイルとして保存される。

テキストファイルもバイナリファイルもバイナリデータであることには変わりないので、テキストエディタからバイナリファイルを開くこともできる。コンピュータ内部ではバイナリデータを文字列に変換して画面に表示しており、変換のための表が用意されている。バイナリファイルであっても何かしらの文字列に置き換えることができるので、テキストエディタ上には人間にとっては意味を持たない文字列が表示される。

### ファイルフォーマットと拡張子

データファイルは実行ファイルによって解釈する必要があり、どのような形式で情報を保存するかはファイルによって異なる。このようなファイルの形式のことを**ファイルフォーマット**といい、アプリケーション独自の形式のものもあれば、複数のアプリケーションが対応できるような一般的なファイルフォーマットもある。画像ファイルであればJPEGやPNG、GIFなどが一般的。

**拡張子**はファイルがどのようなファイルフォーマットで記述されているのかを識別するために、ファイル名の末尾につけられる文字列。ファイル名本体とは `.` で区切られる（例えば、 `tst.txt` であれば `test` がファイル名本体で `.txt` が拡張子）。拡張子は人間がファイルの種類を判別するために用いるだけでなく、OSやアプリケーションによって利用される場合もある。また、拡張子は識別のためのただの文字列であるため、本来のファイルフォーマットを指すものとは異なる拡張子をつけたり、アプリケーションで利用する独自の拡張子をつけたりすることもできる。


## ディレクトリとパス

Linuxをコマンドで操作する際には、ディレクトリ階層を十分に意識する必要がある。これは、現在ユーザがどのディレクトリにいるのか、どのディレクトリを対象としてコマンドを実行するのかによって得られる結果が変わるためである。

あるディレクトリの上の階層にあるディレクトリを**親ディレクトリ**、下にあるディレクトリを**子ディレクトリ**（**サブディレクトリ**）という。

### ルートディレクトリとカレントディレクトリとホームディレクトリ

**ルートディレクトリ**はディレクトリ階層の最上位のディレクトリ。ルートディレクトリは `/` で表される。また、サーバとして外部に公開するディレクトリの最上位を**ドキュメントルート**（**仮想ルートディレクトリ**）という。

**カレントディレクトリ**（**ワーキングディレクトリ**）は現在ユーザがコマンド操作を行っているディレクトリ。カレントディレクトリは `.` で表される。

**ホームディレクトリ**はユーザアカウントごとに割り当てられるディレクトリ。Linuxでは `/home/<username>` がユーザのホームディレクトリとなる。ホームディレクトリは `~` で表される。

### パス

**パス**はファイルやディレクトリの場所を指す情報で、 `/home/user/document/test.txt` のようにディレクトリごとに `/` （**デリミタ**）で区切って記述する。パスはファイルを一意に表す識別子となっており、同じコンピュータ内に同一のパスを持つファイルは存在しない。

現在のディレクトリを指すパスとして `.` 、親ディレクトリを指すパスとして `..` が用いられる。例えば、現在のディレクトリから2つ上のディレクトリのパスは `../..` で表される。

### 絶対パスと相対パス

**絶対パス**はあるファイルやディレクトリのルートディレクトリからのパス。 `/home/user/document` や `/var/www/html/index.html` のように `/` から始まるパスで表される。絶対パスはカレントディレクトリに関わらず常に同じパスで表すことができるという特徴がある。

**相対パス**はカレントディレクトリ（あるいは別のファイルやディレクトリ）から見たときのパス。カレントディレクトリの配下にある `document` ディレクトリを表したいときは `./document` か、単に `document` と書く。カレントディレクトリから2階層上の `document` ディレクトリを表したいときは `../../document` と書く。相対パスは絶対パスに比べて短く住む場合が多く、ディレクトリ構造が変わらなければ同じパスで表すことができるという特徴がある。

絶対パスと相対パスはどちらが優れているということはなく、ケースバイケースで適切なものを選択することが好ましい。カレントディレクトリがどこであっても使えるようにしたいシェルスクリプトには絶対パスを使用するのが良い場合が多く、どの階層に設置するかをユーザにゆだねるアプリケーションのプログラムでは絶対パスに依存すると動作しないため相対パスを用いることが多い。


## ファイルシステム

**ファイルシステム**はファイルが持つデータとそのファイルの名前やメタデータ（作成日や更新日、属性など）を効率よく管理するためにOSが提供する機能。利用するファイルシステムによってファイルにアクセスするときの速度や安全性が異なる。記憶装置上でデータが格納されている場所の管理も行っている。

OSによって対応しているファイルシステムは異なり、Linuxの場合はディストリビューションによっても違いがある。現在は**ext4**がデファクトスタンダードとなっているが、**ext3**や**xfs**などもよく利用されている。

### パーティション

**パーティション**は記憶装置を仮想的に分割した領域のことで、記憶装置を複数のパーティションに分ける操作のことを**パーティショニング**という。パーティションを分けることで複数のファイルシステムを1つのコンピュータ上に混在させたり、通常時に利用するファイルシステムとバックアップ用の領域を切り分けたりすることができる。

### マウントとアンマウント

記憶装置のパーティション上に作成されたファイルシステムをLinux上のどこかのディレクトリに接続することを**マウント**という。反対に、Linux上のマウントされたファイルシステムをディレクトリから切断することを**アンマウント**という。Linux自体のファイルシステムはルートディレクトリにマウントされている。

マウントされていないファイルシステムにはLinuxからアクセスすることができず、マウントすることで読み書き可能な状態となる。ファイルシステムをマウントするディレクトリのことを**マウントポイント**という。

### ジャーナリング機能

**ジャーナリング機能**はファイルに対する編集内容を逐次**ジャーナル**に記録しておき、コンピュータの予期せぬシャットダウンが発生した場合などに復旧できるようにする仕組み。ext3以降のファイルシステムはジャーナリング機能を備えている。

### 仮想ファイルシステム

**仮想ファイルシステム**(VFS: Virtual File System)は、ファイルシステムごとの違いを吸収して共通のインタフェースでファイル操作を行えるようにするための抽象化機能。


## ハードリンクとシンボリックリンク

**リンク**はファイルをコピーしたり移動したりせずに別のディレクトリにあるかのように扱える機能。これによりパス名が長くなることを防いだり、システムの構成の変更にも対応できるようになる。リンクにはハードリンクとシンボリックリンクがある。

**ハードリンク**はファイルの実体を直接指し示して共有する方法。ファイルシステム上ではファイルのメタデータを**iノード**で管理しており、**iノード番号**という固有の番号で実体のデータと紐づけられている。ハードリンクは元のファイルと同じiノード番号を指すリンクであるため、リンク先のファイルが削除されても実体にアクセスできる（参照カウント）。

**シンボリックリンク**（**ソフトリンク**）はリンク先のファイルやディレクトリのパスを記憶する方法で、リンク先のファイルが削除されると無効なリンクとなる。ハードリンクとは異なり、ディレクトリに対するリンクを作成したり、別のファイルシステムに対するリンクを作成することができる。


## Linuxのディレクトリ構造

多くのLinuxディストリビューションは、Linuxの標準的なディレクトリ構造やそれぞれのディレクトリの役割を規定した**FHS**(Filesystem Hierarchy Standard)に準拠している。FHSで定められているディレクトリ構造と各ディレクトリの役割は次のようになっている。

| ディレクトリ       | 説明                                                                                                 |
|--------------------|------------------------------------------------------------------------------------------------------|
| `/`                | ファイルシステムのルートディレクトリ                                                                 |
|     `/bin`         | 一般ユーザ向けの基本コマンドの実行ファイルを格納するディレクトリ                                     |
|     `/boot`        | ブートローダ関連のファイルを格納するディレクトリ                                                     |
|     `/dev`         | デバイスファイル（コンピュータに接続された周辺機器に関するファイル）を格納するディレクトリ           |
|     `/etc`         | 各種プログラムの設定ファイルを格納したディレクトリ                                                   |
|     `/home`        | ユーザごとのホームディレクトリ群を格納したディレクトリ                                               |
|     `/lib`         | `/bin` や `/sbin` にある実行ファイルに紐づけられた共有ライブラリを格納したディレクトリ               |
|     `/lost+found`  | 予期しないシャットダウンなどにより破損したファイルなどの断片が格納されるディレクトリ                 |
|     `/media`       | 外部メディアが接続された際にOSによって自動的にマウンティングされるディレクトリを格納したディレクトリ |
|     `/mnt`         | 一時的なファイルシステムのマウントなどに用いるディレクトリで、ユーザが手動でマウントを行う           |
|     `/opt`         | パッケージマネージャを使わずにインストールしたアプリケーションなどが格納されるディレクトリ           |
|     `/proc`        | カーネルやプロセスの状態に関する情報を格納するディレクトリ                                           |
|     `/root`        | rootユーザのホームディレクトリ                                                                       |
|     `/run`         | 実行中のプログラムのPIDファイルなどを格納するディレクトリ                                            |
|     `/sbin`        | システム管理用のコマンドの実行ファイルを格納するディレクトリ                                         |
|     `/srv`         | サービスを提供する際のデータを格納するディレクトリ                                                   |
|     `/sys`         | デバイスやドライバについての情報を格納するディレクトリ                                               |
|     `/tmp`         | 一時ファイルの置き場として利用されるディレクトリ                                                     |
|     `/usr`         | システム以外の全ユーザが共通して利用するプログラムやライブラリを格納するディレクトリ                 |
|         `/bin`     | ユーザが利用するコマンドを格納するディレクトリ                                                       |
|         `/include` | ユーザ空間のソースコードをコンパイルするのに必要なヘッダファイルを格納するディレクトリ               |
|         `/lib`     | `/usr/bin` にある実行ファイルに紐づけられた共有ライブラリを格納したディレクトリ                      |
|         `/share`   | アイコンやフォントなど、アーキテクチャに依存しない共有う可能なファイルを格納したディレクトリ         |
|         `/src`     | ソースコードを格納するためのディレクトリ                                                             |
|         `/local`   | ホスト固有のローカルデータを格納する第三階層（ `bin` や `lib` 、 `share` などを持つ）                |
|     `/var`         | ログやメールなどの可変ファイルを格納する為のディレクトリ                                             |
|         `/cache`   | キャッシュファイルを格納するディレクトリ                                                             |
|         `/log`     | 各種ログファイルを格納するディレクトリ                                                               |
|         `/mail`    | ユーザのメールボックスとして利用されるディレクトリ                                                   |
|         `/spool`   | 処理待ち状態のタスクのスプールを格納するディレクトリ                                                 |
|         `/tmp`     | 一時ファイルの置き場として利用されるディレクトリ                                                     |
|         `/www`     | 慣習的にWebコンテンツを格納するために利用されるディレクトリ                                          |


## ファイルとディレクトリ操作のコマンド

### ファイルの一覧取得
