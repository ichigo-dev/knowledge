# 『バックアップ』ノート

（最終更新： 2023-10-21）


## 目次

1. [バックアップの種類](#バックアップの種類)
	1. [論理バックアップ](#論理バックアップ)
	1. [物理バックアップ](#物理バックアップ)
	1. [PITR](#pitr)
1. [バックアップの設計](#バックアップの設計)
	1. [RPO](#rpo)


## バックアップの種類

### 論理バックアップ

**論理バックアップ**（**ホットバックアップ**）は、[データベース](./database.md#データベース)のバックアップ手法のひとつで、[SQL](./sql.md#sql)やCSVとして、[データベース](./database.md#データベース)そのものを再構成できるようにバックアップを取る方法。[MySQL](./database.md#dbms)であれば `mysqldump` 、[PostgreSQL](./database.md#dbms)であれば `pg_dump` などの[コマンド](../../../../computer/linux/_/chapters/basic_command.md#コマンド)により実施できる。実体がテキストファイルであるため、中身を読んだり編集したりすることが可能であったり、バージョンが異なっても復旧できるといったメリットがあるが、ファイルサイズが大きくなりやすい点やバックアップ時間が長い点には注意が必要。

### 物理バックアップ

**物理バックアップ**（**コールドバックアップ**）は、[データベース](./database.md#データベース)のバックアップ手法のひとつで、[データベース](./database.md#データベース)の物理[ファイル](../../../../computer/software/_/chapters/file_system.md#ファイル)をまるごとバックアップする方法。[OS](../../../../computer/software/_/chapters/operating_system.md#オペレーティングシステム)の[cp](../../../../computer/linux/_/chapters/basic_command.md#ファイルのコピー)や `rsync` [コマンド](../../../../computer/linux/_/chapters/basic_command.md#コマンド)により実施できる。最小限のサイズで保存できたり、バックアップにかかる時間が短いなどのメリットがあるが、[論理バックアップ](#論理バックアップ)ほどの柔軟性はない。

### PITR

**PITR**(Pint In Time Recovery)は、[データベース](./database.md#データベース)のバックアップ手法のひとつで、バックアップファイルと[バイナリログ](./database.md#マスタ)の組合せで、[データベース](./database.md#データベース)を任意の時点まで復元する方法。バックアップサイズが大きく、復旧の手順も複雑になるものの、予期しない[クエリ](./sql.md#クエリ)が実行されたり、[データベース](./database.md#データベース)の[サーバ](../../../../computer/_/chapters/computer.md#サーバ)が急に停止したような場合には有効。


## バックアップの設計

### RPO

**RPO**（**目標復旧時点**、Recovery Point Objective）は、[データベース](./database.md#データベース)のバックアップ設計の要素のひとつで、障害が発生したときにいつの時点のデータを復旧するかの指針。バックアップを取る頻度の目安にもなる。

[データベース](./database.md#データベース)を任意の状態に戻すには、フルバックアップとそれ以降の更新履歴が入っている[バイナリログ](./database.md#マスタ)を保持しておき、[PITR](#pitr)を利用する必要がある。

### RTO

**RTO**（**目標復旧時間**、Recovery Time Objective）は、[データベース](./database.md#データベース)のバックアップ設計の要素のひとつで、障害が発生してから目標の状態へ復旧するまでの時間の指針。多少データを失ってもサービスの復旧を優先する場合には、[PITR](#pitr)ではなく[物理バックアップ](#物理バックアップ)の復元を行う、といった方針決定の基準となる。

### RLO

**RLO**（**目標復旧レベル**、Recovery Level Objective）は、[データベース](./database.md#データベース)のバックアップ設計の要素のひとつで、障害が発生した場合に、実際にどこまで復旧させるかの指針。どのレベルまで復旧させた時点でサービスの提供を再開するかを示す目標値で、平常時の稼働状態が100%であると考えたときに、何%の割合で再開するかを決定する基準となる。

一般的な業務では頻繁に利用しない機能の復旧は後回しにする、別の形で保存されている（出力されたCSVデータや紙のデータなど）場合は優先度を下げる、という具合に検討する。
