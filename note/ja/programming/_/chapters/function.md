# 『関数』ノート

（最終更新： 2023-04-03）


## 目次

1. [関数](#関数)
	1. [引数](#引数)
	1. [戻り値](#戻り値)
	1. [関数定義](#関数定義)
	1. [関数呼び出し](#関数呼び出し)
	1. [関数プロトタイプ宣言](#関数プロトタイプ宣言)
	1. [副作用](#副作用)
	1. [冪等性](#冪等性)
1. [シグネチャ](#シグネチャ)
1. [標準関数](#標準関数)
1. [無名関数](#無名関数)
1. [高階関数](#高階関数)
	1. [コールバック関数](#コールバック関数)
1. [再帰関数](#再起関数)
1. [カリー化](#カリー化)


## 関数

**関数**（**サブルーチン**、**手続き**、**プロシージャ**）は、データを受け取り、定められた特定の処理を実行して、その結果を返す命令[ブロック](./control_flow.md#ブロック)。関数には[プログラマ](./programming.md#プログラマ)が任意の[識別子](./programming.md#識別子)をつけることができる（ `main` 関数のような特別な意味を持つ関数については除く）。関数につけられた[識別子](./programming.md#識別子)を[ソースコード](./programming.md#ソースコード)中に記すことで、その命令[ブロック](./control_flow.md#ブロック)を呼び出すことができる。

関数を用いることで、[プログラム](./programming.md#プログラム)の再利用性やメンテナンス性が向上するという利点がある。

### 引数

**引数**（**パラメータ**）は、[関数](#関数)が呼び出されるときに、[関数](#関数)の呼び出し元から受け取るデータ。[関数](#関数)を定義する際には、受け取る情報に任意の[識別子](./programming.md#識別子)を用いた**仮引数**を用いて処理を記述する。[関数呼び出し](#関数呼び出し)の際に実際に処理したい情報を**実引数**として[関数](#関数)に渡すことで、仮引数部分がデータに置き替えられて処理が実行される。

引数は複数受け取ることも可能。また、仮引数にデフォルト値を指定しておくことで、[関数呼び出し](#関数呼び出し)の際に実引数を渡さなかった場合にデフォルト値で置き替えて処理を実行することもできる。このような引数を**オプション引数**（**デフォルト引数**、**任意引数**）という。[関数定義](#関数定義)の際に引数を固定せず、呼び出し側で任意の数の引数を渡して処理を実行するような、**可変長引数**をサポートしている言語もある（文字列のフォーマットなどによく利用される）。

### 戻り値

**戻り値**は、[関数](#関数)の命令[ブロック](./control_flow.md#ブロック)が実行された結果として、[関数](#関数)の呼び出し元に返されるデータ。[関数](#関数)の戻り値は `return` キーワードを用いて記述する。戻り値は通常1つしか返すことができないため、複数の値を返したいような場合には、値を[オブジェクト](./object_oriented.md#オブジェクト)として返却したり、[引数](#引数)として受け取った[ポインタ](./data_type.md#ポインタ型)に直接結果を書き込んだりする。

[関数](#関数)内部で[宣言](./variable.md#宣言)された[ローカル変数](./variable.md#ローカル変数)は、[関数](#関数)の処理[ブロック](./control_flow.md#ブロック)内部のみで有効な[変数](./variable.md#変数)であり、戻り値として使用するには注意が必要となる。戻り値として返却されるデータが[プリミティブ型](./data_type.md#プリミティブ型)の場合はデータが[ディープコピー](./data_type.md#ディープコピー)されるが、[複合型](./variable.md#複合型)の値を返却しようとした場合に[シャローコピー](./data_type.md#シャローコピー)が発生する可能性がある。このような場合、[ローカル変数](./variable.md#ローカル変数)は[関数](#関数)の実行が終了されると破棄されるため、戻り値が[ダングリングポインタ](./programming_language.md#ダンリングポインタ)となってしまう場合がある。そのため、明示的に確保した[メモリ](../../../computer/hardware/_/chapters/memory.md#メモリ)に格納したデータの[ポインタ](./data_type.md#ポインタ型)を返却したり、[引数](#引数)として受け取った[ポインタ](./data_type.md#ポインタ型)に直接データを格納したりといった工夫が必要となる。

### 関数定義

**関数定義**には、[関数](#関数)につけられた[識別子](./programming_language.md#識別子)、処理内容、[仮引数](#引数)リスト、[戻り値](#戻り値)を記述する。

```c
// C言語

// 関数定義
int add( int a_, int b_ )
{
    int result = a_ + b_;
    return result;
}
```

```php
<?php

// PHP

// 関数定義
function add( $a_, $b_ )
{
    $result = $a_ + $b_;
    return $result;
}

?>
```

```javascript
// JavaScript

function add( a_, b_ )
{
    let result = a_ + b_;
    return result;
}
```

### 関数呼び出し

**関数呼び出し**（**コール**、**キック**）では、[関数](#関数)の[識別子](./programming.md#識別子)を記述して処理を引用し、[仮引数](#引数)リストに対応した[実引数](#引数)を渡す。

```c
// C言語

// 関数プロトタイプ宣言
int add( int, int );

// メイン関数
int main()
{
    int a = 5;
    int b = 10;

    // 関数呼び出し
    int result = add(a, b);
    printf("Result: %d\n", result);

    return 0;
}

// 関数定義
int add( int a_, int b_ )
{
    int result = a_ + b_;
    return result;
}
```

```php
<?php

// PHP

// 関数定義
function add( $a_, $b_ )
{
    $result = $a_ + $b_;
    return $result;
}

$a = 5;
$b = 10;

// 関数呼び出し
$result = add($a, $b);
echo("Result: " . $result);

?>
```

```javascript
// JavaScript

// 関数定義
function add( a_, b_ )
{
    let result = a_ + b_;
    return result;
}

let a = 5;
let b = 10;

// 関数呼び出し
let result = add(a, b);
console.log("Result: " + result);
```

### 関数プロトタイプ宣言

**関数プロトタイプ宣言**は、[関数](#関数)を[ソースコード](./programming.md#ソースコード)の冒頭で宣言しておき、後から具体的な[関数定義](#関数定義)を行う記法。[C言語](./programming_language.md#c言語)などにおいては、[関数呼び出し](#関数呼び出し)よりも前に[関数](#関数)の存在が明示されている必要があるため、[関数呼び出し](#関数呼び出し)を含む部分を[関数定義](#関数定義)よりも前に記述したい場合に用いる。

### 副作用

**副作用**は、[関数](#関数)が[関数](#関数)外の[プログラム](./programming.md#プログラム)上のデータを変化させる性質。

### 冪等性

**冪等性**は、同じ[関数](#関数)を繰り返し呼び出しても同じ結果が得られるという性質。


## シグネチャ

**シグネチャ**は、[関数](#関数)や[メソッド](./object_oriented.md#メソッド)の名前、[引数](#引数)の数やデータ[型](./data_type.md#型)、[戻り値](#戻り値)の[型](./data_type.md#型)などの組み合わせ。[オブジェクト指向](./object_oriented.md#オブジェクト指向)の[プログラミング言語](./programming.md#プログラミング言語)において[クラス](./object_oriented.md#クラス)のインタフェースを定義する際などに用いられる。


## 標準関数

**標準関数**（**組込み関数**）は、各[プログラミング言語](./programming.md#プログラミング言語)の仕様としてあらかじめ用意されている[関数](#関数)。使い方は通常の[関数](#関数)と同様で、仕様として定義されているため、[プログラマ](./programming.md#プログラマ)が定義し実装する必要はない。用意されている[関数](#関数)の詳細については、各[プログラミング言語](./programming.md#プログラミング言語)のドキュメントなどを参照する必要がある。


## 無名関数

**無名関数**（**クロージャ**）は、[識別子](./programming.md#識別子)を持たない[関数](#関数)。**ラムダ式**を用いて、[関数](#関数)を[変数](./variable.md#変数)に格納したり、[高階関数](#高階関数)の[引数](#引数)として渡したりすることができる。


## 高階関数

**高階関数**は、[関数](#関数)の[引数](#引数)や[戻り値](#戻り値)として[関数](#関数)を用いるような[関数](#関数)。

### コールバック関数

**コールバック関数**は、[高階関数](#高階関数)の[引数](#引数)としてとられる[関数](#関数)。[高階関数](#高階関数)の呼び出し元が定義した[関数](#関数)を、[高階関数](#高階関数)の処理の中から呼び出し返すことからコールバックと呼ばれる。

例えば、非同期処理を扱う[高階関数](#高階関数)に、非同期操作が完了した後に行いたい処理をコールバックとして渡しておくといった使い方がある（**非同期コールバック**）。


## 再帰関数

**再帰関数**は、ある[関数](#関数)の内部でその[関数](#関数)自身を呼び出す（再帰呼び出し）ような[関数](#関数)。例えば、 `0` から[引数](#引数)として受け取った整数までの総和を求める[関数](#関数)などに用いられる。呼び出される側でどれほど処理を繰り返せばいいかわからない場合や、[引数](#引数)として受け取るデータの階層が不明な場合などに再帰関数を用いることで、実装がシンプルになったりする。

再帰関数を実装する場合には、再帰呼び出しを停止する条件を考慮する必要がある。再帰呼び出しを打ち切る条件が満たされないような実装になると、無限ループが発生してしまう。また、無限ループでなくとも、再帰呼び出しされる回数が多いとスタックオーバフローが発生してしまう可能性がある。

よくある再帰関数の実装は次のような形式となっている。[関数](#関数)内部で再帰呼び出しを行っており、**ベースケース**の条件に合致した段階で再帰呼び出しが停止する。ベースケースに達すると、再帰的に呼び出された[関数](#関数)に結果を返却していき、最終的な結果が呼び出し元に返される。

```javascript
function example_func( 引数 )
{
    if( ベースケース )
    {
        return ベースケースに対する値;
    }

    // 再帰呼び出し
    example_func();
    return 結果;
}
```


## カリー化

**カリー化**は、複数の[引数](#引数)をとる[関数](#関数)があったときに、いくつかの[引数](#引数)を共通化して、内部で元の[関数](#関数)を呼び出すような新しい[関数](#関数)をつくること。カリー化した[関数](#関数)を用いることで、元の[関数](#関数)に渡す[引数](#引数)の一部を省略することができ、[ソースコード](./programming.md#ソースコード)をシンプルに保つことができる。
