# 『シェル』ノート

（最終更新： 2023-03-05）


## 目次

1. [シェル](#シェル)
	1. [ログインシェル](#ログインシェル)
	1. [プロンプト](#プロンプト)
	1. [sh](#sh)
	1. [bash](#bash)
	1. [ash](#ash)
	1. [zsh](#zsh)
	1. [csh](#csh)
	1. [tcsh](#tcsh)
1. [シェルの操作](#シェルの操作)
	1. [補間機能](#補間機能)
	1. [インクリメンタルサーチ](#インクリメンタルサーチ)
1. [コマンド](#コマンド)
	1. [サブコマンド](#サブコマンド)
	1. [オプション](#オプション)
1. [ターミナル](#ターミナル)
	1. [ターミナルエミュレータ](#ターミナルエミュレータ)


## シェル

**シェル**は、ユーザとLinuxカーネルの橋渡しをするプログラムで、カーネルの機能をユーザに提供するためのインタフェース。シェルはまず、キーボードに入力されたユーザのコマンドを受け取り、カーネルに対して処理命令を行う。そして、カーネルの処理結果を受け取ってそれをユーザに提供する。シェルは、このようなやり取りを繰り返すインタラクティブな操作を提供する。

Linuxカーネルとシェルのレイヤを分離することにより、カーネルには手を入れずにシェルのみをユースケースに合わせて変更することができたり、別のOSを利用する際にシェルのみ移植すれば操作を同様に行える、といった利点がある。

### ログインシェル

**ログインシェル**は、ユーザがログイン時に最初にLinuxによって自動的に起動されるシェル。ログインシェルは、 `SHELL` 環境変数に指定されたコマンドで起動されるものとなる。ログインシェルを変更するには、 `chsh` コマンドを使用する。

```sh
# ログインシェルの確認
$ echo $SHELL
/bin/bash

# 利用できるシェルを一覧表示
$ chsh --list-shells
/bin/sh
/bin/bash
/usr/bin/git-shell
/bin/zsh
/usr/bin/zsh
/bin/rbash
/usr/bin/rbash

# ログインシェルの変更
$ chsh
Changing shell for user.
Password:
New shell [/bin/bash]: /bin/zsh
Shell changed.
```

### プロンプト

**プロンプト**は、シェルがユーザの入力を受け付けている状態を示す記号。多くの場合は `$` や `#` で表わされ、さらにログイン中のユーザ名やホスト名、カレントディレクトリなどの付加情報を表示する場合もある。プロンプトの表示は、シェルの設定によりユーザが任意に変更することもできる。

Ubuntuのデフォルトのプロンプトは以下の通り。（ユーザ名が `user` 、ホスト名が `host` の場合）

```sh
user@host:~$
```

プロンプト記号の `$` は一般ユーザでの操作、 `#` はスーパユーザでの操作を例示しているドキュメントが多い。

### sh

**sh**(Bourne Shell)は、多くのUNIX系OSで標準的に使われているシェルのひとつで、古くからあり多くのシェルがshとの互換性を持っている。

### bash

**bash**(Bourne-Again Shell)は、GNUで開発されているオープンソースのシェル。sh互換だが様々な機能が追加されており、一時期はMacOSのシェルとしても採用されていた。多くのLinux環境でデフォルトのシェルとして採用されており、利用者が多いため情報を集めやすい。

### ash

**ash**(Almquist Shell)は、軽量かつ高速なsh互換のシェルで、Debian系のLinuxディストリビューションで利用されている。

### zsh

**zsh**(Z Shell)は、他のシェルの便利な機能を持ちつつ独自に進化しているsh互換でオープンソースのシェル。MacOSのデフォルトのシェルとしても採用されている。

### csh

**csh**(C Shell)は、BSD系のOSで使用されているシェルで、shとは異なり文法がC言語風となっている。

### tcsh

**tcsh**(TENEX C Shell)は、cshを拡張したオープンソースのシェルで、MacOSで採用されていたこともあったが、シェルスクリプトの記述には向いていないとされている。


## シェルの操作

シェルにはデフォルトで様々なキーバインドが設定されており、できるだけホームポジションから手を離さずに様々な操作ができるようになっている。シェルによっては対応していないものや、別のキーバインドが設定されているものもあるので注意。

| キーマップ   | 内容                                     |
| ------------ | :--------------------------------------- |
| `Ctrl` + `b` | 後方に1文字分移動する                    |
| `Ctrl` + `f` | 前方に1文字分移動する                    |
| `Ctrl` + `a` | 行頭に移動する                           |
| `Ctrl` + `e` | 行末に移動する                           |
| `Alt` + `b`  | 後方に単語1つ分移動する                  |
| `Alt` + `f`  | 前方に単語1つ分移動する                  |
| `Ctrl` + `h` | カーソル位置の後方に1文字削除する        |
| `Ctrl` + `d` | カーソル位置の1文字を削除する            |
| `Ctrl` + `w` | 後方にスペース区切りで1単語分を削除する  |
| `Ctrl` + `k` | カーソル位置から行末までを削除する       |
| `Ctrl` + `u` | カーソル位置から行頭までを削除する       |
| `Ctrl` + `y` | 最後に削除した内容を挿入する             |
| `Ctrl` + `s` | 画面表示をロックする                     |
| `Ctrl` + `q` | 画面表示のロックを解除する               |
| `Ctrl` + `c` | 実行中のコマンドを強制終了する           |
| `Ctrl` + `l` | 画面を消去する                           |
| `Ctrl` + `p` | 1つ前のコマンド履歴に移動する            |
| `Ctrl` + `n` | 1つ後のコマンド履歴に移動する            |
| `Ctrl` + `r` | コマンド履歴をインクリメンタルサーチする |

### 補間機能

多くのシェルでは、 `Tab` キーを押下することで補間機能が利用できる。途中まで入力したコマンドや、パスの候補をシェルが自動で入力してくれる。また、複数の候補がある場合には、その候補を画面上に出力してくれる。

### インクリメンタルサーチ

**インクリメンタルサーチ**は、キーボードから1文字入力するごとにコマンド履歴を検索する機能。インクリメンタルサーチモード中は、次のようなキーバインドが利用できる。

| キーマップ   | 内容                                               |
| ------------ | :------------------------------------------------- |
| `Ctrl` + `r` | 1つ前の検索結果へ移動                              |
| `Enter`      | 現在の検索結果をそのまま実行                       |
| `Esc`        | 現在の検索結果を表示したまま、コマンドラインに戻る |
| `Ctrl` + `g` | 検索結果を破棄し、プロンプトに戻る                 |


## コマンド

**コマンド**は、ユーザがシェルに対して与える命令。

### サブコマンド

**サブコマンド**は、様々な機能をまとめたコマンドに対して、具体的な操作の種類を指定する命令。第一コマンドに続けて指定する。

### オプション

**オプション**（**引数**、**フラグ**、**パラメータ**）は、コマンドの操作対象や処理内容の詳細を指定する部分。オプションの形式はコマンドによって異なるが、 `-` から始まる**ショートオプション**や、 `--` から始まる**ロングオプション**などが一般的。


## ターミナル

**ターミナル**（**端末**）は、ユーザがコンピュータへ入出力する際に利用するハードウェアを指す言葉。入力装置にはキーボード、出力装置にはディスプレイが主に用いられる。

ターミナルエミューレタのことを単にターミナルと呼ぶ場合もある。

### ターミナルエミュレータ

**ターミナルエミュレータ**は、ターミナルをソフトウェアによって再現したもの。入出力画面を提供するインタフェースで、シェルはターミナルエミュレータ上で動作する。代表的なターミナルエミュレータとしては、WindowsのTeraTermやRLogin、macOSのiTerm2、各環境で動作するAlacrittyなどがある。

遠隔のコンピュータを操作する場合、接続元ではターミナルエミュレータが、接続先ではシェルが動作することになる。
