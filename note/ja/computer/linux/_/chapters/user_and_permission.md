# 『ユーザと権限』ノート

（最終更新： 2023-03-12）


## 目次

1. [ユーザ](#ユーザ)
	1. [ユーザ名の確認](#ユーザ名の確認)
	1. [ユーザ情報の確認](#ユーザ情報の確認)
	1. [ユーザの作成](#ユーザの作成)
	1. [ユーザの変更](#ユーザの変更)
	1. [ユーザの削除](#ユーザの削除)
	1. [ユーザパスワードの変更](#ユーザパスワードの変更)
1. [グループ](#グループ)
	1. [メイングループ](#メイングループ)
	1. [サブグループ](#サブグループ)
	1. [所属グループの確認](#所属グループの確認)
	1. [グループの作成](#グループの作成)
	1. [グループの変更](#グループの変更)
	1. [グループの削除](#グループの削除)
1. [所有者](#所有者)
	1. [所有者の確認](#所有者の確認)
	1. [所有者の変更](#所有者の変更)
	1. [ファイルのグループの変更](#ファイルのグループの変更)
1. [権限](#権限)


## ユーザ

**ユーザ**は、Linuxシステムにログインしてシステムを使用するためのアカウント。各ユーザには一意のユーザ名が割り当てられており、各ユーザはそれぞれのホームディレクトリを持つ。ユーザはシステム上で一意のUIDが設定されている。

ユーザが作成したファイルやディレクトリの所有者は、そのユーザ自身となる。

Linuxでは、ファイルやディレクトリに対するアクセス権を、ユーザごとにコントロールできる。

### ユーザ名の確認

`whoami` は、Linux上で現在ログインしているユーザのユーザ名を確認するためのコマンド。

コマンドの書式は以下の通り。

```
whoami [OPTION]...
```

### ユーザ情報の確認

`id` は、Linux上で現在ログインしているユーザの情報を表示するためのコマンド。ユーザ名、ユーザID、所属するグループ名、グループIDといった情報を表示できる。

コマンドの書式は以下の通り。

```
id [OPTION]... [USER]...
```

### ユーザの作成

`useradd` は、Linux上で新しいユーザを作成するためのコマンド。

コマンドの書式は以下の通り。

```
useradd [OPTION]... LOGIN
useradd -D
useradd -D [OPTION]...
```

例えば以下のコマンドを実行すると、新しいユーザアカウント `foo` を作成できる。

```sh
$ useradd foo
```

また、上記のコマンドを実行すると、 `/home/foo` ディレクトリが作成され、 `foo` ユーザがこのディレクトリを所有する。ただし、この時点ではパスワードが設定されていないため、ユーザはログインできない。パスワードを設定するには、以下のコマンドを実行する必要がある。

```sh
$ passwd foo
```

### ユーザの変更

`usermod` は、Linux上で既存のユーザアカウントを変更するためのコマンド。主に以下のようなユーザアカウント情報を変更するために使用される。

- ユーザ名
- ユーザパスワード
- ユーザの所属するグループ
- ユーザアカウントの有効期限

コマンドの書式は以下の通り。

```
usermod [OPTION]... LOGIN
```

例えば、ユーザ `foo` のホームディレクトリを `/home/bar` に変更する場合は、以下のコマンドを実行する。

```sh
$ usermod --home /home/bar foo
```

ユーザ `foo` のメイングループを `foo` から `bar` に変更する場合は、以下のコマンドを実行する。

```sh
$ usermod -g bar foo
```

ユーザ `foo` をサブグループ `hoge` に追加する場合は、以下のコマンドを実行する。

```sh
$ usermod -aG hoge foo
```

`usermod` コマンドはroot権限を持つユーザが実行する必要がある。

### ユーザの削除

`userdel` は、Linux上でユーザを削除するためのコマンド。

コマンドの書式は以下の通り。

```
userdel [OPTION]... LOGIN
```

例えば、ユーザ名が `foo` のユーザを削除するには、以下のコマンドを実行する。

```sh
$ userdel foo
```

このコマンドの実行により、 `foo` はシステムから完全に削除されるが、ホームディレクトリやメールボックスといったユーザデータは削除されない。これらのデータを削除するには、 `-r` オプションを指定する。

`userdel` コマンドはroot権限を持つユーザが実行する必要がある。

### ユーザパスワードの変更

`passwd` は、Linuxでユーザのパスワードを変更するために使用されるコマンド。

コマンドの書式は以下の通り。

```
passwd [OPTION]... LOGIN
```

例えば、ユーザ名が `foo` のユーザのパスワードを変更するには、以下のコマンドを実行する。

```sh
$ passwd foo
```

`passwd` コマンドを実行すると、プロンプトでパスワードの入力が要求される。

`passwd` コマンドはroot権限を持つユーザが実行する必要がある。


## グループ

**グループ**は、複数のユーザをひとまとめにする機能で、アクセス権限の設定やファイルの所有権管理などに利用される。グループを利用することで、Linux上のファイルやディレクトリに対するアクセス権をまとめてコントロールすることができる。

ユーザは必ずひとつのメイングループに所属しており、任意の数のサブグループに所属することができる。また、ファイルやディレクトリも必ずひとつのグループに所属している。

### メイングループ

**メイングループ**は、ユーザが必ずひとつ所属するグループで、通常はユーザ名と同名のグループが自動的に作成され、そのグループがメイングループとして割り当てられる。例えば、 `foo` というユーザを作成した時、そのユーザは `foo` というメイングループに所属する。

ユーザが作成したファイルやディレクトリの所有グループには、メイングループがデフォルトで割り当てられる。

### サブグループ

**サブグループ**は、ユーザが任意の数所属することができるグループ。複数のユーザが同じサブグループに所属することで、そのグループが所有者となっているファイルやディレクトリに対するアクセス権をまとめて設定できる。

### 所属グループの確認

`groups` は、Linux上のユーザの所属グループリストを確認するためのコマンド。

コマンドの書式は以下の通り。

```
groups [USER]
```

### グループの作成

`groupadd` は、Linux上で新しいグループを作成するためのコマンド。

コマンドの書式は以下の通り。

```
groupadd [OPTION]... NEWGROUP
```

例えば、新しいグループ `hoge` を作成する場合は、以下のコマンドを実行する。

```sh
$ groupadd hoge
```

`groupadd` コマンドはroot権限を持つユーザが実行する必要がある。

### グループの変更

`groupmod` は、Linux上で既存のグループの属性を変更するためのコマンド。主に以下のようなグループ情報を変更するために使用される。

- グループID
- グループ名
- グループパスワード

コマンドの書式は以下の通り。

```
groupmod [OPTION]... GROUP
```

例えば、グループ名が `hoge` のグループのグループ名を `fuga` に変更するには、以下のコマンドを実行する。

```sh
$ groupmod -n fuga hoge
```

### グループの削除

`groupdel` は、Linux上でグループを削除するためのコマンド。

コマンドの書式は以下の通り。

```
groupdel [OPTION]... GROUP
```

例えば、グループ名 `hoge` のグループを削除する場合は、以下のコマンドを実行する。

```sh
$ groupdel hoge
```

ただし、グループに所属するユーザがいる場合は、そのユーザを他のグループに移動させるか、ユーザ自身を削除する必要がある。


## 所有者

**所有者**（**オーナー**）は、Linuxにおいてファイルやディレクトリに割り当てられる、そのファイルやディレクトリの持ち主。また、ファイルやディレクトリは必ずひとつのグループに所属している。通常は、そのファイルやディレクトリを作成したユーザが所有者となり、そのユーザのメイングループがファイルやディレクトリのグループとなる。

### 所有者の確認

Linuxでファイルやディレクトリの所有者や所属グループを確認するには、 `ls` コマンドに `-l` オプションを付与して実行する。

### 所有者の変更

`chown` は、Linux上でファイルやディレクトリの所有者を変更するためのコマンド。 `chown` は "change owner"の略語。

コマンドの書式は以下の通り。

```
chown [OPTION]... [OWNER][:[GROUP]] FILE...
chown [OPTION]... --reference=RFILE FILE...
```

例えば、ファイル `test.txt` の所有者を `foo` に変更する場合は、以下のコマンドを実行する。

```sh
$ chown foo test.txt
```

また、所有者とグループを同時に変更する場合は、 `-R` オプションを付与して次のようにコマンドを実行する。

```sh
$ chown -R foo:group test.txt
```

### ファイルのグループの変更

`chgrp` は、Linux上でファイルやディレクトリの所属グループを変更するコマンド。

コマンドの書式は以下の通り。

```
chgrp [OPTION]... GROUP FILE...
chgrp [OPTION]... --reference=RFILE FILE...
```

例えば、 `test.txt` の所属グループを `hoge` に変更する場合は、以下のコマンドを実行する。

```sh
$ chgrp hoge test.txt
```


## 権限

**権限**（**パーミッション**）は、Linuxにおいてファイルやディレクトリなどのアクセス制御を行うための機能。各ファイルやディレクトリには3種類の権限がある。

| 権限         | 概要                                                |
| ------------ | :-------------------------------------------------- |
| ユーザ権限   | ファイルやディレクトリの所有者が持つ権限            |
| グループ権限 | ファイルやディレクトリの所属するグループが持つ権限 |
| 全体権限     | それ以外の第三者が持つ権限                          |

通常、ユーザ権限やグループ権限は高く設定しておき、全体権限は最低限に抑える。

また、これらの権限に対して次の3つのアクションに対する許可設定を行う。

| アクション          | ファイル               | ディレクトリ                        |
| ------------------- | :--------------------- | :---------------------------------- |
| 読み取り権限(read)  | ファイルの内容を表示   | ディレクトリ内のリスト表示         |
| 書き込み権限(write) | ファイルの上書き、変更 | ディレクトリ内にファイル作成、削除 |
| 実行権限(execute)   | 実行ファイルの実行     | そのディレクトリに移動             |

また、これらのアクションにはそれぞれ以下のようなシンボルと数値が割り当てられている。

| アクション   | シンボル | 数値 |
| ------------ | -------- | ---- |
| 読み取り権限 | `r`      | `4`  |
| 書き込み権限 | `w`      | `2`  |
| 実行権限     | `x`      | `1`  |
