# 『ユーザと権限』ノート

（最終更新： 2023-03-26）


## 目次

1. [ユーザ](#ユーザ)
	1. [ユーザ名の確認](#ユーザ名の確認)
	1. [ユーザ情報の確認](#ユーザ情報の確認)
	1. [ユーザの作成](#ユーザの作成)
	1. [ユーザの変更](#ユーザの変更)
	1. [ユーザの削除](#ユーザの削除)
	1. [ユーザパスワードの変更](#ユーザパスワードの変更)
1. [グループ](#グループ)
	1. [メイングループ](#メイングループ)
	1. [サブグループ](#サブグループ)
	1. [所属グループの確認](#所属グループの確認)
	1. [グループの作成](#グループの作成)
	1. [グループの変更](#グループの変更)
	1. [グループの削除](#グループの削除)
1. [所有者](#所有者)
	1. [所有者の確認](#所有者の確認)
	1. [所有者の変更](#所有者の変更)
	1. [ファイルのグループの変更](#ファイルのグループの変更)
1. [権限](#権限)
	1. [権限の確認](#権限の確認)
	1. [権限の変更](#権限の変更)
1. [rootユーザ](#rootユーザ)
	1. [rootユーザへの切り替え](#rootユーザへの切り替え)
	1. [rootユーザとしてコマンド実行](#rootユーザとしてコマンド実行)


## ユーザ

**ユーザ**は、[Linux](./linux.md#linux)システムにログインしてシステムを使用するためのアカウント。各ユーザには一意のユーザ名が割り当てられており、各ユーザはそれぞれの[ホームディレクトリ](../../../software/_/chapters/file_system.md#ホームディレクトリ)を持つ。ユーザはシステム上で一意の**UID**によって識別される。

ユーザが作成した[ファイル](../../../software/_/chapters/file_system.md#ファイル)や[ディレクトリ](../../../software/_/chapters/file_system.md#ディレクトリ)の所有者は、そのユーザ自身となる。

[Linux](./linux.md#linux)では、[ファイル](../../../software/_/chapters/file_system.md#ファイル)や[ディレクトリ](../../../software/_/chapters/file_system.md#ディレクトリ)に対する[アクセス権](#権限)を、ユーザごとにコントロールできる。

### ユーザ名の確認

`whoami` は、[Linux](./linux.md#linux)上で現在ログインしている[ユーザ](#ユーザ)の[ユーザ](#ユーザ)名を確認するための[コマンド](./basic_command.md#コマンド)。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
whoami [OPTION]...
```

### ユーザ情報の確認

`id` は、[Linux](./linux.md#linux)上で現在ログインしている[ユーザ](#ユーザ)の情報を表示するための[コマンド](./basic_command.md#コマンド)。[ユーザ](#ユーザ)名、[UID](#ユーザ)、所属する[グループ](#グループ)名、[GID](#グループ)といった情報を表示できる。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
id [OPTION]... [USER]...
```

### ユーザの作成

`useradd` は、[Linux](./linux.md#linux)上で新しい[ユーザ](#ユーザ)を作成するための[コマンド](./basic_command.md#コマンド)。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
useradd [OPTION]... LOGIN
useradd -D
useradd -D [OPTION]...
```

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、新しい[ユーザ](#ユーザ)アカウント `foo` を作成できる。

```sh
$ useradd foo
```

また、上記の[コマンド](./basic_command.md#コマンド)を実行すると、 `/home/foo` [ディレクトリ](../../../software/_/chapters/file_system.md#ディレクトリ)が作成され、 `foo` [ユーザ](#ユーザ)がこの[ディレクトリ](../../../software/_/chapters/file_system.md#ディレクトリ)を所有する。ただし、この時点ではパスワードが設定されていないため、[ユーザ](#ユーザ)はログインできない。パスワードを設定するには、以下の[コマンド](./basic_command.md#コマンド)を実行する必要がある。

```sh
$ passwd foo
```

### ユーザの変更

`usermod` は、[Linux](./linux.md#linux)上で既存の[ユーザ](./user_and_permission.md#ユーザ)アカウントを変更するための[コマンド](./basic_command.md#コマンド)。主に以下のようなユーザアカウント情報を変更するために使用される。

- [ユーザ](#ユーザ)名
- [ユーザ](#ユーザ)パスワード
- [ユーザ](#ユーザ)の所属する[グループ](#グループ)
- [ユーザ](#ユーザ)アカウントの有効期限

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
usermod [OPTION]... LOGIN
```

例えば、[ユーザ](#ユーザ) `foo` の[ホームディレクトリ](../../../software/_/chapters/file_system.md#ホームディレクトリ)を `/home/bar` に変更する場合は、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ usermod --home /home/bar foo
```

[ユーザ](#ユーザ) `foo` の[メイングループ](#メイングループ)を `foo` から `bar` に変更する場合は、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ usermod -g bar foo
```

[ユーザ](#ユーザ) `foo` を[サブグループ](#サブグループ) `hoge` に追加する場合は、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ usermod -aG hoge foo
```

`usermod` [コマンド](./basic_command.md#コマンド)は[root権限](#rootユーザ)を持つ[ユーザ](#ユーザ)が実行する必要がある。

### ユーザの削除

`userdel` は、[Linux](./linux.md#linux)上で[ユーザ](#ユーザ)を削除するための[コマンド](./basic_command.md#コマンド)。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
userdel [OPTION]... LOGIN
```

例えば、[ユーザ](#ユーザ)名が `foo` の[ユーザ](#ユーザ)を削除するには、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ userdel foo
```

この[コマンド](./basic_command.md#コマンド)の実行により、 `foo` はシステムから完全に削除されるが、[ホームディレクトリ](../../../software/_/chapters/file_system.md#ホームディレクトリ)やメールボックスといった[ユーザ](#ユーザ)データは削除されない。これらのデータを削除するには、 `-r` [オプション](./basic_command.md#オプション)を指定する。

`userdel` [コマンド](./basic_command.md#コマンド)は[root権限](#rootユーザ)を持つ[ユーザ](#ユーザ)が実行する必要がある。

### ユーザパスワードの変更

`passwd` は、[Linux](./linux.md#linux)で[ユーザ](#ユーザ)のパスワードを変更するために使用される[コマンド](./basic_command.md#コマンド)。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
passwd [OPTION]... LOGIN
```

例えば、[ユーザ](#ユーザ)名が `foo` の[ユーザ](#ユーザ)のパスワードを変更するには、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ passwd foo
```

`passwd` [コマンド](./basic_command.md#コマンド)を実行すると、[プロンプト](./shell_and_terminal.md#プロンプト)でパスワードの入力が要求される。

`passwd` [コマンド](./basic_command.md#コマンド)は[root権限](#rootユーザ)を持つ[ユーザ](#ユーザ)が実行する必要がある。


## グループ

**グループ**は、複数のユーザをひとまとめにする機能で、アクセス権限の設定やファイルの所有権管理などに利用される。グループを利用することで、Linux上のファイルやディレクトリに対するアクセス権をまとめてコントロールすることができる。グループはシステム上で一意の**GID**によって識別される。

ユーザは必ずひとつのメイングループに所属しており、任意の数のサブグループに所属することができる。また、ファイルやディレクトリも必ずひとつのグループに所属している。

### メイングループ

**メイングループ**は、ユーザが必ずひとつ所属するグループで、通常はユーザ名と同名のグループが自動的に作成され、そのグループがメイングループとして割り当てられる。例えば、 `foo` というユーザを作成した時、そのユーザは `foo` というメイングループに所属する。

ユーザが作成したファイルやディレクトリの所有グループには、メイングループがデフォルトで割り当てられる。

### サブグループ

**サブグループ**は、ユーザが任意の数所属することができるグループ。複数のユーザが同じサブグループに所属することで、そのグループが所有者となっているファイルやディレクトリに対するアクセス権をまとめて設定できる。

### 所属グループの確認

`groups` は、Linux上のユーザの所属グループリストを確認するためのコマンド。

コマンドの書式は以下の通り。

```
groups [USER]
```

### グループの作成

`groupadd` は、Linux上で新しいグループを作成するためのコマンド。

コマンドの書式は以下の通り。

```
groupadd [OPTION]... NEWGROUP
```

例えば、新しいグループ `hoge` を作成する場合は、以下のコマンドを実行する。

```sh
$ groupadd hoge
```

`groupadd` コマンドはroot権限を持つユーザが実行する必要がある。

### グループの変更

`groupmod` は、Linux上で既存のグループの属性を変更するためのコマンド。主に以下のようなグループ情報を変更するために使用される。

- グループID
- グループ名
- グループパスワード

コマンドの書式は以下の通り。

```
groupmod [OPTION]... GROUP
```

例えば、グループ名が `hoge` のグループのグループ名を `fuga` に変更するには、以下のコマンドを実行する。

```sh
$ groupmod -n fuga hoge
```

### グループの削除

`groupdel` は、Linux上でグループを削除するためのコマンド。

コマンドの書式は以下の通り。

```
groupdel [OPTION]... GROUP
```

例えば、グループ名 `hoge` のグループを削除する場合は、以下のコマンドを実行する。

```sh
$ groupdel hoge
```

ただし、グループに所属するユーザがいる場合は、そのユーザを他のグループに移動させるか、ユーザ自身を削除する必要がある。


## 所有者

**所有者**（**オーナー**）は、Linuxにおいてファイルやディレクトリに割り当てられる、そのファイルやディレクトリの持ち主。また、ファイルやディレクトリは必ずひとつのグループに所属している。通常は、そのファイルやディレクトリを作成したユーザが所有者となり、そのユーザのメイングループがファイルやディレクトリのグループとなる。

### 所有者の確認

Linuxでファイルやディレクトリの所有者や所属グループを確認するには、 `ls` コマンドに `-l` オプションを付与して実行する。

### 所有者の変更

`chown` は、Linux上でファイルやディレクトリの所有者を変更するためのコマンド。 `chown` は "change owner"の略語。

コマンドの書式は以下の通り。

```
chown [OPTION]... [OWNER][:[GROUP]] FILE...
chown [OPTION]... --reference=RFILE FILE...
```

例えば、ファイル `test.txt` の所有者を `foo` に変更する場合は、以下のコマンドを実行する。

```sh
$ chown foo test.txt
```

また、所有者とグループを同時に変更する場合は、 `-R` オプションを付与して次のようにコマンドを実行する。

```sh
$ chown -R foo:group test.txt
```

### ファイルのグループの変更

`chgrp` は、Linux上でファイルやディレクトリの所属グループを変更するコマンド。

コマンドの書式は以下の通り。

```
chgrp [OPTION]... GROUP FILE...
chgrp [OPTION]... --reference=RFILE FILE...
```

例えば、 `test.txt` の所属グループを `hoge` に変更する場合は、以下のコマンドを実行する。

```sh
$ chgrp hoge test.txt
```


## 権限

**権限**（**パーミッション**）は、Linuxにおいてファイルやディレクトリなどのアクセス制御を行うための機能。Linuxの権限管理では、誰にどのような操作を許可するかを設定する。

各ファイルやディレクトリには、以下の3つの対象に対して権限を設定できる。

| 権限           | シンボル | 概要                                                |
| -------------- | -------- | :-------------------------------------------------- |
| 所有者         | `u`      | ファイルやディレクトリの所有者が持つ権限            |
| グループ       | `g`      | ファイルやディレクトリの所属するグループが持つ権限  |
| その他のユーザ | `o`      | それ以外の第三者が持つ権限                          |

通常、所有者やグループには高い権限を設定しておき、その他のユーザに与える権限は最低限に抑える。全てのユーザを指し示す場合、シンボルとして `a` を用いる。

また、これらの対象に対して次の3つのアクションに対する許可設定を行う。

| アクション          | ファイル               | ディレクトリ                       |
| ------------------- | :--------------------- | :--------------------------------- |
| 読み取り権限(read)  | ファイルの内容を表示   | ディレクトリ内のリスト表示         |
| 書き込み権限(write) | ファイルの上書き、変更 | ディレクトリ内にファイル作成、削除 |
| 実行権限(execute)   | 実行ファイルの実行     | そのディレクトリに移動             |

また、これらのアクションにはそれぞれ以下のようなシンボルと数値が割り当てられている。

| アクション   | シンボル | 数値 |
| ------------ | -------- | ---- |
| 読み取り権限 | `r`      | `4`  |
| 書き込み権限 | `w`      | `2`  |
| 実行権限     | `x`      | `1`  |

例えば、 `ls -l` を実行したときのあるファイルの権限が `-rwxr-x---` であった場合、最初の `-` はファイルが通常ファイルであることを表し、その後ろの9文字は3文字区切りでそれぞれの対象に対する権限を表す。つまり、所有者には読み取り権限と書き込み権限と実行権限が、グループには読み取り権限と実行権限が、その他のユーザには何も権限が与えられていないという意味になる。また、これを数値で表現すると、 `750` となる。これは、与えられている権限の数値を足し合わせたものをそれぞれの対象に対して横に並べたものである（所有者であれば `4+2+1` 、グループであれば `4+1` ）。

### 権限の確認

Linuxでファイルやディレクトリの権限を確認するには、 `ls` コマンドに `-l` オプションを付与して実行する。権限は `-rwxr-xr-x` のように表示される。最初の `-` はファイル種別で、通常ファイルであれば `-` 、ディレクトリであれば `d` 、リンクであれば `l` が表示される。それ以降は3文字区切りで、それぞれユーザ権限、グループ権限、全体権限を表す。所有者には読み取り( `r` )、書き込み( `w` )、実行( `x` )の全権限が与えられており、グループとそれ以外のユーザは読み取りと実行のみ許可されている。

### 権限の変更

`chmod` は、Linux上のファイルやディレクトリの権限を変更するためのコマンド。 `chmod` では、3桁の数字や記号により権限を操作することができる。

コマンドの書式は以下の通り。

```
chmod [OPTION]... MODE[,MODE]... FILE...
chmod [OPTION]... OCTAL-MODE FILE...
chmod [OPTION]... --reference=RFILE FILE...
```

数値を用いてファイルの権限を変更する場合、次のようなコマンドを実行する。

```sh
$ chmod 650 filename
```

所有者に書き込み権限を与える場合、次のようなコマンドを実行する。

```sh
$ chmod u+w filename
```

グループとその他のユーザの権限を読み取り権限と実行権限にする場合、次のようなコマンドを実行する。

```sh
$ chmod go=rx filename
```

全てのユーザの実行権限を削除する場合、次のようなコマンドを実行する。

```sh
$ chmod a-x filename
```


## rootユーザ

**rootユーザ**（**スーパユーザ**）は、あらゆる操作が許可されたシステム上で最高の特権を持つユーザ。rootユーザに対して通常の作業に利用するユーザは一般ユーザという。すべてのファイルやシステムリソースにアクセスすることができ、システム管理者として、ユーザやグループの管理、システムの設定や保守、パッケージ管理などを行う。

一般的には、rootユーザはセキュリティ上の理由から普段は使用せず、必要な場合にのみログインして作業を行う。また、rootユーザはLinuxシステムを動作させるのに必須のファイルを削除するといった危険な操作も可能なため、慎重に作業する必要がある。

### rootユーザへの切り替え

`su` は、Linuxで一時的に別のユーザに切り替えて作業するためのコマンド。ユーザを指定しなかった場合はrootユーザに切り替える。 `su` は"substitute user"の略語。

コマンドの書式は以下の通り。

```
su [OPTION]... [-] [USER [ARGUMENT...]]
```

一般的にはユーザ名を省略して、rootユーザに切り替える目的で用いられることが多い。コマンドを実行すると、プロンプトで、切り替えたい対象ユーザのパスワード入力を求められる。例えば、ユーザ名が `foo` のユーザとしてログイン中、一時的にrootユーザに切り替えたい場合、次のコマンドを実行する。

```sh
$ su
```

また、rootユーザからログアウトして `foo` ユーザに復帰するには、 `exit` コマンドを実行する。

### rootユーザとしてコマンド実行

`sudo` は、Linuxで別のユーザとしてコマンドを実行するために利用されるコマンド。ユーザ名を指定しなかった場合はrootユーザとしてコマンドを実行する。

一般的にはユーザ名を省略して、rootユーザに切り替える目的で用いられることが多い。コマンドを実行すると、プロンプトで、ログイン中のユーザのパスワード入力を求められる。例えば、ユーザ名が `foo` のユーザとしてログイン中、rootユーザとして `cat` コマンドを使用し `test.txt` を閲覧したい場合、以下のコマンドを実行する。

```sh
$ sudo cat test.txt
```

sudoの設定を変更するには、以下のコマンドで設定ファイルを開いて編集する（通常のテキストエディタで開いて編集して、書き方を誤ると、 `sudo` が使えなくなる可能性があるため）。

```sh
$ visudo
```

`sudo` の許可設定は次のように記述される。

```
%wheel ALL=(ALL) NOPASSWD: ALL
```

これは、 `wheel` グループに所属するユーザが、パスワードの入力無しで `sudo` が利用できることを意味する。

```
foo ALL=(ALL) ALL
```

これは、 `foo` ユーザが `sudo` を利用できることを意味する。
