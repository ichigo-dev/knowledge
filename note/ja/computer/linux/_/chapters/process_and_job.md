# 『プロセスとジョブ』ノート

（最終更新： 2023-08-20）


## 目次

1. [プロセス](#プロセス)
	1. [fork](#fork)
	1. [clone](#clone)
	1. [exec](#exec)
	1. [プロセスの確認](#プロセスの確認)
	1. [プロセスツリーの確認](#プロセスツリーの確認)
	1. [プロセスのリアルタイム監視](#プロセスのリアルタイム監視)
	1. [プロセスの強制終了](#プロセスの強制終了)
	1. [メモリの監視](#メモリの監視)
1. [ジョブ](#ジョブ)
	1. [フォアグラウンドジョブ](#フォアグラウンドジョブ)
	1. [バックグラウンドジョブ](#バックグラウンドジョブ)
	1. [ジョブコントロール](#ジョブコントロール)
	1. [ジョブの確認](#ジョブの確認)
	1. [フォアグラウンドジョブとして実行](#フォアグラウンドジョブとして実行)
	1. [バックグラウンドジョブとして実行](#バックグラウンドジョブとして実行)
1. [スレッド](#スレッド)
1. [デーモン](#デーモン)
1. [initプロセス](#initプロセス)
1. [systemd](#systemd)
	1. [サービス](#サービス)
	1. [サービスの管理](#サービスの管理)
	1. [サービスの開始](#サービスの開始)
	1. [サービスの停止](#サービスの停止)
	1. [サービスの再起動](#サービスの再起動)
	1. [サービスの状態確認](#サービスの状態確認)
	1. [サービスの登録](#サービスの登録)
	1. [サービスの登録解除](#サービスの登録解除)
	1. [サービスの登録確認](#サービスの登録確認)
1. [シグナル](#シグナル)
1. [プロセス間通信](#プロセス間通信)
	1. [ソケット](#ソケット)
	1. [共有メモリ](#共有メモリ)
	1. [メッセージキュー](#メッセージキュー)
	1. [セマフォ](#セマフォ)


## プロセス

**プロセス**は、[メモリ](../../../hardware/_/chapters/memory.md#メモリ)上で[実行状態](../../../software/_/chapters/operating_system.md#実行状態)にある[プログラム](../../../../programming/_/chapters/programming.md#プログラム)。[Linux](./linux.md#linux)[カーネル](../../../software/_/chapters/operating_system.md#カーネル)は[ストレージ](../../../hardware/_/chapters/hardware.md#記憶装置)装置から[メモリ](../../../hardware/_/chapters/memory.md#メモリ)に[プログラム](../../../../programming/_/chapters/programming.md#プログラム)を読み出し、その[メモリ](../../../hardware/_/chapters/memory.md#メモリ)の内容に従って[CPU](../../../hardware/_/chapters/processor.md#cpu)が[プログラム](../../../../programming/_/chapters/programming.md#プログラム)を実行する。プロセスはシステム上で一意の**PID**によって識別される。

ひとつの[プログラム](../../../../programming/_/chapters/programming.md#プログラム)や[コマンド](./basic_command.md#コマンド)が複数のプロセスを生成したり、プロセスがさらにプロセスを生成することもある。あるプロセスによって生み出された別のプロセスは、そのプロセスの子プロセスとなる。

プロセスは[オペレーティングシステム](../../../software/_/chapters/operating_system.md#オペレーティングシステム)の[タスクスケジューラ](../../../software/_/chapters/operating_system.md#タスク管理システム)によって制御され、[実行可能状態](../../../software/_/chapters/operating_system.md#実行可能状態)、[実行状態](../../../software/_/chapters/operating_system.md#実行状態)、[待ち状態](../../../software/_/chapters/operating_system.md#待ち状態)といった状態を遷移しながら処理が進められる。

### fork

**fork**は、親[プロセス](#プロセス)から子[プロセス](#プロセス)を生成する[システムコール](../../../software/_/chapters/operating_system.md#システムコール)のひとつ。親[プロセス](#プロセス)からforkが呼び出されると、システムは親[プロセス](#プロセス)の複製を作成し、それが子[プロセス](#プロセス)となる。子[プロセス](#プロセス)は親[プロセス](#プロセス)の状態を複製することによって生成されるため、実行される[プログラム](../../../../programming/_/chapters/programming.md#プログラム)は親[プロセス](#プロセス)と共通となる。子[プロセス](#プロセス)は親[プロセス](#プロセス)とは独立して動作し、親[プロセス](#プロセス)と異なる[PID](#プロセス)を持つ。

### clone

**clone**は、親[プロセス](#プロセス)から子[プロセス](#プロセス)を生成するための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)のひとつ。[fork](#fork)と同様に、親[プロセス](#プロセス)の複製を子[プロセス](#プロセス)として生成する。cloneでは、親[プロセス](#プロセス)と子[プロセス](#プロセス)の間で共有されるリソースを指定することができ、複数の[プロセス](#プロセス)を協調させることができる。

### exec

**exec**は、現在の[プロセス](#プロセス)を新しい[プロセス](#プロセス)に置き換える[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。execを使用することで、[プロセス](#プロセス)の実行中に[プログラム](../../../../programming/_/chapters/programming.md#プログラム)を切り替えたり[プロセス](#プロセス)の状態を維持したまま[プログラム](../../../../programming/_/chapters/programming.md#プログラム)をリロードしたりすることができる。

### プロセスの確認

**ps**は、[プロセス](#プロセス)の状態を表示するための[コマンド](./basic_command.md#コマンド)。 `ps` は"process status"の略語。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
ps [OPTION]...
```

`ps` [コマンド](./basic_command.md#コマンド)を実行すると、この[コマンド](./basic_command.md#コマンド)を実行した[ユーザ](./user_and_permission.md#ユーザ)が起動している[プロセス](#プロセス)のリストが表示される。

```sh
$ ps
    PID TTY          TIME CMD
    425 pts/0    00:00:00 zsh
    689 pts/0    00:00:00 ps
```

`ps` の主要な[オプション](./basic_command.md#オプション)は以下の通り。

| オプション | 概要                                               |
| ---------- | :------------------------------------------------- |
| `a`        | 全てのユーザのプロセスの状態を表示する             |
| `f`        | プロセスの親子関係をツリー上にして表示する         |
| `u`        | プロセスのユーザ名と開始時刻を表示内容に付加する   |
| `x`        | 制御端末を持たないデーモンなどのプロセスも表示する |
| `l`        | 詳細情報を表示する                                 |
| `-e`       | 全プロセスの情報を表示する　                       |

[オプション](./basic_command.md#オプション)は、以下の例のように複数個まとめて指定することもできる。

```sh
$ ps aux
```

### プロセスツリーの確認

**pstree**は、[プロセス](#プロセス)の親子関係をツリー形式で表示するための[コマンド](./basic_command.md#コマンド)。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
pstree [OPTION]...
```

`pstree` の主要な[オプション](./basic_command.md#オプション)は以下の通り。

| オプション | 概要                                            |
| ---------- | :---------------------------------------------- |
| `-p`       | 各プロセスのPIDを表示する                       |
| `-u`       | 各プロセスの実行ユーザ名を表示する              |
| `-h`       | ルートプロセスを表示しない                      |
| `-a`       | 各プロセスのコマンドライン引数も表示する        |
| `-n`       | 各プロセスの名前をソートせず、PIDの順に表示する |
| `-c`       | 同じ名前のプロセスをまとめて表示する            |
| `-G`       | 指定したグループIDを持つプロセスのみ表示する    |
| `-U`       | 指定したユーザIDを持つプロセスのみ表示する      |

### プロセスのリアルタイム監視

**top**は、[Linux](./linux.md#linux)システムで実行されている[プロセス](#プロセス)をリアルタイムで監視するための[コマンド](./basic_command.md#コマンド)。 `top` [コマンド](./basic_command.md#コマンド)で確認できる情報は以下の通り。

| ラベル | 概要                                                                                        |
| ------ | :------------------------------------------------------------------------------------------ |
| PID    | 各プロセスのPID                                                                             |
| USER   | 各プロセスを発行しているユーザ                                                              |
| PR     | プロセスの優先度                                                                            |
| NI     | プロセスの優先度を調整するために使用されるニース値                                          |
| VIRT   | プロセスが使用している仮想メモリサイズ                                                      |
| RES    | プロセスが使用している物理メモリサイズ                                                      |
| SHR    | プロセスが使用している共有メモリサイズ                                                      |
| S      | プロセスの現在の状態（D: 割込み不能、R: 実行中、S: スリープ、T: 停止中、Z: ゾンビプロセス） |
| %CPU   | プロセスが使用しているCPUの割合                                                             |
| %MEM   | プロセスが使用している物理メモリの割合                                                      |
| TIME+  | プロセスが起動している時間                                                                  |

### プロセスの強制終了

**kill**は、実行中の[プロセス](#プロセス)に[シグナル](#シグナル)を送信する[コマンド](./basic_command.md#コマンド)。[プロセス](#プロセス)を強制終了する場合などによく用いられる。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
kill [SIGNAL] PID
```

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、[PID](#プロセス)が1234の[プロセス](#プロセス)に `TERM` [シグナル](#シグナル)を送信する。

```sh
$ kill -TERM 1234
```

`kill` は[プロセス](#プロセス)を強制終了するために用いられることが多いが、[プロセス](#プロセス)を停止したり再開したりするための他の[オプション](./basic_command.md#オプション)もある。

また、 `pkill` は[プロセス](#プロセス)名指定で[プロセス](#プロセス)を強制終了する[コマンド](./basic_command.md#コマンド)、 `killall` は[プロセス](#プロセス)名指定で全ての[プロセス](#プロセス)を強制終了する[コマンド](./basic_command.md#コマンド)となっている。

### メモリの監視

**free**は、[メモリ](../../../hardware/_/chapters/memory.md#メモリ)の使用状況を表示するための[コマンド](./basic_command.md#コマンド)。主に以下の情報を表示する。

| ラベル       | 概要                                           |
| ------------ | :--------------------------------------------- |
| `total`      | システム全体の物理メモリ量                     |
| `useed`      | 使用中の物理メモリ量                           |
| `free`       | 空き物理メモリ量                               |
| `shared`     | 共有メモリ量                                   |
| `buff/cache` | バッファやキャッシュに使われている物理メモリ量 |
| `available`  | アプリケーションに使用可能な物理メモリ量       |

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
free [OPTION]...
```

`free` の主要な[オプション](./basic_command.md#オプション)は以下の通り。

| オプション       | 概要                                         |
| ---------------- | :------------------------------------------- |
| `-b` `--bytes`   | 結果をバイト単位で表示する                   |
| `-k` `--kilo`    | 結果をキロバイト単位で表示する（デフォルト） |
| `-m` `--mega`    | 結果をメガバイト単位で表示する               |
| `-g` `--giga`    | 結果をギガバイト単位で表示する               |
| `-h` `--human`   | より読みやすい形式で表示する                 |
| `-t` `--total`   | 全体のメモリ使用量のみを表示する             |
| `-s` `--seconds` | 指定した秒数ごとに繰り返し表示する           |
| `-c` `--count`   | 指定した回数繰り返し表示する                 |


## ジョブ

**ジョブ**は、1つの[プログラム](../../../../programming/_/chapters/programming.md#プログラム)や[コマンド](./basic_command.md#コマンド)といった実行単位のことで、1つ以上の[プロセス](#プロセス)をまとめたもの。[シェル](./shell_and_terminal.md#シェル)に入力された1行分が1つのジョブに対応し、ジョブは必要に応じて[プロセス](#プロセス)に分解されて処理される。

### フォアグラウンドジョブ

**フォアグラウンドジョブ**は、[シェル](./shell_and_terminal.md#シェル)によって起動される[ジョブ](#ジョブ)。通常、[コマンド](./basic_command.md#コマンド)を実行するとフォアグラウンドで[ジョブ](#ジョブ)が生成され、その[ジョブ](#ジョブ)が終了するまでは[シェル](./shell_and_terminal.md#シェル)は[プロンプト](./shell_and_terminal.md#プロンプト)を返さない。フォアグラウンドジョブは[シェル](./shell_and_terminal.md#シェル)への入力を受け付ける状態となり、[ユーザ](./user_and_permission.md#ユーザ)は対話的に[プロセス](#プロセス)に対して[シグナル](#シグナル)を送信することができる。

### バックグラウンドジョブ

**バックグラウンドジョブ**は、[シェル](./shell_and_terminal.md#シェル)とは切り離して実行される[ジョブ](#ジョブ)。[コマンド](./basic_command.md#コマンド)の末尾に `&` を追加して実行すると、その[コマンド](./basic_command.md#コマンド)はバックグラウンドジョブとして実行される。バックグラウンドジョブ（[プロセス](#プロセス)）に[シグナル](#シグナル)を送信するには、 `kill` [コマンド](./basic_command.md#コマンド)を使用する。

### ジョブコントロール

[フォアグラウンドジョブ](#フォアグラウンドジョブ)のコントロールに用いられるキーは以下の通り。

| キー         | 概要                                                   |
| ------------ | :----------------------------------------------------- |
| `Ctrl` + `c` | `SIGINT` シグナルを送出し、プロセスを終了する          |
| `Ctrl` + `z` | ジョブの実行を中断し、バックグラウンドジョブに退避する |

### ジョブの確認

**jobs**は、アクティブな[ジョブ](#ジョブ)の一覧を確認するための[コマンド](./basic_command.md#コマンド)。

例えば以下の例では、バックグラウンドで実行中の `sleep` [コマンド](./basic_command.md#コマンド)の状態を `jobs` によって確認している。[バックグラウンドジョブ](#バックグラウンドジョブ)の処理が終わると、[プロンプト](./shell_and_terminal.md#プロンプト)にその旨が表示される。

```sh
$ sleep 60 &
[1] 2400

$ jobs
[1]  + running    sleep 10

$
[1]  + done       sleep 10
```

### フォアグラウンドジョブとして実行

**fg**は、[ジョブ](#ジョブ)を[フォアグラウンドジョブ](#フォアグラウンドジョブ)として実行する[コマンド](./basic_command.md#コマンド)。

以下の例では、バックグラウンドで実行中の `sleep` をフォアグラウンドに切り替えている。

```sh
$ sleep 60 &
[1] 2744

$ jobs
[1]    running    sleep 20

$ fg %1
[1]    running    sleep 20
```

### バックグラウンドジョブとして実行

**bg**は、[ジョブ](#ジョブ)を[バックグラウンドジョブ](#バックグラウンドジョブ)として実行する[コマンド](./basic_command.md#コマンド)。

以下の例では、フォアグラウンドで実行していた `sleep` を `Ctrl` + `z` で一度バックグラウンドにサスペンドし、それを改めて[バックグラウンドジョブ](#バックグラウンドジョブ)として再開している。

```sh
$ sleep 60

# Ctrl + z を入力
zsh: suspended  sleep 60

$ jobs
[1]  + suspended  sleep 60

$ bg %1
[1]    continued  sleep 60

$
[1]    done       sleep 60
```


## スレッド

**スレッド**は、1つの[プロセス](#プロセス)から生成される実行単位で、[プロセス](#プロセス)内で複数のタスクを並行して実行するなどの目的で使用される。複数のスレッドは同じ[プログラム](../../../../programming/_/chapters/programming.md#プログラム)コード、データ、[ヒープ](../../../hardware/_/chapters/memory.md#ヒープ領域)などを共有している。スレッドは[プロセス](#プロセス)よりも軽量で、[プロセス間通信](#プロセス間通信)に比べてスレッド通信は高速である。


## デーモン

**デーモン**は、メイン[メモリ](../../../hardware/_/chapters/memory.md#メモリ)上に常駐して特定の機能を提供する[プログラム](../../../../programming/_/chapters/programming.md#プログラム)。デーモンは[initプロセス](#initプロセス)や[systemd](#systemd)によってシステムの起動時に実行され、バックグラウンドで動作しながら処理要求があったときに処理を実行する。[Web](../../../../network/_/chapters/web.md#web)[サーバ](../../../_/chapters/computer.md#サーバ)やバッチ[プログラム](../../../../programming/_/chapters/programming.md#プログラム)などがこれに該当し、[プログラム](../../../../programming/_/chapters/programming.md#プログラム)名の末尾に `d` がつくのが慣例となっている（ `httpd` 、 `crond` など）。


## initプロセス

**initプロセス**は、[Linux](./linux.md#linux)システムが起動された時に最初に実行され、システムの全ての[プロセス](#プロセス)の親[プロセス](#プロセス)として機能する[プロセス](#プロセス)。システムのランレベルの設定や各種[サービス](#サービス)、[デーモン](#デーモン)の起動などを行う。initプロセスの[PID](#プロセス)は必ず1となる。

initプロセスは `/sbin/init` [ファイル](../../../software/_/chapters/file_system.md#ファイル)から起動され、起動時に設定されたランレベルに応じて必要な[サービス](#サービス)や[プロセス](#プロセス)を開始する。通常は、ランレベルは `０` から `6` までの7段階があり、ランレベル `0` はシャットダウン、ランレベル `6` は再起動を表す。管理者はそれぞれのランレベルに合わせた[スクリプト](./shell_script.md#シェルスクリプト)を用意して、必要な[デーモン](#デーモン)の起動処理などを記述する。

新しい[Linuxディストリビューション](./linux.md#ディストリビューション)の多くでは、initプロセスに代わって[systemd](#systemd)が利用される場合が多い。


## systemd

**systemd**は、[Linux](./linux.md#linux)システムが起動された時に最初に実行される[プロセス](#プロセス)で、システムのブートプロセスや[サービス](#サービス)管理を行うシステム管理[デーモン](#デーモン)。従来の[initプロセス](#initプロセス)の代替として設計されており、[プロセス](#プロセス)の開始、監視、制御、終了等を行うことができる。systemdでは、[デーモン](#デーモン)や[サービス](#サービス)の依存関係や起動順序、停止順序などを管理することができる。systemdの[PID](#プロセス)は必ず1となる。

systemdでは各[サービス](#サービス)がユニットファイルとして定義され、systemdによって自動的に管理される。また、 `systemctl` [コマンド](./basic_command.md#コマンド)を利用して[サービス](#サービス)のステータス確認や起動、停止、再起動、有効化、無効化などを行うことができる。

### サービス

**サービス**は、[Linux](./linux.md#linux)システムが起動された時に開始される[デーモン](#デーモン)[プロセス](#プロセス)。[デーモン](#デーモン)と同じ意味で使用される場合も多い。

### サービスの管理

**systemctl**は、[systemd](#systemd)を制御するために使用される[コマンド](./basic_command.md#コマンド)。[サービス](#サービス)の起動や停止、有効化、無効化などを行う[サービス](#サービス)マネージャであり、システムの管理に必要な[サブコマンド](./basic_command.md#サブコマンド)が用意されている。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
systemctl [OPTIONS...] COMMAND [UNIT...]
```

### サービスの開始

**systemct start**は、[systemd](#systemd)を使用して[Linux](./linux.md#linux)システム上の[サービス](#サービス)を開始する[コマンド](./basic_command.md#コマンド)。

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、 `httpd` [サービス](#サービス)を開始する。

```sh
$ systemctl start httpd
```

ただし、システムを再起動した際には開始した[サービス](#サービス)は起動されないので、自動で開始したい場合は `systemctl enable` を使用する。

### サービスの停止

**systemctl stop**は、[systemd](#systemd)を使用して[Linux](./linux.md#linux)システム上の[サービス](#サービス)を停止する[コマンド](./basic_command.md#コマンド)。

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、 `httpd` [サービス](#サービス)を停止する。

```sh
$ systemctl stop httpd
```

ただし、自動的に開始されるように設定されている[サービス](#サービス)は、システムを再起動したときに開始されてしまうので、完全に停止したい場合は `systemctl disable` を使用する。

### サービスの再起動

**systemctl restart**は、[systemd](#systemd)を使用して[Linux](./linux.md#linux)システム上の[サービス](#サービス)を再起動する[コマンド](./basic_command.md#コマンド)。

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、 `httpd` [サービス](#サービス)を再起動する。

```sh
$ systemctl restart httpd
```

これは、[サービス](#サービス)の設定ファイルを変更して、再度その内容を読み込みたい場合などによく用いられる。

### サービスの状態確認

**systemctl status**は、[systemd](#systemd)を使用して[Linux](./linux.md#linux)システム上の[サービス](#サービス)の状態を確認する[コマンド](./basic_command.md#コマンド)。

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、 `httpd` [サービス](#サービス)の状態を表示する。

```sh
$ systemctl status httpd
```

### サービスの登録

**systemctl enable**は、[systemd](#systemd)を使用して[Linux](./linux.md#linux)システム上の[サービス](#サービス)が起動時に自動的に開始されるように登録する[コマンド](./basic_command.md#コマンド)。

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、 `httpd` [サービス](#サービス)が次回のシステムの起動時に自動的に開始される。

```sh
$ systemctl enable httpd
```

### サービスの登録解除

**systemctl disable**は、[systemd](#systemd)を使用して[Linux](./linux.md#linux)システム上で自動的に起動されるように登録された[サービス](#サービス)を解除する[コマンド](./basic_command.md#コマンド)。

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、 `httpd` [サービス](#サービス)が次回のシステムの起動時に自動的に開始されないようにする。

```sh
$ systemctl disable httpd
```

### サービスの登録確認

**systemctl is-enabled**は、[systemd](#systemd)を使用して指定した[サービス](#サービス)が自動起動に登録されているかを確認する[コマンド](./basic_command.md#コマンド)。

例えば以下の[コマンド](./basic_command.md#コマンド)を実行すると、 `httpd` [サービス](#サービス)が登録されているかを表示する。

```sh
$ systemctl is-enabled httpd
```


## シグナル

**シグナル**は、[プロセス](#プロセス)へ様々なイベントを通知するための[カーネル](../../../software/_/chapters/operating_system.md#カーネル)の機能（[ソフトウェア割込み](../../../hardware/_/chapters/processor.md#内部割込み)）。イベントの通知は[プロセス](#プロセス)自身や他[プロセス](#プロセス)、[カーネル](../../../software/_/chapters/operating_system.md#カーネル)など様々な場所から行うことが可能で、次のような目的で用いられる。

- [プロセス](#プロセス)にシグナルを送信して強制終了させる
- シグナルを送信して[プロセス](#プロセス)の処理を一時停止、再開させる
- シグナル受信時に[ユーザ](./user_and_permission.md#ユーザ)定義の処理（**シグナルハンドラ**）を実行する

主なシグナルは以下の通り。

| シグナル番号 | シグナル名             | 概要                                                                                      |
| ------------ | ---------------------- | :---------------------------------------------------------------------------------------- |
| `1`          | **HUP**(Hung up)       | プロセスを再起動するシグナル。設定ファイルの再読み込みなどに用いられる。                  |
| `2`          | **INT**(Interrupt)     | キーボードからの割込み( `Ctrl + C` )                                                      |
| `9`          | **KILL**               | プロセスを強制終了するシグナル。正常な処理を行わないため、最悪の場合ファイルが破損する。  |
| `15`         | **TERM**(Termination)  | プロセスを終了するシグナル。正常な終了処理を行う。                                        |
| `18`         | **CONT**(Continue)     | 一時停止のプロセスを再開するシグナル。                                                    |
| `19`         | **STOP**               | プロセスを一時停止するシグナル。                                                          |
| `20`         | **TSTP**(Teminal stop) | プロセスを中断するシグナル。                                                              |


## プロセス間通信

**プロセス間通信**(**IPC**: InterProcess Communication)は、実行中の複数の[プロセス](#プロセス)間でデータをやり取りするための仕組み。ある[プログラム](../../../../programming/_/chapters/programming.md#プログラム)から別の[プログラム](../../../../programming/_/chapters/programming.md#プログラム)へデータやメッセージを通知したり、[プログラム](../../../../programming/_/chapters/programming.md#プログラム)同士で協調して処理を行うための技術や手段のことを指す。

### ソケット

**ソケット**(Socket)は、[ネットワーク](../../../../network/_/chapters/network.md#ネットワーク)を介して[プロセス間通信](#プロセス間通信)を行うための[API](../../../software/_/chapters/operating_system.md#api)。ソケットには、[TCP](../../../../network/_/chapters/transport_layer.md#tcp)や[UDP](../../../../network/_/chapters/transport_layer.md#udp)などの[プロトコル](../../../../network/_/chapters/network_architecture.md#プロトコル)に対応した種類がある。

[サーバ](../../../_/chapters/computer.md#サーバ)は以下のような手順で通信を行う。

1. **socket**: 待ち受け用のソケットを作成する
1. **bind**: 待ち受ける[IPアドレス](../../../../network/_/chapters/address_on_network.md#ipアドレス)や[ポート番号](../../../../network/_/chapters/address_on_network.md#ポート番号)といった情報をソケットに紐づける
1. **listen**: クライアントからの通信を待ち受ける
1. **accept**: 接続要求を受け入れ、通信用に新しいソケットを作成する
1. **read/write**: acceptで作成したソケットを用いて、クライアントとのデータのやり取りを行う

クライアントは以下のような手順で通信を行う。

1. socket: [サーバ](../../../_/chapters/computer.md#サーバ)との通信用のソケットを作成する
1. **connect**: [サーバ](../../../_/chapters/computer.md#サーバ)が待ち受けている[IPアドレス](../../../../network/_/chapters/address_on_network.md#ipアドレス)の[ポート](../../../../network/_/chapters/address_on_network.md#ポート番号)に対して接続を試みる
1. read/write: 接続が確立したら、ソケットを介して[サーバ](../../../_/chapters/computer.md#サーバ)とのデータのやり取りを行う

### 共有メモリ

**共有メモリ**(Shared memory)は、[IPC](#プロセス間通信)の一種で、複数の[プロセス](#プロセス)が同じ[メモリ](../../../hardware/_/chapters/memory.md#メモリ)領域を共有する仕組み。複数の[プロセス](#プロセス)が同じデータを更新する必要がある場合、共有メモリを使用することで高速な処理が可能となる。

共有メモリは、システム上に特定の領域を[プロセス](#プロセス)とは独立して確保しておき、[プロセス](#プロセス)と共有メモリを紐づけることで利用できる。共有メモリを扱うための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)は以下の通り。

- **shmget**: 共有メモリ領域を作成するための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。共有メモリのサイズや[アクセス権限](./user_and_permission.md#権限)を指定することができる。
- **shmat**: 共有メモリ領域にアタッチするための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。共有メモリの識別子を指定して、その共有メモリ領域を[プロセス](#プロセス)の[アドレス](../../../hardware/_/chapters/memory.md#アドレス)空間にマッピングする。
- **shmdt**: 共有メモリ領域をデタッチするための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。[プロセス](#プロセス)が共有メモリが不要になったときに呼び出し、[プロセス](#プロセス)の[アドレス](../../../hardware/_/chapters/memory.md#アドレス)空間から共有メモリが解放される。

### メッセージキュー

**メッセージキュー**(Message Queue)は、[IPC](#プロセス間通信)の一種で、[プロセス](#プロセス)間でデータを送受信するための仕組み。メッセージキューでは、[キュー](../../../../programming/_/chapters/data_type.md#キュー)にデータを送信したり、[キュー](../../../../programming/_/chapters/data_type.md#キュー)からデータを取り出したりすることができる。

メッセージキューを用いると、非同期的にデータを送受信することが可能。メッセージキューを扱うための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)は以下の通り。

- **msgget**: メッセージキューを作成するための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。作成されたメッセージキューには、一意のキーが割り当てられる。
- **msgsnd**: メッセージキューにメッセージを送信するための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。送信されるメッセージには、メッセージタイプを指定する必要がある。
- **msgrcv**: メッセージキューからメッセージを取り出すための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。受信されるメッセージは、指定されたメッセージタイプに一致する場合に受信される。メッセージがない場合は、指定された待ち時間が経過するか、別の[プロセス](#プロセス)がメッセージを送信するまで待機する。

### セマフォ

**セマフォ**(semaphore)は、[プロセス](#プロセス)間の同期や競合状態を解決するために使用される同期プリミティブ。セマフォは、[プロセス](#プロセス)が特定のリソースにアクセスできるかどうかを制御するために使用される。具体的には、セマフォはカウンタ[変数](../../../../programming/_/chapters/variable.md#変数)とフラグ[変数](../../../../programming/_/chapters/variable.md#変数)によって[プロセス](#プロセス)のアクセス制御を行う。

セマフォを扱うための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)は以下の通り。

- **semget**: セマフォを作成するために使用される[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。セマフォを取得する場合にも使用される。
- **semop**: セマフォを操作するために使用される[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。セマフォの値を[インクリメント](../../../../programming/_/chapters/operation.md#インクリメント)したり、[デクリメント](../../../../programming/_/chapters/operation.md#デクリメント)したりすることができる。
- **semctl**: セマフォの制御を行うための[システムコール](../../../software/_/chapters/operating_system.md#システムコール)。セマフォの値を取得したり、設定したり、削除したりすることができる。
