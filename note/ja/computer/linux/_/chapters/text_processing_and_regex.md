# 『テキスト処理と正規表現』ノート

（最終更新： 2023-04-04）


## 目次

1. [テキスト処理コマンド](#テキスト処理コマンド)
	1. [ファイルサイズの確認](#ファイルサイズの確認)
	1. [ファイル行のソート](#ファイル行のソート)
	1. [重複行の除去](#重複行の除去)
	1. [テキストの切り出し](#テキストの切り出し)
	1. [文字列の変換と削除](#文字列の変換と削除)
	1. [ファイルの差分の確認](#ファイルの差分の確認)
	1. [ファイルの差分の適用](#ファイルの差分の適用)
	1. [文字列の処理](#文字列の処理)
1. [正規表現](#正規表現)


## テキスト処理コマンド

### ファイルサイズの確認

`wc` は、[ファイル](../../../software/_/chapters/file_system.md#ファイル)の行数、単語数、[バイト](../../../../basics/_/chapters/computer_and_number.md#バイト)数を数える[コマンド](./basic_command.md3コマンド)。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
wc [OPTION]... [FILE]...
```

例えば、 `test.txt` の行数、単語数、[バイト](../../../../basics/_/chapters/computer_and_number.md#バイト)数をカウントするには、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ wc test.txt
11  31 277 test.txt
```

代表的な[オプション](./basic_command.md#オプション)は以下の通り。

| オプション | 概要                   |
| ---------- | :--------------------- |
| `-l`       | 行数のみを表示する     |
| `-w`       | 単語数のみを表示する   |
| `-c`       | バイト数のみを表示する |

### ファイル行のソート

`sort` は、テキストの内容を行単位でソートする[コマンド](./basic_command.md#コマンド)。デフォルトでは、辞書順（アルファベット順）でソートを行う。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
sort [OPTION]... [FILE]...
```

例えば、 `test.txt` の中身をアルファベット順でソートした結果を出力したい場合、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ sort test.txt
```

代表的な[オプション](./basic_command.md#オプション)は以下の通り。

| オプション | 概要                               |
| ---------- | :--------------------------------- |
| `-n`       | 文字列を数値とみなしてソートする。 |
| `-r`       | 逆順にソートする。                 |

### 重複行の除去

`uniq` は、連続した同じ内容の行を省く[コマンド](./basic_command.md#コマンド)。重複する行が連続していない場合は省かれないため、 `sort` [コマンド](./basic_command.md#コマンド)と組み合わせる場合が多い。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
uniq [OPTION]... [INPUT [OUTPUT]]
```

例えば、 `test.txt` の内容から連続する重複行を省きたい場合、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ uniq test.txt
```

`-c` [オプション](./basic_command.md#オプション)を使用すると、重複している行数をカウントすることができる。

### テキストの切り出し

`cut` は、入力行の一部分を切り出して出力する[コマンド](./basic_command.md#コマンド)。

[コマンド](./basic_command.md#コマンド)の書式は以下の通り。

```
cut OPTION... [FILE]...
```

例えば、CSV[ファイル](../../../software/_/chapters/file_system.md#ファイル)（カンマ区切りの[ファイル](../../../software/_/chapters/file_system.md#ファイル)）の3番目のフィールドだけを出力したい場合は、以下の[コマンド](./basic_command.md#コマンド)を実行する。

```sh
$ cut -d , -f 3 test.csv
```

`-d` [オプション](./basic_command.md#オプション)は入力行を分割するための区切り文字の指定に、 `-f` は取り出すフィールド番号の指定に用いる。

### 文字列の変換と削除

`tr` は、入力テキストの内容から、特定の文字を置き換えるためのコマンド。

コマンドの書式配下の通り。

```
tr [OPTION]... STRING1 [STRING2]
```

例えば、セミコロン区切りでデータが記載された `data.txt` をCSVとして出力したい場合は、以下のコマンドを実行する。

```sh
$ cat data.txt | tr ; ,
```

`-d` オプションを使用すると、指定された文字を削除することができる。

### ファイルの差分の確認

`diff` は、2つのファイルの差分を表示するためのコマンド。例えば、編集前後のプログラムのソースコードや設定ファイルの差分を確認するために使用される。

コマンドの書式は以下の通り。

```
diff [OPTION]... FILES
```

例えば、 `test1.txt` と `test2.txt` の差分を確認したい場合は、以下のコマンドを実行する。

```sh
$ diff test1.txt test2.txt
```

`diff` の出力は、以下の3つの変更種別がある。

| 記号              | 内容                                                                       |
| ----------------- | :------------------------------------------------------------------------- |
| `<範囲1>a<範囲2>` | 1つ目のファイルの範囲1の後に、2つ目のファイルの範囲2の内容が追加された。   |
| `<範囲1>c<範囲2>` | 1つ目のファイルの範囲1の箇所に、2つ目のファイルの範囲2の内容が変更された。 |
| `<範囲1>d<範囲2>` | 1つ目のファイルの範囲1の箇所が削除された。                                 |

`-u` オプションを付与すると、ファイルの差分をユニファイド出力形式で出力する。

### ファイルの差分の適用

`patch` は、ファイルの差分を適用するためのコマンド。

コマンドの書式は以下の通り。

```
patch [OPTION]... [ORIGINAL_FILE [PATCH_FILE]]
```

例えば、 `old.txt` と `new.txt` の差分をパッチとして `new.txt` に適用したい場合は、以下のコマンドを実行する。

```sh
$ diff old.txt new.txt | patch new.txt
```

### 文字列の処理

`sed` は、文字列を柔軟に処理することができるコマンド。 `sed` は"stream editor"の略語。

コマンドの書式は以下の通り。

```
sed [OPTION]... [COMMAND]... [FILE]...
```

例えば、 `test.txt` のテキスト中にある `aaa` という文字列を `bbb` に置換したい場合は次のコマンドを実行する。

```sh
$ sed 's/aaa/bbb/g' test.txt
```

コマンドとしては他にも次のようなものがある。

| コマンド | 概要 |
| -------- | :--- |
| `=`      | 行番号を出力する |
| `#`      | コマンド中のコメント |


## 正規表現

**正規表現**は、文字列のパターンを表現するための方法。正規表現を用いれば、文字列がパターンに一致するかを確認したり、共通のパターンに一致するテキストを検索、置換することができる。

正規表現は、文字列そのものを表す**リテラル**と、特別なパターンを表現するための**メタ文字**の組み合わせからなる。

基本的なメタ文字は以下の通り。

1. 基本的なメタ文字

| メタ文字 | 意味                                                   |
| -------- | :----------------------------------------------------- |
| `.`      | 任意の1文字にマッチする                                |
| `*`      | 直前のパターンの0回以上の繰り返しにマッチする          |
| `+`      | 直前のパターンの1回以上の繰り返しにマッチする          |
| `?`      | 直前のパターンの0回もしくは1回の繰り返しにマッチする   |
| `{N}`    | 直前のパターンのN回の繰り返しにマッチする              |
| `{N,}`   | 直前のパターンのN回以上の繰り返しにマッチする          |
| `{,M}`   | 直前のパターンのM回以下の繰り返しにマッチする          |
| `{N,M}`  | 直前のパターンのN回以上M回以下の繰り返しにマッチする   |
| `|`      | 左右の文字列のいずれかにマッチする                     |
| `\`      | 直後のメタ文字のエスケープする                         |
| `[]`     | `[` と `]` の中のいずれか1文字にマッチする             |
| `[^]`    | `[^` と `]` の中に含まれない1文字にマッチする          |
| `()`     | 正規表現のグルーピング（マッチした文字列をキャプチャ） |

2. アンカー

| メタ文字 | 意味             |
| -------- | :--------------- |
| `^`      | 行頭にマッチする |
| `$`      | 行末にマッチする |

3. エスケープシーケンス

| メタ文字 | 意味                                                                            |
| -------- | :------------------------------------------------------------------------------ |
| `\n`     | 改行文字にマッチする(LF)                                                        |
| `\r`     | 改行文字にマッチする(CR)                                                        |
| `\f`     | 改ページ文字にマッチする                                                        |
| `\R`     | すべての改行文字にマッチする（ `\n|\r|\r\n` と同義）                            |
| `\t`     | タブ文字にマッチする                                                            |
| `\s`     | 空白文字にマッチする（ ` |\t|\n|\r|\f` と同義）                                 |
| `\S`     | 空白文字以外のすべての文字にマッチする                                          |
| `\d`     | 数字にマッチする（ `[0-9]` と同義）                                             |
| `\D`     | 数字以外のすべての文字にマッチする（ `[^0-9]` と同義）                          |
| `\w`     | アルファベットと数字とアンダースコアにマッチする（ `[a-zA-Z0-9_]` と同義）      |
| `\W`     | アルファベットと数字とアンダースコア以外にマッチする（ `[^a-zA-Z0-9_]` と同義） |
| `\l`     | 半角英小文字にマッチする（ `[a-z]` と同義）                                     |
| `\L`     | 半角英小文字以外にマッチする（ `[^a-z]` と同義）                                |
| `\u`     | 半角英大文字にマッチする（ `[A-Z]` と同義）                                     |
| `\U`     | 半角英大文字以外にマッチする（ `[^A-Z]` と同義）                                |
| `\v`     | 垂直タブ文字にマッチする                                                        |
| `\a`     | ベル文字にマッチする                                                            |
| `\0`     | NULL文字にマッチする                                                            |

4. 位置マッチ

| メタ文字 | 意味                                                                                         |
| -------- | :------------------------------------------------------------------------------------------- |
| `(?=)`   | 肯定先読み（ `(?=` と `)` の間のパターンにマッチした部分文字列の先頭の位置にマッチする）     |
| `(?!)`   | 否定先読み（ `(?!` と `)` の間のパターンにマッチしない部分文字列の先頭の位置にマッチする）   |
| `(?<=)`  | 肯定後読み（ `(?<=` と `)` の間のパターンにマッチした部分文字列の末尾の位置にマッチする）   |
| `(?<!)`  | 否定後読み（ `(?<!` と `)` の間のパターンにマッチしない部分文字列の末尾の位置にマッチする） |
