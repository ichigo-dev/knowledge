# 『プロセッサ』ノート

（最終更新： 2023-03-06）


## 目次

1. [プロセッサ](#プロセッサ)
	1. [CPU](#cpu)
	1. [DSP](#dsp)
	1. [FPU](#fpu)
	1. [GPU](#gpu)
1. [CPUアーキテクチャ](#cpuアーキテクチャ)
	1. [ワイヤードロジック方式](#ワイヤードロジック方式)
	1. [マイクロプログラム方式](#マイクロプログラム方式)
	1. [RISC](#risc)
	1. [CISC](#cisc)
1. [レジスタ](#レジスタ)
	1. [命令レジスタ](#命令レジスタ)
	1. [プログラムカウンタ](#プログラムカウンタ)
	1. [ベースレジスタ](#ベースレジスタ)
	1. [インデックスレジスタ](#インデックスレジスタ)
	1. [アキュムレータ](#アキュムレータ)
	1. [汎用レジスタ](#汎用レジスタ)
1. [マシンサイクル](#マシンサイクル)
	1. [命令サイクル](#命令サイクル)
	1. [実行サイクル](#実行サイクル)
1. [命令の形式](#命令の形式)
	1. [オペレータ部](#オペレータ部)
	1. [オペランド部](#オペランド部)
1. [プロセッサの性能](#プロセッサの性能)
	1. [クロック](#クロック)
	1. [CPI](#cpi)
	1. [MIPS](#mips)
	1. [FLOPS](#flops)
	1. [命令ミックス](#命令ミックス)
1. [プロセッサの高速化](#プロセッサの高速化)
	1. [パイプライン](#パイプライン)
	1. [スーパパイプライン](#スーパパイプライン)
	1. [スーパスカラ](#スーパスカラ)
	1. [VLIW](#VLIW)
1. [マルチプロセッサ](#マルチプロセッサ)
	1. [密結合マルチプロセッサ](#密結合マルチプロセッサ)
	1. [疎結合マルチプロセッサ](#疎結合マルチプロセッサ)
	1. [MISD](#misd)
	1. [MIMD](#mimd)
1. [プロセッサの省電力技術](#プロセッサの省電力技術)
	1. [クロックゲーティング](#クロックゲーティング)
	1. [パワーゲーティング](#パワーゲーティング)
1. [割込み](#割込み)
	1. [内部割込み](#内部割込み)
	1. [外部割込み](#外部割込み)


## プロセッサ

**プロセッサ**は、[コンピュータ](../../../_/chapters/computer.md#コンピュータ)を動作させるための[ハードウェア](./hardware.md#ハードウェア)で、[処理装置](./hardware.md#処理装置)にあたる。プロセッサは[機械語](../../../../basics/information_theory/_/chapters/compiler_theory.md#機械語)の命令を実行するための[ハードウェア](./hardware.md#ハードウェア)であり、[プログラム](../../../../programming/_/chapters/programming.md#プログラム)がプロセッサに対応していないと実行することができない。また、プロセッサの性能は[コンピュータ](../../../_/chapters/computer.md#コンピュータ)の処理性能に直結するため、プロセッサが[プログラム](../../../../programming/_/chapters/programming.md#プログラム)の実行要件を満たしていない場合は[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が利用できない場合がある。

### CPU

**CPU**（**中央演算処理装置**、Central Processing Unit）は、一般的な[コンピュータ](../../../_/chapters/computer.md#コンピュータ)に含まれている[プロセッサ](#プロセッサ)。

### DSP

**DSP**(Digital Signal Processor)は、[A/D変換](../../../../basics/measurement_and_control/_/chapters/signal_processing.md#ad変換)などの[デジタル](../../../../basics/information_theory/_/chapters/coding_theory.md#デジタル)信号処理に特化した[プロセッサ](#プロセッサ)。

### FPU

**FPU**(Floating Point Unit)は、[浮動小数点](../../../../basics/discrete_mathematics/_/chapters/numeric_representation.md#浮動小数点数)[演算](../../../../programming/_/chapters/operation.md#演算)に特化した[プロセッサ](#プロセッサ)。

### GPU

**GPU**(Graphics Processing Unit)は、画像処理のための[行列](../../../../basics/applied_mathematics/_/chapters/numerical_calculation.md#行列)[演算](../../../../programming/_/chapters/operation.md#演算)に特化した[プロセッサ](#プロセッサ)。並列的な[演算](../../../../programming/_/chapters/operation.md#演算)を得意としているため、[ディープラーニング](../../../../artificial_intelligence/_/chapters/machine_learning.md#ディープラーニング)などにも利用されている。


## CPUアーキテクチャ

### ワイヤードロジック方式

**ワイヤードロジック方式**（**結線論理**）は、[プロセッサ](#プロセッサ)における命令の実行方式のひとつで、[ハードウェア](./hardware.md#ハードウェア)による物理的な結線により命令を実行する。

[マイクロプログラム方式](#マイクロプログラム方式)に比べて高速である一方、複雑な命令の実行や拡張には不利。

### マイクロプログラム方式

**マイクロプログラム方式**は、[プロセッサ](#プロセッサ)における命令の実行方式のひとつで、[CPU](#cpu)内の**マイクロプログラム**（**マイクロコード**）を使用して複雑な命令を実装する。マイクロプログラムは**制御記憶**(CS: Control Storage)と呼ばれる[記憶装置](./hardware.md#記憶装置)に格納される。

[ワイヤードロジック方式](#ワイヤードロジック方式)に比べて低速であるが、命令の追加や拡張が容易である。

### RISC

**RISC**(Reduced Instruction Set Computer)は、[ワイヤードロジック方式](#ワイヤードロジック方式)を採用した[CPUアーキテクチャ](#cpuアーキテクチャ)。用意されている命令の数が少ないが、その分1回の命令の処理時間が短い。また、命令の処理時間は固定長。

### CISC

**CISC**(Complex Instruction Set Computer)は、[マイクロプログラム方式](#マイクロプログラム方式)を採用した[CPUアーキテクチャ](#cpuアーキテクチャ)。複雑な処理が短い命令で記述できるため、[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が短くて済む。また、命令の処理時間は命令ごとに異なる。


## レジスタ

**レジスタ**は、[CPU](#cpu)に内蔵されている[記憶装置](./hardware.md#記憶装置)で、[コンピュータ](../../../_/chapters/computer.md#コンピュータ)内部の[記憶装置](./hardware.md#記憶装置)の中でも最も高速で操作する。ただし、記憶できる容量は少ない。

### 命令レジスタ

**命令レジスタ**は、取り出した命令を一時的に格納しておくための[レジスタ](#レジスタ)。

### プログラムカウンタ

**プログラムカウンタ**は、次に実行する命令が格納されている[メモリ](./memory.md#メモリ)の[アドレス](./memory.md#アドレス)を格納しておくための[レジスタ](#レジスタ)。

### ベースレジスタ

**ベースレジスタ**は、[プログラム](../../../../programming/_/chapters/programming.md#プログラム)を[メモリ](./memory.md#メモリ)上にロードしたときの先頭[アドレス](./memory.md#アドレス)を格納しておくための[レジスタ](#レジスタ)。

### インデックスレジスタ

**インデックスレジスタ**は、連続したデータの取り出しに用いるための[レジスタ](#レジスタ)で、先頭からの相対位置を格納している。[配列](../../../../programming/_/chapters/data_type.md#配列)などのデータ構造を扱う際に利用される。

### アキュムレータ

**アキュムレータ**は、[演算](../../../../programming/_/chapters/operation.md#演算)の結果を一時的に格納しておくための[レジスタ](#レジスタ)。

### 汎用レジスタ

**汎用レジスタ**は、役割を限定せずに状況に応じて様々な使い方ができる[レジスタ](#レジスタ)。


## マシンサイクル

**マシンサイクル**は、[プロセッサ](#プロセッサ)が1つの命令を取り出してから実行するまでの流れのことで、[プロセッサ](#プロセッサ)はマシンサイクルを繰り返すことで[プログラム](../../../../programming/_/chapters/programming.md#プログラム)を実行している。

マシンサイクルは大きく分けて[命令サイクル](#命令サイクル)と[実行サイクル](#実行サイクル)に分けることができる。さらに、サイクルの中で行われる処理を**ステージ**と呼ばれるいくつかの段階に分けて考える。

### 命令サイクル

**命令サイクル**（**Iサイクル**: Instruction fetch cycle）は、[マシンサイクル](#マシンサイクル)のうち、実行する命令を[主記憶装置](./hardware.md#主記憶装置)から取り出す段階。命令サイクルは大きく2つの[ステージ](#マシンサイクル)に分けることができる。

- **フェッチ** : [プログラムカウンタ](#プログラムカウンタ)の指す[アドレス](./memory.md#アドレス)をもとに、[主記憶装置](./hardware.md#主記憶装置)に格納された命令1つを[命令レジスタ](#命令レジスタ)に取り出す
- [プログラムカウンタ](#プログラムカウンタ)の更新 : 次の命令の実行に備えて、[プログラムカウンタ](#プログラムカウンタ)の値をカウントアップする

### 実行サイクル

**実行サイクル**（**Eサイクル**、Execution cycle）は、[マシンサイクル](#マシンサイクル)のうち、命令を実行する段階。実行サイクルは大きく4つの[ステージ](#ステージ)に分けることができる。

- **デコード** : 取り出した命令を解読する
- 実行[アドレス](./memory.md#アドレス)の計算 : [オペランド](#オペランド部)部分の[アドレス](./memory.md#アドレス)を計算して、[メモリ](./memory.md#メモリ)内のデータの場所を求める
- [オペランド](#オペランド部)の読み出し : 計算した実行[アドレス](./memory.md#アドレス)から対象となるデータを[汎用レジスタ](#汎用レジスタ)に読み出す
- 命令の実行 : [汎用レジスタ](#汎用レジスタ)からデータを取り出して、[演算装置](./hardware.md#演算装置)で[演算](../../../../programming/_/chapters/operation.md#演算)を行い、結果を[汎用レジスタ](#汎用レジスタ)または[主記憶装置](./hardware.md#記憶装置)に書き出す


## 命令の形式

1つの命令は、[オペレータ部](#オペレータ部)と[オペランド部](#オペランド部)から構成されている。

[オペランド部](#オペランド部)は命令の種類によって数が異なり、[オペランド部](#オペランド部)を持たない命令を**0アドレス方式**、[オペランド部](#オペランド部)を1つ持つ命令を**1アドレス方式**、[オペランド部](#オペランド部)を2つ持つ命令を**2アドレス方式**、[オペランド部](#オペランド部)を3つ持つ命令を**3アドレス方式**という。

### オペレータ部

**オペレータ部**は、[演算](../../../../programming/_/chapters/operation.md#演算)の種類を指定する[オペコード](../../../../basics/information_theory/_/chapters/compiler_theory.md#オペコード)が格納される部分。

### オペランド部

**オペランド部**は、命令の実行対象となるデータの[アドレス](./memory.md#アドレス)情報が格納される部分。オペランド部はアドレス修飾部とアドレス部からなる。

- **アドレス修飾部** : アドレスの指定方式やアドレス修飾を行う[レジスタ](#レジスタ)の指定
- **アドレス部** : [主記憶装置](./hardware.md#主記憶装置)の[アドレス](#アドレス)や[汎用レジスタ](#汎用レジスタ)の番号などの指定

アドレス部の指定方式としては次のような種類がある。

- **即値アドレス方式** : オペランド部の内容をそのままデータとして扱う
- **直接アドレス方式** : オペランド部の内容が[主記憶装置](./hardware.md#主記憶装置)上のデータの[アドレス](./memory.md#アドレス)を示している
- **間接アドレス方式** : オペランド部の内容が[主記憶装置](./hardware.md#主記憶装置)上でデータへの[ポインタ](../../../../programming/_/chapters/data_type.md#ポインタ型)を格納した[アドレス](./memory.md#アドレス)を示している
- **指標アドレス方式** : オペランド部の内容がある基準からの相対位置を示しており、第3オペランドで基準となる[アドレス](./memory.md#アドレス)が格納された[レジスタ](#レジスタ)を指定する


## プロセッサの性能

### クロック

**クロック**は、[コンピュータ](../../../_/chapters/computer.md#コンピュータ)の[マザーボード](./hardware.md#マザーボード)上にある複数の装置をタイミングを合わせて動作させるための信号。クロックの単位時間当たりの発生回数のことを**クロック周波数**といい、基本的にはこの値が大きいほど[プロセッサ](#プロセッサ)は高速に動作する。

### CPI

**CPI**(Cycles Per Instruction)は、1命令の実行に必要な[クロック](#クロック)数を表す単位。この値が小さいほど[プロセッサ](#プロセッサ)は高速に動作する。

### MIPS

**MIPS**(Million Instructions Per Second)は、1秒間に実行可能な命令数の単位。この値が大きいほど[プロセッサ](#プロセッサ)は高速に動作する。

### FLOPS

**FLOPS**(Floating-point Operations Per Secnod)は、1秒間に実行可能な[浮動小数点](../../../../basics/discrete_mathematics/_/chapters/numeric_representation.md#浮動小数点数)[演算](../../../../programming/_/chapters/operation.md#演算)の命令数の単位。

### 命令ミックス

**命令ミックス**は、[CPU](#cpu)の処理性能を評価するための尺度のひとつ。各命令ごとの実行時間を使用頻度に応じて重み付けし、平均命令実行時間を算出したもの。

事務処理用の**コマーシャルミックス**と、科学計算用の**ギブソンミックス**がある。


## プロセッサの高速化

### パイプライン

**パイプライン**は、命令[ステージ](#マシンサイクル)を独立して動作させることによって、複数の命令を並行して実行する方式。パイプラインにおいて最も効果を発揮するのは、各[ステージ](#マシンサイクル)の処理時間が同じ場合。そのため、パイプラインに向いているは[RISC](#risc)アーキテクチャである。

分岐命令などによって順番が変化すると、**パイプラインハザード**が発生する。パイプラインハザードとは、複数の命令を実行する場合に、命令の処理を中断しなければいけない状況のこと。

- **制御ハザード** : 分岐処理などで処理の順番が変わる
- **データハザード** : 複数の処理で同じデータを扱うことにより不具合が生じる
- **構造ハザード** : 同じ[ハードウェア](./hardware.md#ハードウェア)を同時に使用することによる競合が原因

### スーパパイプライン

**スーパパイプライン**は、[ステップ](#マシンサイクル)を更に細分化することで一度に実行できる命令数を増やす方法。

### スーパスカラ

**スーパスカラ**は、[パイプライン](#パイプライン)の[ステージ](#マシンサイクル)を複数同時に実行させることで効率化を実現する方法。

### VLIW

**VLIW**（**超長命令語**: Very Long Instruction Word）は、命令語を長くすることで複数の機能を一度に実行できるようにしたもの。[パイプライン](#パイプライン)と組み合わせることもできる。


## マルチプロセッサ

**マルチプロセッサ**は、複数の[プロセッサ](#プロセッサ)を同時に稼働させることで高速化を図る方法。

### 密結合マルチプロセッサ

**密結合マルチプロセッサ**は、複数の[プロセッサ](#プロセッサ)が[主記憶](./hardware.md#主記憶装置)を共有する形式。外見上1つに見える[プロセッサ](#プロセッサ)（コア）を封入した**マルチコアプロセッサ**という形態も密結合マルチプロセッサの一種。

### 疎結合マルチプロセッサ

**疎結合マルチプロセッサ**は、複数の[プロセッサ](#プロセッサ)にそれぞれ別の[主記憶](./hardware.md#主記憶装置)を割り当てる形式。複数の独立した[コンピュータ](../../../_/chapters/computer.md#コンピュータ)システムを用いるのと同じなので、高速な通信システムによりデータのやり取りを行う。**クラスタシステム**などは疎結合マルチプロセッサの一種。

### MISD

**MISD**(Multiple Instruction stream, Single Data stream)は、[マルチプロセッサ](#マルチプロセッサ)の[コンピュータ](../../../_/chapters/computer.md#コンピュータ)システムにおいて、複数の[プロセッサ](#プロセッサ)で同じデータに対して異なる処理を実行する方式。

### MIMD

**MIMD**(Multiple Instruction stream, Multiple Data stream)は、[マルチプロセッサ](#マルチプロセッサ)の[コンピュータ](../../../_/chapters/computer.md#コンピュータ)システムにおいて、[プロセッサ](#プロセッサ)ごとに異なる命令を実行する方式。


## プロセッサの省電力技術

### クロックゲーティング

**クロックゲーティング**は、動作していない回路ブロックへの[クロック](#クロック)供給を停止する方法。

### パワーゲーティング

**パワーゲーティング**は、動作していない回路ブロックへの電力供給を遮断する方法。


## 割込み

**割込み**は、実行中の[プログラム](../../../../programming/_/chapters/programming.md#プログラム)を中断して別の処理を行う処理。

### 内部割込み

**内部割込み**（**ソフトウェア割込み**）は、実行中の[プログラム](../../../../programming/_/chapters/programming.md#プログラム)の内部からの[割込み](#割込み)。

- **プログラム割込み** : [プログラム](../../../../programming/_/chapters/programming.md#プログラム)内で0除算や[オーバフロー](../../../../basics/discrete_mathematics/_/chapters/arithmetic_operation_and_precision.md#オーバフロー)が起こったときに発生
- **SVC割込み** : **SVC**(Super Visor Call)とは、[カーネル](../../../software/_/chapters/operating_system.md#カーネル)を呼び出すための命令のこと。[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が[OS](../../../software/_/chapters/operating_system.md#オペレーティングシステム)に処理を依頼するときに行われる
- **ページフォールト** : [仮想記憶管理](../../../software/_/chapters/operating_system.md#仮想記憶管理)において、存在しない[ページ](../../../software/_/chapters/operating_system.md#ページ)にアクセスするときに行われる

### 外部割込み

**外部割込み**（**ハードウェア割込み**）は、実行中の[プログラム](../../../../programming/_/chapters/programming.md#プログラム)以外の、[ハードウェア](./hardware.md#ハードウェア)関連の[割込み](#割込み)。

- **タイマ割込み** : タイマから行われる
- **機械チェック割込み** : [ハードウェア](./hardware.md#ハードウェア)の異常が検出されたときに行われる
- **入出力割込み** : [キーボード](./io_unit.md#キーボード)などの[入出力装置](./io_unit.md)から行われる
- **コンソール割込み** : コンソールからスイッチが行われたときに発生する


## 参考文献

- [角谷一成.令和05年 基本情報技術者合格教本.株式会社技術評論社, 2022, 575](https://gihyo.jp/book/2022/978-4-297-13164-7)
- [瀬戸美月.徹底攻略 応用情報技術者教科書 令和4年度.株式会社インプレス, 2021, 814](https://book.impress.co.jp/books/1121101057)
