# 『プロセッサ』ノート

（最終更新： 2023-03-03）


## 目次

1. [プロセッサ](#プロセッサ)
	1. [CPU](#cpu)
	1. [DSP](#dsp)
	1. [FPU](#fpu)
	1. [GPU](#gpu)
1. [CPUアーキテクチャ](#cpuアーキテクチャ)
	1. [ワイヤードロジック方式](#ワイヤードロジック方式)
	1. [マイクロプログラム方式](#マイクロプログラム方式)
	1. [CISC](#cisc)
	1. [RISC](#risc)
1. [レジスタ](#レジスタ)
	1. [命令レジスタ](#命令レジスタ)
	1. [プログラムカウンタ](#プログラムカウンタ)
	1. [ベースレジスタ](#ベースレジスタ)
	1. [インデックスレジスタ](#インデックスレジスタ)
	1. [アキュムレータ](#アキュムレータ)
	1. [汎用レジスタ](#汎用レジスタ)
1. [マシンサイクル](#マシンサイクル)
	1. [命令サイクル](#命令サイクル)
	1. [実行サイクル](#実行サイクル)
1. [命令の形式](#命令の形式)
	1. [オペレータ部](#オペレータ部)
	1. [オペランド部](#オペランド部)
1. [プロセッサの性能](#プロセッサの性能)
	1. [クロック](#クロック)
	1. [CPI](#cpi)
	1. [MIPS](#mips)
	1. [FLOPS](#flops)
	1. [命令ミックス](#命令ミックス)
1. [プロセッサの高速化](#プロセッサの高速化)
	1. [パイプライン](#パイプライン)
	1. [スーパパイプライン](#スーパパイプライン)
	1. [スーパスカラ](#スーパスカラ)
	1. [VLIW](#VLIW)
1. [マルチプロセッサ](#マルチプロセッサ)
	1. [密結合マルチプロセッサ](#密結合マルチプロセッサ)
	1. [疎結合マルチプロセッサ](#疎結合マルチプロセッサ)
	1. [MISD](#misd)
	1. [MIMD](#mimd)
1. [プロセッサの省電力技術](#プロセッサの省電力技術)
	1. [クロックゲーティング](#クロックゲーティング)
	1. [パワーゲーティング](#パワーゲーティング)
1. [割込み](#割込み)
	1. [内部割込み](#内部割込み)
	1. [外部割込み](#外部割込み)
1. [エンディアン](#エンディアン)
	1. [ビッグエンディアン](#ビッグエンディアン)
	1. [リトルエンディアン](#リトルエンディアン)
	1. [ネットワークバイトオーダ](#ネットワークバイトオーダ)


## プロセッサ

**プロセッサ**は、コンピュータを動作させるための[ハードウェア](./baisc_knowledge_of_hardware.md#ハードウェア)で、[処理装置](./baisc_knowledge_of_hardware.md#処理装置)にあたる。プロセッサは機械語の命令を実行するためのハードウェアであり、プログラムがプロセッサに対応していないと実行することができない。また、プロセッサの性能はコンピュータの処理性能に直結するため、プロセッサがプログラムの実行要件を満たしていない場合はプログラムが利用できない場合がある。

### CPU

**CPU**（**中央演算処理装置**、Central Processing Unit）は、一般的なコンピュータに含まれている[プロセッサ](#プロセッサ)。

### DSP

**DSP**(Digital Signal Processor)は、A/D変換などのデジタル信号処理に特化した[プロセッサ](#プロセッサ)。

### FPU

**FPU**(Floating Point Unit)は、浮動小数点演算に特化した[プロセッサ](#プロセッサ)。

### GPU

**GPU**(Graphics Processing Unit)は、画像処理のための行列演算に特化した[プロセッサ](#プロセッサ)。並列的な演算を得意としているため、ディープラーニングなどにも利用されている。



## CPUアーキテクチャ

### ワイヤードロジック方式

**ワイヤードロジック方式**（**結線論理**）はプロセッサにおける命令の実行方式のひとつで、ハードウェアによる物理的な結線により命令を実行する。

[マイクロプログラム方式](#マイクロプログラム方式)に比べて高速である一方、複雑な命令の実行や拡張には不利。

### マイクロプログラム方式

**マイクロプログラム方式**はプロセッサにおける命令の実行方式のひとつで、CPU内の**マイクロプログラム**（**マイクロコード**）を使用して複雑な命令を実装する。マイクロプログラムは**制御記憶**(CS: Control Storage)と呼ばれる記憶装置に格納される。

[ワイヤードロジック方式](#ワイヤードロジック方式)に比べて低速であるが、命令の追加や拡張が容易である。

また、マイクロプログラムはハードウェアとソフトウェアの中間的な立ち位置にあるため、[ファームウェア](../../_/chapters/baisc_knowledge_of_hardware.md#ファームウェア)と呼ばれる。

### CISC

**CISC**(Complex Instruction Set Computer)は、[マイクロプログラム方式](#マイクロプログラム方式)を採用したCPUアーキテクチャ。複雑な処理が短い命令で記述できるため、プログラムが短くて済む。また、命令の処理時間は命令ごとに異なる。

### RISC

**RISC**(Reduced Instruction Set Computer)は、[ワイヤードロジック方式](#ワイヤードロジック方式)を採用したCPUアーキテクチャ。用意されている命令の数が少ないが、その分1回の命令の処理時間が短い。また、命令の処理時間は固定長。


## レジスタ

**レジスタ**とは、CPUに内蔵されている記憶装置で、コンピュータ内部の記憶装置の中でも最も高速で操作する。ただし、記憶できる容量は少ない。

### 命令レジスタ

**命令レジスタ**とは、取り出した命令を一時的に格納しておくための[レジスタ](#レジスタ)。

### プログラムカウンタ

**プログラムカウンタ**とは、次に実行する命令が格納されているメモリのアドレスを格納しておくための[レジスタ](#レジスタ)。

### ベースレジスタ

**ベースレジスタ**とは、プログラムをメモリ上にロードしたときの先頭アドレスを格納しておくための[レジスタ](#レジスタ)。

### インデックスレジスタ

**インデックスレジスタ**とは、連続したデータの取り出しに用いるための[レジスタ](#レジスタ)で、先頭からの相対位置を格納している。配列などのデータを扱う際に利用される。

### アキュムレータ

**アキュムレータ**とは、演算の結果を一時的に格納しておくための[レジスタ](#レジスタ)。

### 汎用レジスタ

**汎用レジスタ**とは、役割を限定せずに状況に応じて様々な使い方ができる[レジスタ](#レジスタ)。


## マシンサイクル

**マシンサイクル**とは、プロセッサが1つの命令を取り出して実行する流れのことで、プロセッサはマシンサイクルを繰り返すことでプログラムを実行している。

マシンサイクルは大きく分けて[命令サイクル](#命令サイクル)と[実行サイクル](#実行サイクル)に分けることができる。さらに、サイクルの中で行われる処理を**ステージ**と呼ばれるいくつかの段階に分けて考える。

### 命令サイクル

**命令サイクル**（**Iサイクル**、Instruction fetch cycle）とは、[マシンサイクル](#マシンサイクル)のうち実行する命令を主記憶装置から取り出す段階のこと。命令サイクルは大きく2つの[ステージ](#マシンサイクル)に分けることができる。

- **フェッチ** : [プログラムカウンタ](#プログラムカウンタ)の指すアドレスを基に、主記憶装置に格納された命令1つを[命令レジスタ](#命令レジスタ)に取り出す
- [プログラムカウンタ](#プログラムカウンタ)の更新 : 次の命令の実行に備えて、[プログラムカウンタ](#プログラムカウンタ)の値をカウントアップする

### 実行サイクル

**実行サイクル**（**Eサイクル**、Execution cycle）とは、[マシンサイクル](#マシンサイクル)のうち命令を実行する段階のこと。実行サイクルは大きく4つの[ステージ](#ステージ)に分けることができる。

- **デコード** : 取り出した命令を解読する
- 実行アドレスの計算 : オペランド部分のアドレスを計算してメモリ内のデータのアドレスを求める
- オペランドの読み出し : 計算した実行アドレスから対象となるデータを[汎用レジスタ](#汎用レジスタ)に読み出す
- 命令の実行 : [汎用レジスタ](#汎用レジスタ)からデータを取り出して[演算装置](./baisc_knowledge_of_hardware.md#演算装置)で演算を行い、結果を[汎用レジスタ](#汎用レジスタ)または[主記憶装置](./baisc_knowledge_of_hardware.md#記憶装置)に書き出す


## 命令の形式

1つの命令は、[オペレータ部](#オペレータ部)と[オペランド部](#オペランド部)から構成されている。

オペランド部は命令の種類によって数が異なり、オペランド部を持たない命令を**0アドレス方式**、オペランド部を1つ持つ命令を**1アドレス方式**、オペランド部を2つ持つ命令を**2アドレス方式**、オペランド部を3つ持つ命令を**3アドレス方式**という。

### オペレータ部

**オペレータ部**には、演算の種類を指定する[オペコード](../../../../basics/information_theory/_/chapters/compiler_theory.md#機械語)が格納される。

### オペランド部

**オペランド部**には、命令の実行対象となるデータのアドレス情報が格納される。オペランド部はアドレス修飾部とアドレス部からなる。

- **アドレス修飾部** : アドレス指定方式やアドレス修飾を行うレジスタの指定
- **アドレス部** : 主記憶装置のアドレスや汎用レジスタの番号などの指定

アドレス部の指定方式としては次のような種類がある。

- **即値アドレス方式** : オペランド部の内容をそのままデータとして扱う
- **直接アドレス方式** : オペランド部の内容が主記憶装置上のデータのアドレスを示している
- **間接アドレス方式** : オペランド部の内容が主記憶装置上でデータへのポインタを格納したアドレスを示している
- **指標アドレス方式** : オペランド部の内容がある基準からの相対位置を示しており、第3オペランドで基準となるアドレスが格納されたレジスタを指定する


## プロセッサの性能

### クロック

**クロック**とは、コンピュータのマザーボード上にある複数の装置をタイミングを合わせて動作させるための信号。クロックの単位時間当たりの発生回数のことを**クロック周波数**といい、基本的にはこの値が大きいほどプロセッサは高速に動作する。

### CPI

**CPI**(Cycles Per Instruction)とは、1命令の実行に必要な[クロック](#クロック)数を表す単位。この値が小さいほどプロセッサは高速に動作する。

### MIPS

**MIPS**(Million Instructions Per Second)とは、1秒間に実行可能な命令数の単位。この値が大きいほどプロセッサは高速に動作する。

### FLOPS

**FLOPS**(Floating-point Operations Per Secnod)とは、1秒間に実行可能な浮動小数点演算の命令数の単位。

### 命令ミックス

**命令ミックス**とは、CPUの処理性能を評価するための尺度のひとつ。各命令ごとの実行時間を使用頻度に応じて重み付けし、平均命令実行時間を産出する。

事務処理用の**コマーシャルミックス**と、科学計算用の**ギブソンミックス**がある。


## プロセッサの高速化

### パイプライン

**パイプライン**とは、命令ステージを独立して動作させることによって、複数の命令を並行して実行する方式。パイプラインにおいて最も効果を発揮するのは、各ステージの処理時間が同じ場合。そのため、パイプラインに向いているは[RISC](#risc)アーキテクチャである。

分岐命令などによって順番が変化すると、**パイプラインハザード**が発生する。パイプラインハザードとは、複数の命令を実行する場合に、命令の処理を中断しなければいけない状況のこと。

- **制御ハザード** : 分岐処理などで処理の順番が変わる
- **データハザード** : 複数の処理で同じデータを扱うことにより不具合が生じる
- **構造ハザード** : 同じハードウェアを同時に使用することによる競合が原因

### スーパパイプライン

**スーパパイプライン**とは、ステップを更に細分化することで一度に実行できる命令数を増やす方法。

### スーパスカラ

**スーパスカラ**とは、パイプラインのステージを複数同時に実行させることで効率化を実現する方法。

### VLIW

**VLIW**（**超長命令語**、Very Long Instruction Word）とは、命令語を長くすることで、複数の帰納を一度に実行できるようにしたもの。パイプラインと組み合わせることもできる。


## マルチプロセッサ

**マルチプロセッサ**とは、複数のプロセッサを同時に稼働させることで高速化を図る方法。

### 密結合マルチプロセッサ

**密結合マルチプロセッサ**とは、複数のプロセッサが主記憶を共有するもの。外見上1つに見えるプロセッサ（コア）を封入した**マルチコアプロセッサ**という形態も密結合マルチプロセッサの一種。

### 疎結合マルチプロセッサ

**疎結合マルチプロセッサ**とは、複数のプロセッサにそれぞれ別の主記憶を割り当てたもの。複数の独立したコンピュータシステムを用いるのと同じなので、高速な通信システムによりデータのやり取りを行う。**クラスタシステム**などは疎結合マルチプロセッサの一種。

### MISD

**MISD**(Multiple Instruction stream, Single Data stream)とは、複数のプロセッサで同じデータに対して異なる処理を実行する方式。

### MIMD

**MIMD**(Multiple Instruction stream, Multiple Data stream)とは、プロセッサごとに異なる命令を実行する方式。


## プロセッサの省電力技術

### クロックゲーティング

**クロックゲーティング**とは、動作していない回路ブロックへのクロック供給を停止する方法。

### パワーゲーティング

**パワーゲーティング**とは、動作していない回路ブロックへの電力供給を遮断する方法。


## 割込み

**割込み**とは、実行中のプログラムを中断して別の処理を行うこと。

### 内部割込み

**内部割込み**とは、実行中のプログラムの内部からの[割込み](#割込み)。**ソフトウェア割込み**とも呼ばれる。

- **プログラム割込み** : プログラム内で0除算やオーバフローが起こったときに発生
- **SVC割込み** : **SVC**(Super Visor Call)とは、カーネルを呼び出すための命令のこと。プログラムがOSに処理を依頼するときに行われる
- **ページフォールト** : 仮想記憶管理において、存在しないページにアクセスするときに行われる

### 外部割込み

**外部割込み**とは、実行中のプログラム以外の、ハードウェア関連の[割込み](#割込み)。**ハードウェア割込み**とも呼ばれる。

- **タイマ割込み** : タイマから行われる
- **機械チェック割込み** : ハードウェアの以上が検出されたときに行われる
- **入出力割込み** : キーボードなどの入出力装置から行われる
- **コンソール割込み** : コンソールからスイッチが行われたときに発生する


## エンディアン

**エンディアン**とは、複数バイトのデータを格納するときに、それをメモリに配置する方式のこと。

### ビッグエンディアン

**ビッグエンディアン**とは、データの上位バイトから順番にメモリに並べる方式。

### リトルエンディアン

**リトルエンディアン**とは、データの下位バイトから順番にメモリに並べる方式。

### ネットワークバイトオーダ

**ネットワークバイトオーダ**とは、エンディアンによる違いをなくすために、データ伝送時にビッグエンディアン方式に変換したデータを送信すること。


## 参考文献

- [角谷一成.令和05年 基本情報技術者合格教本.株式会社技術評論社, 2022, 575](https://gihyo.jp/book/2022/978-4-297-13164-7)
- [瀬戸美月.徹底攻略 応用情報技術者教科書 令和4年度.株式会社インプレス, 2021, 814](https://book.impress.co.jp/books/1121101057)
