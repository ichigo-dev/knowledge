# 『メモリ』ノート

（最終更新： 2023-03-03）


## 目次

1. [メモリ](#メモリ)
	1. [アドレス](#アドレス)
	1. [テキスト領域](#テキスト領域)
	1. [静的領域](#静的領域)
	1. [スタック領域](#スタック領域)
	1. [ヒープ領域](#ヒープ領域)
1. [記憶階層](#記憶階層)
1. [主記憶装置の種類](#主記憶装置の種類)
	1. [RAM](#ram)
	1. [ROM](#rom)
1. [メモリの誤り検出と訂正](#メモリの誤り検出と訂正)
1. [キャッシュメモリ](#キャッシュメモリ)
	1. [ヒット率](#ヒット率)
	1. [実行アクセス時間](#実行アクセス時間)
	1. [ダイレクトマップ方式](#ダイレクトマップ方式)
	1. [フルアソシアティブ方式](#フルアソシアティブ方式)
	1. [セットアソシアティブ方式](#セットアソシアティブ方式)
	1. [ライトスルー方式](#ライトスルー方式)
	1. [ライトバック方式](#ライトバック方式)
1. [メモリインタリーブ](#メモリインタリーブ)
1. [記憶領域の管理方式](#記憶領域の管理方式)
	1. [ファーストフィット方式](#ファーストフィット方式)
	1. [ベストフィット方式](#ベストフィット方式)


## メモリ

**メモリ**は、[コンピュータ](../../../_/chapters/computer.md#コンピュータ)上でデータを保持しておくための[記憶装置](./hardware.md#記憶装置)。

1つの[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が利用できるメモリ領域は役割ごとに、[テキスト領域](#テキスト領域)、[静的領域](#静的領域)、[スタック領域](#スタック領域)、[ヒープ領域](#ヒープ領域)の4つの領域に分類される。

### アドレス

**アドレス**（メモリアドレス）は、[メモリ](#メモリ)上でデータがどの位置に存在するかを表す概念で、データにアクセスするために必要となる情報。アドレスは[メモリ](#メモリ)上の保存領域1[バイト](../../../../basics/_/chapters/computer_and_number.md#バイト)ごとに固有のものが割り振られている。

### テキスト領域

**テキスト領域**は、[機械語](../../../../basics/information_theory/_/chapters/compiler_theory.md#機械語)に[コンパイル](../../../../programming/_/chapters/programming.md#コンパイル)された[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が格納される領域。この領域の[機械語](../../../../basics/information_theory/_/chapters/compiler_theory.md#機械語)命令が1行ずつ[プロセッサ](./memory.md#プロセッサ)に読み込まれていくことで[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が実行される。

### 静的領域

**静的領域**は、[グローバル変数](../../../../programming/_/chapters/variable.md#グローバル変数)などの静的変数が格納される領域。[プログラム](**テキスト領域**は、[機械語](../../../../basics/information_theory/_/chapters/compiler_theory.md#機械語)に[コンパイル](../../../../programming/_/chapters/programming.md#コンパイル)された[プログラム](../../../../programming/_/chapters/programming.md#プログラム)の開始から終了まで確保される。

### スタック領域

**スタック領域**は、[ローカル変数](../../../../programming/_/chapters/variable.md#ローカル変数)が格納される領域。[関数](../../../../programming/_/chapters/function.md#関数)が実行されるときに一時的に利用される。[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が利用できる[メモリ](#メモリ)領域の最下部から順番に[変数](../../../../programming/_/chapters/variable.md#変数)が積まれていき、使い終わった[変数](../../../../programming/_/chapters/variable.md#変数)は順番に取り除かれていく。[プリミティブ](../../../../programming/_/chapters/data_type.md#プリミティブ型)な[データ型](../../../../programming/_/chapters/data_type.md#型)などはスタック領域に直接格納され、[配列](../../../../programming/_/chapters/data_type.md#配列)や[オブジェクト型](../../../../programming/_/chapters/data_type.md#オブジェクト型)などのデータは[ポインタ](../../../../programming/_/chapters/data_type.md#ポインタ型)がスタック領域に格納される。

### ヒープ領域

**ヒープ領域**は、[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が動的に確保と解放を繰り返すことができる[メモリ](#メモリ)領域で、[コンパイル](../../../../programming/_/chapters/programming.md#コンパイル)時にサイズが決まっていないような可変長の[コンテナ](../../../../programming/_/chapters/data_type.md#コンテナ型)や[オブジェクト型](../../../../programming/_/chapters/data_type.md#オブジェクト型)のデータの実体が格納される。


## 記憶階層

**記憶階層**は、速度や容量の異なる複数の[記憶装置](./hardware.md#記憶装置)を階層的に組み合わせることで、全体として効率の良い記憶システムを構築したもの。それぞれの[記憶装置](./hardware.md#記憶装置)の間に**緩急記憶装置**を置くことで、各装置の速度ギャップを埋めることができる。

記憶階層は速度が早いものから順に、[レジスタ](./processor.md#レジスタ)、[主記憶装置](./hardware.md#主記憶装置)、[補助記憶装置](./auxiliary_memory_unit.md#補助記憶装置)となっている。また緩急記憶装置として、[レジスタ](./processor.md#レジスタ)と[主記憶装置](./hardware.md#主記憶装置)の間に[キャッシュメモリ](#キャッシュメモリ)、[主記憶装置](./hardware.md#主記憶装置)と[補助記憶装置](./auxiliary_memory_unit.md#補助既往装置)の間に**ディスクキャッシュ**がある。


## 主記憶装置の種類

### RAM

**RAM**(Random Access Memory)は、読み書きが可能な[メモリ](#メモリ)。電源の供給がなくなると内容が消えてしまうという性質から、**揮発性メモリ**とも呼ばれる。

**DRAM**(Dynamic RAM)は、一定時間たつとデータが消失してしまうという性質を持っており、低速で高消費電力である代わりに、安価で大容量である。1[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)の情報を記憶するメモリセルが、コンデンサとトランジスタで構成されている。また、放置しておくと自然に放電してしまうため、一定時間間隔でコンデンサを再充電する**リフレッシュ動作**が必要となる。現在ではほとんどの場合、システムの[バス](./bus.md#バス)と同期して動作する**SDRAM**(Synchronous DRAM)となっている。

**SRAM**(Static RAM)は、電源を切らない限り内容を保持し続けるという性質を持っており、高速で低消費電力である代わりに、高価で少容量である。[レジスタ](./processor.md#レジスタ)や[キャッシュメモリ](#キャッシュメモリ)として用いられる。1[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)の情報を記憶するメモリセルが、フリップフロップ回路で構成される。DRAMのようなリフレッシュ動作は不要。

### ROM

**ROM**(Read Only Memory)は、読み出し専用の[メモリ](#メモリ)。種類によっては全消去や書き込み、追記が可能なものもある。電源の供給がなくても記憶を保持することが可能であるという性質から、**不揮発性メモリ**とも呼ばれる。

**マスクROM**は、出荷時にデータが書き込まれており、内容の変更ができないROM。

**PROM**(Programmable ROM)は、特殊な装置により一度だけ書き込むことができるが、一度書き込んだものを消去できない。基本的に読み出し専用であり、[RAM](#ram)に比べると書き込みには時間がかかる。また、PROMの中でも**EPROM**は紫外線照射により内容の消去が可能で、再書き込みも可能。**EEPROM**は電気的に[バイト](../../../../basics/_/chapters/computer_and_number.md#バイト)単位での内容の書き換えが可能なもので、[BIOS](../../../software/_/chapters/operation_system.md#bios)や電子機器の制御[プログラム](../../../../programming/_/chapters/programming.md#プログラム)格納のために使用される。

**フラッシュメモリ**は、[ブロック](./auxiliary_memory_unit.md#ブロック)単位もしくは一括での大容量のデータの消去や書き込みができるように最適化されたROM。[USB](./bus.md#usb)[メモリ](#メモリ)や[SSD](./auxiliary_memory_unit.md#ssd)に利用されているが、本来はROMであるため、何度も書き換えを行うと劣化してしまう。


## メモリの誤り検出と訂正

[メモリ](#メモリ)が持つ誤り検出や訂正の方法としては、[パリティ](../../../../basics/communication_theory/_/chapters/transmission_theory.md#パリティ)や**ECC**(Error Correcting Code)（[ハミング符号](../../../../basics/communication_theory/_/chapters/transmission_theory.md#ハミング符号)を用いた信頼性の高いエラー訂正機構）、[CRC](../../../../basics/communication_theory/_/chapters/transmission_theory.md#crc)などが用いられる。


## キャッシュメモリ

**キャッシュメモリ**は、[プロセッサ](./processor.md#プロセッサ)と[メモリ](#メモリ)の性能差を埋めるために両者の間で用いられる[メモリ](#メモリ)。直近に使用したデータをキャッシュメモリに一時的に蓄えておくことで、同じデータを再利用したい場合に高速で読み出すことができるようになる。これは、[プログラム](../../../../programming/_/chapters/programming.md#プログラム)は直近にアクセスした命令やデータに再度アクセスすることが多い、という**プログラムの局所性**を利用している。

高速である必要があり、[CPU](./processor.md#cpu)のチップに内蔵されることが一般的。また、キャッシュメモリを多段構成にして、[CPU](./processor.md#cpu)から近い順に**1次キャッシュ**、**2次キャッシュ**とするものもある。

### ヒット率

**ヒット率**は、[キャッシュメモリ](#キャッシュメモリ)を用いて[CPU](./processor.md#cpu)と[メモリ](#メモリ)がやり取りをするときに、データが[キャッシュメモリ](#キャッシュメモリ)上にある[確率](../../../../basics/applied_mathematics/_/chapters/probability_and_statistics.md#確率)のこと。ヒット率が高いほど[キャッシュメモリ](#キャッシュメモリ)が使用される[確率](../../../../basics/applied_mathematics/_/chapters/probability_and_statistics.md#確率)が高く、高速な処理が可能となる。

一方で、呼び出したいデータが[キャッシュメモリ](#キャッシュメモリ)上に無い[確率](../../../../basics/applied_mathematics/_/chapters/probability_and_statistics.md#確率)を**NFP**(Not Found Probability)という。

### 実行アクセス時間

**実行アクセス時間**（**平均メモリアクセス時間**）は、[キャッシュメモリ](#キャッシュメモリ)にデータが存在する場合と存在しない場合を含めた平均的なデータへのアクセス時間。

```math
実行アクセス時間 = キャッシュメモリへのアクセス時間 \times ヒット率 + メモリへのアクセス時間 \times (1 - ヒット率)
```

### ダイレクトマップ方式

**ダイレクトマップ方式**は、[キャッシュメモリ](#キャッシュメモリ)におけるデータの格納方法のひとつで、[メモリ](#メモリ)の[アドレス](#アドレス)ごとに[キャッシュメモリ](#キャッシュメモリ)の格納場所がひとつに決まる。データの検索が高速であるが、衝突が起こりやすくなり[ヒット率](#ヒット率)が下がる。

### フルアソシアティブ方式

**フルアソシアティブ方式**は、[キャッシュメモリ](#キャッシュメモリ)におけるデータの格納方法のひとつで、[キャッシュメモリ](#キャッシュメモリ)の空いている[ブロック](./auxiliary_memory_unit.md#ブロック)に[メモリ](#メモリ)のデータを格納する。衝突は少ないものの、データの使用時に毎回検索が必要になるので低速。

**連想メモリ**(**CAM**: Content Addressable Memory)を使用することで検索を高速化している。

### セットアソシアティブ方式

**セットアソシアティブ方式**は、[キャッシュメモリ](#キャッシュメモリ)におけるデータの格納方法のひとつで、[キャッシュメモリ](#キャッシュメモリ)を複数のグループに分け、そのグループ内ならどこでも使えるようにしたもの。

[フルアソシアティブ方式](#フルアソシアティブ方式)と同様[連想メモリ](#フルアソシアティブ方式)によって検索を高速化している。

### ライトスルー方式

**ライトスルー方式**は、[キャッシュメモリ](#キャッシュメモリ)におけるデータの更新方法のひとつで、[プロセッサ](./processor.md#プロセッサ)が[キャシュメモリ](#キャッシュメモリ)に書き込みを行った場合に、同時に[メモリ](#メモリ)にもその内容を転送する。[スループット](../../../../system/_/chapters/system_performance_evaluation.md#スループット)は下がるが、**コヒーレント**（データの一貫性）は保たれる。

### ライトバック方式

**ライトバック方式**は、[キャッシュメモリ](#キャッシュメモリ)におけるデータの更新方法のひとつで、[プロセッサ](./processor.md#プロセッサ)が[キャシュメモリ](#キャッシュメモリ)に書き込みを行った場合に、すぐには[メモリ](#メモリ)にその内容を転送しない。条件を満たした場合にのみ[メモリ](#メモリ)に書き込まれるため、[スループット](../../../../system/_/chapters/system_performance_evaluation.md#スループット)は上がるが、[コヒーレント](#ライトスルー方式)が保たれないことがある。


## メモリインタリーブ

**メモリインタリーブ**は、[CPU](./processor.md#cpu)と[メモリ](#メモリ)のデータ転送を高速化するための技術のひとつで、データを複数の**メモリバンク**に順番に分割して配置しておく方法。データを読み出すときに複数のメモリバンクにほぼ同時にアクセスすることで、効率よくデータを取り出すことができる。


## 記憶領域の管理方式

### ファーストフィット方式

**ファーストフィット方式**は、記憶領域を管理する[アルゴリズム](../../../../programming/_/chapters/algorithm.md#アルゴリズム)のひとつで、記憶領域の空き領域を[アドレス](#アドレス)の下位から順番に検索して最初に見つかった空き領域を割り当てる。

### ベストフィット方式

**ベストフィット方式**は、記憶領域を管理する[アルゴリズム](../../../../programming/_/chapters/algorithm.md#アルゴリズム)のひとつで、空き領域のうち要求されたサイズを満たす最小のものを割り当てる。


## 参考文献

- [角谷一成.令和05年 基本情報技術者合格教本.株式会社技術評論社, 2022, 575](https://gihyo.jp/book/2022/978-4-297-13164-7)
- [瀬戸美月.徹底攻略 応用情報技術者教科書 令和4年度.株式会社インプレス, 2021, 814](https://book.impress.co.jp/books/1121101057)
