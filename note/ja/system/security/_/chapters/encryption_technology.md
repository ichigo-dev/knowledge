# 『暗号化技術』ノート

（最終更新： 2023-06-09）


## 目次

1. [共通鍵暗号方式](#共通鍵暗号方式)
	1. [DES](#des)
	1. [AES](#aes)
	1. [RC4](#rc4)
1. [公開鍵暗号方式](#公開鍵暗号方式)
	1. [RSA](#rsa)
	1. [ECC](#ecc)
	1. [DSA](#dsa)
1. [ハッシュ](#ハッシュ)
	1. [衝突](#衝突)
	1. [MD5](#md5)
	1. [SHA-1](#sha-1)
	1. [SHA-2](#sha-2)
1. [デジタル署名](#デジタル署名)
	1. [タイムスタンプ認証](#タイムスタンプ認証)
1. [PKI](#pki)
	1. [認証局](#認証局)
	1. [登録局](#登録局)
	1. [発行局](#発行局)
	1. [CRL](#crl)
	1. [OCSP](#ocsp)
1. [SSL](#ssl)
	1. [TLS](#tls)
	1. [ドメイン認証](#ドメイン認証)
	1. [企業実在認証](#企業実在認証)
	1. [EV認証](#ev認証)
1. [IPsec](#ipsec)
1. [ステガノグラフィ](#ステガノグラフィ)


## 共通鍵暗号方式

**共通鍵暗号方式**は、同じ鍵を使用してデータを暗号化および復号化する暗号化方式。送信者と受信者が事前に同じ鍵を共有する必要がある。共通鍵暗号方式は、高速性と効率性に優れており、暗号化や復号化のプロセスが簡単で[計算量](../../../../basics/information_theory/_/chapters/computational_complexity.md#計算量)が少ないため、処理が迅速に行われる。ただし、共通鍵を安全に共有する必要があり、第三者から鍵を守るためにセキュアな方法で鍵を伝達しなければならない。

### DES

**DES**(Data Encryption Standard)は、アメリカの旧国家暗号規格として用いられていた、[共通鍵暗号方式](#共通鍵暗号方式)の[アルゴリズム](../../../../programming/_/chapters/algorithm.md#アルゴリズム)のひとつ。56[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)の鍵を用いるが、鍵長が短すぎるため、近年では安全ではないとみなされている。

### AES

**AES**(Advanced Encryption Standard)は、[DES](#des)の後継として現在広く使用されている、[共通鍵暗号方式](#共通鍵暗号方式)の[アルゴリズム](../../../../programming/_/chapters/algorithm.md#アルゴリズム)のひとつ。128[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)、192[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)、256[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)の鍵長をサポートしており、[DES](#des)よりも高いセキュリティレベルが得られる。データを固定サイズのブロックに分割して、ブロックごとに異なる置換操作を行うことで暗号化を行う。

### RC4

**RC4**(Rivest Cipher 4)は、[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)単位で随時暗号化を行う、ストリーム暗号化[アルゴリズム](../../../../programming/_/chapters/algorithm.md#アルゴリズム)のひとつ。非常に高速な暗号化[アルゴリズム](../../../../programming/_/chapters/algorithm.md#アルゴリズム)であり、リソース効率が高いため、一部の[アプリケーション](../../../../computer/software/_/chapters/software.md#応用ソフトウェア)や[プロトコル](../../../../network/_/chapters/network_architecture.md#プロトコル)で使用されていたが、[セキュリティ](./security.md#セキュリティ)上の問題が発見されたため非推奨となっている。


## 公開鍵暗号方式

**公開鍵暗号方式**は、異なる鍵のペアである公開鍵と秘密鍵を使用してデータを暗号化および復号化する暗号化方式。公開鍵は一般的に公開され、秘密鍵はセキュアに保護される。公開鍵暗号方式は、[セキュリティ](./security.md#セキュリティ)と鍵共有の容易さの点で優れている。

### RSA

**RSA**(Rivest Shamir Adleman)は、[公開鍵暗号方式](#公開鍵暗号方式)の[アルゴリズム](../../../../programming/_/chapters/algorithm.md#アルゴリズム)のひとつで、大きい数に対する素因数分解の困難さを安全性の根拠とした方式となっている。

鍵を生成する手順は以下の通り。

- 異なる2つの大きな素数 $p, q$ を生成する
- $n = pq$ とする
- $(p - 1)(q - 1)$ と互いに素な整数 $k_1$ をとる
- $k_1 k_2 \equiv 1 (mod (p - 1)(q - 1))$ となる $k_2$ をとる
- $n$ と $k_1$ を公開鍵として公開して、 $k_2$ は秘密鍵として公開しない

また、これらの鍵を用いて暗号化および復号化する手順は以下の通り。

- 送りたいメッセージを $m$ とする
- 公開鍵を用いて $m$ を $k_1$ 乗した後に、割った余りを $C$ （暗号文）とする
- 受信者は $C$ を $k_2$ 乗した後に、 $n$ で割ることで $m$ を復号できる

このような仕組みにより、送信者のメッセージは受信者にしか復号できない。

また、秘密鍵を用いて暗号化したメッセージを公開鍵で復号するということもできる。この場合、公開鍵は公開されている前提のため、機密性の確保はできないが、発信元の完全性・真正性は証明できるため、[デジタル署名](#デジタル署名)などに用いられる。

### ECC

**ECC**（**楕円曲線暗号**: Elliptic Curve Cryptography）は、[公開鍵暗号方式](#公開鍵暗号方式)のひとつで、[RSA](#rsa)と同じレベルの[セキュリティ](./security.md#セキュリティ)を実現するためにより短い鍵長を使用できるという特徴がある。ECCは、楕円曲線上の数学的な操作を元に暗号化を行う。鍵長が短いため、高いセキュリティレベルを維持しながら、処理速度の向上やリソース使用量の削減が可能となる。

### DSA

**DSA**(Digital Signature Algorithm)は、[公開鍵暗号方式](#公開鍵暗号方式)のひとつで、[デジタル署名](#デジタル署名)[アルゴリズム](../../../../programming/_/chapters/algorithm.md#アルゴリズム)として用いられる。データの改ざん検知や送信者の身元確認という[デジタル署名](#デジタル署名)において重要な機能を提供する。暗号化機能自体は持たないので、別の[共通鍵暗号方式](#共通鍵暗号方式)と併用されることが一般的。


## ハッシュ

**ハッシュ**は、任意長の入力データを固定長のデジタル指紋（ハッシュ値）に変換する数学的な関数。ハッシュ関数は入力データからハッシュ値を生成することは容易であるが、ハッシュ値から入力データを復元することは困難であり、異なる入力に対しては異なるハッシュ値が、同じ入力に対しては同じハッシュ値が生成される、という特徴がある。パスワード保存時にハッシュ値を保存したり、[ファイル](../../../../computer/software/_/chapters/file_system.md#ファイル)のダウンロード時にハッシュ値を提供してその[ファイル](../../../../computer/software/_/chapters/file_system.md#ファイル)の正当性を証明したりする、といった目的で使用される。

### 衝突

**衝突**は、[ハッシュ関数](#ハッシュ)において、異なる入力値に対して同じ[ハッシュ値](#ハッシュ)を出力してしまう問題。強力な[ハッシュ関数](#ハッシュ)は衝突が非常に低い[確率](../../../../basics/applied_mathematics/_/chapters/probability_and_statistics.md#確率)で起こるように設計されている。

### MD5

**MD5**(Message Digest Algorithm 5)は、[ハッシュ関数](#ハッシュ)の一種で、128[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)の固定長[ハッシュ値](#ハッシュ)を生成する。元々はメッセージの整合性チェックやデータの一意性の確認など、データの[ハッシュ](#ハッシュ)化に広く使用されていたが、[セキュリテイ](./security.md#セキュリティ)上の脆弱性が見つかったため、現在では非推奨となっている。具体的には、衝突抵抗性が低く、非常に高速で多数の[ハッシュ値](#ハッシュ)を計算できるため攻撃者が容易に事前計算や[レインボーテーブル](./cyber_attack.md#ブルートフォース攻撃)の作成を行えてしまう、という欠点がある。

### SHA-1

**SHA-1**(Secure Hash Algorithm 1)は、[ハッシュ関数](#ハッシュ)の一種で、[デジタル署名](#デジタル署名)やデータの整合性確認に使用されていた。現在は[セキュリティ](./security.md#セキュリティ)上の脆弱性が見つかっているため非推奨となっている。具体的には[MD5](#md5)と同じく、衝突抵抗性が低く、非常に高速で多数の[ハッシュ値](#ハッシュ)を計算できるため攻撃者が容易に事前計算や[レインボーテーブル](./cyber_attack.md#ブルートフォース攻撃)の作成を行えてしまう、という欠点がある。

### SHA-2

**SHA-2**(Secure Hash Algorithm 2)は、[SHA-1](#sha-1)の後継として開発された[ハッシュ関数](#ハッシュ)で、[セキュリティ](./security.md#セキュリティ)上の脆弱性を改善したより強力な[ハッシュ関数](#ハッシュ)として現在も広く採用されている。SHA-224、SHA-256、SHA-384、SHA-512などの異なる[ビット](../../../../basics/_/chapters/computer_and_number.md#ビット)長の[ハッシュ関数](#ハッシュ)を含むファミリーの総称で、強力な[セキュリティ](./security.md#セキュリティ)と高速な計算性能を持つ。


## デジタル署名

**デジタル署名**は、[公開鍵暗号方式](#公開鍵暗号方式)を利用して、電子的な文書やデータが改ざんされることを防止し、送信者の身元を証明する技術。

デジタル署名の流れは以下の通り。

- 署名者はキーペアを作成し、公開鍵を公開する
- 暗号化データの圧縮のため、[ハッシュ関数](#ハッシュ)を用いてデータの[ハッシュ値](#ハッシュ)を算出する
- 秘密鍵を用いて、[ハッシュ値](#ハッシュ)を暗号化する
- 暗号化した[ハッシュ値](#ハッシュ)とデータを受信者に送信する
- 受信者は公開鍵を使用して[ハッシュ値](#ハッシュ)を復号する
- 受信者は[ハッシュ関数](#ハッシュ)を使用して受信したデータを[ハッシュ](#ハッシュ)化し、受け取った[ハッシュ値](#ハッシュ)と同じ値になるか照合することで、データに改ざんがないことを確認する

### タイムスタンプ認証

**タイムスタンプ認証**は、公的な**タイムスタンプサービス**(Trusted Timestamp Authority)によって提供される、信頼できるタイムスタンプの署名。[デジタル署名](#デジタル署名)は、他者による改ざんは検出できるものの、本人による改ざんは検出できない。タイムスタンプを付与することによって、そのタイムスタンプが付与された時点において、ドキュメントが確かに存在しており、改ざんされていないことを証明できるようになる。


## PKI

**PKI**（公開鍵基盤: Public Key Infrastructure）は、[公開鍵暗号方式](#公開鍵暗号方式)において、公開鍵が送信者の正当なものであることを、第三者機関（[認証局](#認証局)）が保証する仕組み。

公開鍵の正当性を保証するための流れは以下の通り。

- 送信者は公開鍵と身分証明書を[登録局](#登録局)に登録する
- [登録局](#登録局)は[発行局](#発行局)にデジタル証明書の発行を依頼する
- [認証局](#認証局)は、[登録局](#登録局)と[発行局](#発行局)を経て、デジタル証明書を[認証局](#認証局)が発行した秘密鍵を用いて暗号化し、[デジタル署名](#デジタル署名)を作成する
- 送信者は[認証局](#認証局)が作成した[デジタル署名](#デジタル署名)を受け取り、これを受信者に送る
- 受信者は[認証局](#認証局)から公開鍵を受け取る
- 受信者は送信者から受け取った[デジタル署名](#デジタル署名)を公開鍵で復号する
- [デジタル署名](#デジタル署名)に含まれている送信者が発行した公開鍵と送信者の情報により、これが正当な公開鍵であることが確認できる

### 認証局

**認証局**(**CA**: Certificate Authority)は、[PKI](#pki)において公開鍵が送信者の正当なものであることを保証する、政府などの信頼できる第三者機関。[登録局](#登録局)と[発行局](#発行局)を合わせたものを指す。申請者の身元確認を行い、デジタル証明書を発行して署名を行い、証明書の信頼性と正当性を保証する役割を持つ。

### 登録局

**登録局**(**RA**: Registration Authority)は、[認証局](#認証局)の補助的な役割を担い、申請者の身元確認と、[発行局](#発行局)への証明書の発行依頼を行う。

### 発行局

**発行局**(**IA**: Issuing AUthority)は、[認証局](#認証局)の補助的な役割を担い、[登録局](#登録局)からの申請を受けて証明書の発行を行う。

### CRL

**CRL**(Certificate Revocation List)は、[認証局](#認証局)が発行する、証明書の失効情報が記載されているリスト。デジタル証明書の有効期限内に、秘密鍵が漏洩するなどの[セキュリティ](./security.md#セキュリティ)事故が起こるなどしてデジタル証明書の信頼性が損なわれた場合、[認証局](#認証局)にリストへの登録を依頼する必要がある。

### OCSP

**OCSP**(Online Certificate Status Protcol)は、デジタル証明書の実行情報を取得するための[プロトコル](../../../../network/_/chapters/network_architecture.md#プロトコル)で、[CRL](#crl)の代替として提案されている。失効情報を管理する[サーバ](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)（OCSPレスポンダ）に失効情報を問い合わせる際に使用される。


## SSL

**SSL**(Secure Sockets Layer)は、[セキュリティ](./security.md#セキュリティ)を要求される通信のための[プロトコル](../../../../network/_/chapters/network_architecture.md#プロトコル)。現在では単にSSLというと[TLS](#tls)のことを指す場合が多い。

### TLS

**TLS**(Transport Layer Security)は、[SSL](#ssl)をもとに実装された暗号化通信[プロトコル](../../../../network/_/chapters/network_architecture.md#プロトコル)の後継規格。データの暗号化、データの完全性の確保、通信相手の認証などの機能を提供し、ユーザの情報や通信内容を保護する。

- 通信が始まると、[サーバ](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)は[クライアント](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)にSSL証明書と公開鍵を送信する
- [クライアント](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)はSSL証明書により[サーバ](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)の正当性を確認する
- [クライアント](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)は共通鍵を作成し、公開鍵を使ってそれを暗号化する
- [クライアント](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)は暗号化した共通鍵を[サーバ](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)に送信する
- [サーバ](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)は[クライアント](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)から受け取った共通鍵を、秘密鍵によって復号する
- 以降、[サーバ](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)と[クライアント](../../../_/chapters/system_processing_model.md#クライアントサーバシステム)は共通鍵によりメッセージを暗号化して通信を行う

また、メッセージの暗号化に加えて、データの[ハッシュ値](#ハッシュ)を付加して通信を行うことで、改ざんの検出も行う。

### ドメイン認証

**ドメイン認証**(DV)は、SSL証明書の中でも最も簡単に取得できる認証方法で、申請者が[ドメイン](../../../../network/_/chapters/internet_layer.md#ドメイン名)の所有者であることを保証する。低価格でスピーディに取得できるため、個人の[Web](../../../../network/_/chapters/web.md#web)サイトや期間限定ページなどに広く使用されている。

### 企業実在認証

**企業実在認証**(OV)は、法人向けの認証方法で、[ドメイン認証](#ドメイン認証)に加え、[Web](../../../../network/_/chapters/web.md#web)サイトの運用組織の存在を確認する。第三者機関に情報登録している法人しか申請することができず、運営組織の実在性を情報紹介や電話確認などで認証するため、[ドメイン認証](#ドメイン認証)よりも信頼性の高い認証方法といえる。主に決済情報や個人情報を扱う法人サイトで用いられる。

### EV認証

**EV認証**は、SSL証明書の中で最も厳格な認証方法で、[ドメイン](../../../../network/_/chapters/internet_layer.md#ドメイン名)の所有者確認と運営組織の実在性を確認するが、[企業実在認証](#企業実在認証)よりも実在性を厳しくチェックする。第三者機関に法人情報があるだけでは審査は通らず、企業の活動実績も評価対象となる。最も厳格な認証であるため、大手企業や公的機関などの[ホームページ](../../../../network/_/chapters/web.md#web)に利用されることが多い。


## IPsec

**IPsec**(Security Architecture for Internet Protocol)は、[インターネット層](../../../../network/_/chapters/communication_protocol.md#インターネット層)において通信を暗号化するための[プロトコル](../../../../network/_/chapters/network_architecture.md#プロトコル)。上位層である[トランスポート層](../../../../network/_/chapters/communication_protocol.md#トランスポート層)や[アプリケーション層](../../../../network/_/chapters/communication_protocol.md#アプリケーション層)が暗号化に対応していない場合でも安全に通信が行える。

[パケット](../../../../network/_/chapters/network.md#パケット)が改ざんされていないことを保証する**AH**(Authentication Header)、[パケット](../../../../network/_/chapters/network.md#パケット)のペイロード部を暗号化する**ESP**(Encapsulationg Security Payload)、秘密鍵の交換を行うための**IKE**(Internet Key Exchange)から構成されている。


## ステガノグラフィ

**ステガノグラフィ**は、機密情報を他のデータ（画像や音声、ビデオなど）の中に隠匿する技術。あくまで情報を隠すための手法であり、暗号化ではない。
