# 『RDB』ノート

（最終更新： 2023-05-16）


## 目次

1. [リレーショナルモデル](#リレーショナルモデル)
	1. [エンティティ](#エンティティ)
	1. [アトリビュート](#アトリビュート)
	1. [テーブル](#テーブル)
	1. [レコード](#レコード)
	1. [カラム](#カラム)
	1. [結果セット](#結果セット)
	1. [プライマリキー](#プライマリキー)
	1. [外部キー](#外部キー)
1. [RDBの階層構造](#rdbの階層構造)
	1. [インスタンス](#インスタンス)
	1. [スキーマ](#スキーマ)
1. [ER図](#er図)
1. [正規化](#正規化)
	1. [非正規化形](#非正規化形)
	1. [第1正規化形](#第1正規化形)
	1. [第2正規化形](#第2正規化形)
	1. [第3正規化形](#第3正規化形)
1. [データ型](#データ型)
1. [null](#null)
1. [制約](#制約)
	1. [NOT NULL](#not-null)
	1. [PRIMARY KEY](#primary-key)
	1. [UNIQUE KEY](#unique-key)
	1. [FOREIGN KEY](#foreign-key)
	1. [CHECK](#check)


## リレーショナルモデル

**リレーショナルモデル**は、[リレーショナルデータベース](./database.md#リレーショナルデータベース)のデータモデル。

### エンティティ

**エンティティ**は、顧客、部品、地域などの、[データベース](./database.md#データベース)に格納される対象となるデータ。

### アトリビュート

**アトリビュート**は、[エンティティ](#エンティティ)が持つ属性。例えば、顧客という[エンティティ](#エンティティ)には、顧客番号、顧客名、顧客所属名などのアトリビュートを格納するといった具合。

### テーブル

**テーブル**は、関連する情報の集合を格納した表形式のデータ構造。[リレーショナルモデル](#リレーショナルモデル)における[エンティティ](#エンティティ)を、[コンピュータ](../../../../computer/_/chapters/computer.md#コンピュータ)が扱いやすいようにした形式で、データはストレージに格納されて永続的に保持される。

### レコード

**レコード**（**行**）は、[テーブル](#テーブル)に格納された実際のデータ。[エンティティ](#エンティティ)の各データの[アトリビュート](#アトリビュート)を説明するための[カラム](#カラム)の集合。

### カラム

**カラム**（**列**）は、[テーブル](#テーブル)が持つ情報。[リレーショナルモデル](#リレーショナルモデル)における[アトリビュート](#アトリビュート)を、[テーブル](#テーブル)の概念に合わせて定義したもの。

### 結果セット

**結果セット**は、[クエリ](./sql.md#クエリ)の結果として得られる、非永続的な[テーブル](#テーブル)。

### プライマリキー

**プライマリキー**（**主キー**）は、[テーブル](#テーブル)内の各[レコード](#レコード)に与えられる一意のIDとして用いることができる、1つ以上の[カラム](#カラム)。各[テーブル](#テーブル)はプライマリキーとして利用できる[カラム](#カラム)を持つことがほとんどで、各[レコード](#レコード)は必ずこの[カラム](#カラム)に一意の値を持つ必要がある。

### 外部キー

**外部キー**は、ある[テーブル](#テーブル)が別の[テーブル](#テーブル)の[レコード](#レコード)を一意に特定するための情報を持つ[カラム](#カラム)。この[制約](#制約)のある[カラム](#カラム)には、参照先の[テーブル](#テーブル)の[プライマリキー](#プライマリキー)として存在する値しか格納することができない。


## RDBの階層構造

リレーショナルデータベースは、インスタンス、データベース、スキーマ、オブジェクト（テーブル、インデックス、ストアドプロシージャなど）という4つの階層に分かれている。

### インスタンス

**インスタンス**は、DBMSの動作単位で、データベースよりも上の階層にある概念。OSからはプロセスとして見える。

### スキーマ

**スキーマ**は、データベースの下の階層で、テーブルを格納してまとめるディレクトリのようなもの。スキーマごとにアクセス制限をかけてセキュリティを向上させたり、用途によってテーブルを分けて管理したりすることができる。MySQLでは、データベースとスキーマを同一とみなしており、標準SQLの定める4階層構造ではなく3階層構造を採用している。


## ER図

**ER図**(Entity-Relationship deagram)は、現実の世界のエンティティとその関連性、エンティティが持つアトリビュートを図で示したもの。


## 正規化

**正規化**は、エンティティやアトリビュートをデータベースで管理しやすいように、正しくテーブルを分割したり、重複した項目を削除すること。1つのデータを1箇所で管理することで、データの整合性が保ちやすくなる。

### 非正規化形

**非正規化形**は、エンティティの情報をそのまま表現した形。1つのレコードが同じカラムに格納するべきアトリビュートを複数持つ可能性があるため、通常はそのままではデータベースに格納することはできない。

### 第1正規化形

**第1正規化形**は、同じカラムに格納するべきアトリビュートを複数持つレコードについては、アトリビュートの数だけ独立したレコードを用意した形。同じ候補キー（レコードを一意に特定するための属性）を持つレコードが複数存在する状態のため、候補キーを主キーとして扱うことはできない。また、候補キーとなるカラムが複数存在する可能性がある。

### 第2正規化形

**第2正規化形**は、同じテーブルの中で異なる候補キーに依存している部分を、別テーブルに分離した形。

### 第3正規化形

**第3正規化形**は、同じテーブルの中で候補キーではないアトリビュートに依存している部分を、別テーブルに分離した形。


## データ型

多くのRDBMSでは次のようなデータ型がサポートされている。具体的な性質などはRDBMSによって異なるので注意が必要。

| 種別         | データ型    | 概要                                                                                  |
|--------------|-------------|---------------------------------------------------------------------------------------|
| 文字型       | `char`      | 固定長文字列で、最大255バイトまで格納できる。定義時に最大長さを決める必要がある。    |
| 文字型       | `varchar`   | 可変長文字列で、最大65,535バイトまで格納できる。定義時に最大長さを決める必要がある。 |
| 文字型       | `text`      | より大きな文字列を扱うための型で、定義時に最大長さを決める必要がない。               |
| 整数型       | `tinyint`   | $-128 \sim 127$ の整数を扱う。                                                       |
| 整数型       | `samllint`  | $-32,768 \sim 32,767$ の整数を扱う。                                                 |
| 整数型       | `mediumint` | $-8,388,608 \sim 8,388,607$ の整数を扱う。                                           |
| 整数型       | `int`       | $-2,147,483,648 \sim 2,147,483,647$ の整数を扱う。                                   |
| 整数型       | `bigint`    | $-2^{63} sim 2^{63} - 1$ の整数を扱う。                                              |
| 浮動小数点型 | `float`     | 単精度の浮動小数点型を扱う。                                                         |
| 浮動小数点型 | `double`    | 倍精度の浮動小数点型を扱う。                                                         |
| 日時         | `date`      | `YYYY-MM-DD` 形式の日時を扱う。                                                      |
| 日時         | `datetime`  | `YYYY-MM-DD HH:MI:SS` 形式の日時を扱う。                                             |
| 日時         | `timestamp` | `YYYY-MM-DD HH:MI:SS` 形式の日時を扱う。 `datetime` よりも扱える範囲が狭い。         |
| 日時         | `year`      | `YYYY` 形式の日時を扱う。                                                            |
| 日時         | `time`      | `HH:MI:SS` 形式の日時を扱う。                                                        |
| 論理値型     | `boolean`   | 真偽値を扱う。                                                                       |


## null

**null**は、値がないことを表す値。値が不明であったり、未定義の場合にデータベースに代入される。


## 制約

**制約**は、テーブルの各カラムに格納されるデータに関する決まりごと。

### NOT NULL

**NOT NULL**は、カラムにnullが入ることを禁止する制約で、レコードの作成時に必ず値を保存しなければならない。

### PRIMARY KEY

**PRIMARY KEY**（**主キー**）は、そのテーブル内でレコードを一意に識別、特定することができるカラムにつけられる制約。ひとつのテーブルにはPRIMARY KEY制約を持つカラムが必ず1つ（0でも2つ以上でも不可）ないといけない。PRIMARY KEY制約のついたカラムにnullを格納することも禁止されている。

### UNIQUE KEY

**UNIQUE KEY**は、PRIMARY KEYと同様、そのテーブル内でレコードを一意に識別、特定することができるカラムにつけられる制約。UNIQUE KEYは同一テーブル内に複数指定することができる。UNIQUE KEYではNULLは禁止されていない。

### FOREIGN KEY

**FOREIGN KEY**（**外部キー**）は、他のテーブルのカラムを参照して、そのカラムに存在する値以外は格納できないという制約。結合の際に利用するカラムに対して指定する。FOREIGN KEY制約を用いる場合は、REFERENCESキーワードで参照するテーブルを指定する必要がある。

### CHECK

**CHECK**は、指定した条件に合致しないデータが格納できなくなる制約。
