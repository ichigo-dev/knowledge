# 『インデックス』

（最終更新： 2023-02-15）


## 目次

1. [インデックス](#インデックス)
	1. [一意なインデックス](#一意なインデックス)
	1. [複合インデックス](#複合インデックス)
1. [クエリ実行計画](#クエリ実行計画)
	1. [オプティマイザ](#オプティマイザ)
1. [カーディナリティ](#カーディナリティ)
1. [Bツリーインデックス](#bツリーインデックス)
1. [ハッシュインデックス](#ハッシュインデックス)
1. [ビットマップインデックス](#ビットマップインデックス)



## インデックス

**インデックス**は、データの検索を高速化するための仕組み。通常、データベースに格納されたデータはディスク上にきれいに整列しているとは限らないため、検索クエリが発行されるとすべてのデータを調べなければならない。

データが更新されるとインデックスを作り直す必要が出てくるため、更新処理には時間がかかる。また、インデックスは通常のデータとは別に作られるデータ構造であるため複数のインデックスを作ることはできるが、作りすぎると更新するべきインデックスも増えるため、更新処理により時間がかかるようになる。

### 一意なインデックス

**一意なインデックス**は、一意制約(UNIQUE KEY)を指定したカラムに適用されるインデックス。

### 複合インデックス

**複合インデックス**は、複数のカラムに対するインデックス。一方のカラムを中心にインデックスを作成し、その中で重複しているものについてはもう一方のカラムによって並べ替えられる。そのため、どちらのカラムを中心にインデックスを作成するかで、有効な検索条件や性能を活かせる場面が変わるので注意が必要。


## 実行計画

**クエリ実行計画**は、あるクエリを受け取った時に、オプティマイザによって選択されたそのクエリを実行するために用いられるプログラム。

### オプティマイザ

**オプティマイザ**は、あるクエリを受け取ったときに、どのような戦略でそのクエリを実行するのが良いかを選択するプログラム。インデックスを作成すると、通常の検索とインデックスを利用した検索という選択肢ができるため、オプティマイザはどちらを利用するのが良いかを判断してクエリを実行する。


## カーディナリティ

**カーディナリティ**は、あるカラムに格納されるデータの種類のこと。カーディナリティが高い（格納されるデータの種類が多い）カラムに対するインデックスほど効果が高い。


## Bツリーインデックス

**Bツリーインデックス**は、多くのRDBMSでデフォルトで採用されるインデックス。Bツリーは、1つのノードが3つ以上の子ノードを持つことができる平衡木で、木の深さが浅いため、データにたどり着くまでに必要なディスクアクセスが少ない。

Bツリーインデックスを使うと、完全一致検索と範囲検索、前方一致検索が高速化される。一方で、部分一致検索や後方一致検索、否定検索はすべてのデータを捜査する必要があるため、高速化されない。


## ハッシュインデックス

**ハッシュインデックス**は、ハッシュテーブルを利用したインデックス。データ自体にハッシュ関数を適用して格納する場所を決定するため、Bツリーよりも深さが浅く検索が速い。ただし、完全一致検索にしか用いることができない。


## ビットマップインデックス

**ビットマップインデックス**は、あるカラムが特定の条件を満たす場合に、対応するビットを1にしたビット列を用いるインデックス。ビット演算と同様のコストであるため、OR検索やAND検索との相性が良いのが特徴。カーディナリティが低いカラムに対しても有効なインデックスであるが、更新に時間がかかるというデメリットがある。
