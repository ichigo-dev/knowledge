# 『ネットワーキングとコンテンツ配信』

（最終更新： 2023-02-18）


## 目次

1. [VPC](#vpc)
	1. [ネットワークACL](#ネットワークacl)
	1. [セキュリティグループ](#セキュリティグループ)
	1. [インバウンドルール](#インバウンドルール)
	1. [アウトバウンドルール](#アウトバウンドルール)
	1. [ENI](#eni)
	1. [インターネットゲートウェイ](#インターネットゲートウェイ)
	1. [インタフェースエンドポイント](#インタフェースエンドポイント)
	1. [Gateway Load Balancerエンドポイント](#gateway-load-balancerエンドポイント)
	1. [ゲートウェイエンドポイント](#ゲートウェイエンドポイント)
1. [AWS Direct Connect](#aws-direct-connect)
1. [AWS PrivateLink](#aws-privatelink)
1. [AWS CloudFront](#aws-cloudfront)
1. [Amazon Route 53](#amazon-route-53)
	1. [ホストゾーン](#ホストゾーン)
	1. [Aliasレコード](#aliasレコード)
	1. [ルーティングポリシー](#ルーティングポリシー)
1. [ELB](#elb)
	1. [ALB](#alb)
	1. [NLB](#nlb)
	1. [CLB](#clb)
	1. [GWLB](#gwlb)


## VPC

**VPC**(Amazon Virtual Private Cloud)は、AWSのネットワーキングサービスの中心であり、プライベートな仮想ネットワークをAWS内に作成することができるサービス。自由なIPアドレスのアサインや、サブネットの作成、ルーティングテーブルやゲートウェイの設定など、仮想ネットワークを完全に制御することができる。

S3やCloudWatch、DynamoDBなど、VPCに入れることができないサービスも多数あるので注意。

### ネットワークACL

**ネットワークACL**は、VPCのセキュリティレイヤで、1つ以上のサブネットに出入りするトラフィックを制御するファイアウォールとして機能する。サブネット単位でインバウンドルールとアウトバウンドルールの許可・拒否設定をすることができる。ステートレスで、1つの通信で受信と送信のそれぞれに対して設定が必要。

### セキュリティグループ

**セキュリティグループ**は、VPC内のリソースに対するトラフィックを制御するファイアウォール機能。EC2やELB、RDSなどのインスタンス単位でインバウンドルールとアウトバウンドルールの許可設定をすることができる。プロトコルやポート範囲、IPアドレス、他のセキュリティグループなどを指定して通信を制御する。ステーフルで、通信の復路は動的に許可される。

### インバウンドルール

**インバウンドルール**は、ネットワークやコンピュータに対して外部からアクセスする際の規約。

### アウトバウンドルール

**アウトバウンドルール**は、ネットワークや機器から外部に向かって通信する際の規約。

### ENI

**ENI**(Elastic Network Interface)は、VPC内での仮想ネットワークインタフェースカード(NIC)を表す論理コンポーネント。インスタンスにアタッチしたりデタッチしたりすることで、IPアドレスやMACアドレスといったネットワークの属性を操作することができる。

### インターネットゲートウェイ

**インターネットゲートウェイ**(**IGW**)は、VPCをインターネットに接続するためのサービス。ひとつのVPCに対してひとつアタッチすることができ、VPCからインターネットへアクセスすることができるようになる。

### インタフェースエンドポイント

**インタフェースエンドポイント**は、AWS PrivateLinkを用いて、VPCと他のサービスをプライベートに接続するためのサービス。同じリージョン内のサービスにしか接続できない。

### Gateway Load Balancerエンドポイント

**Gateway Load Balancerエンドポイント**は、AWS PrivateLinkを用いて、VPCとロードバランサ（GWLB）を接続し、ロードバランサを経由して目的のサービスに接続する。ロードバランサを用いるため、スケールが容易となる。

### ゲートウェイエンドポイント

**ゲートウェイエンドポイント**は、VPCのルーティングテーブルにターゲットのグローバルIPアドレスを追加することでプライベートに接続するサービス。S3とDynamoDBにのみ対応しており、同じリージョン内のサービスにしか接続できない。


## AWS Direct Connect

**AWS Direct COnnect**は、AWSのクラウドサービスとオンプレミスのサーバなどを専用線でプライベート接続するためのサービス。インターネットを経由せず接続することができるので、高いセキュリティレベルを保持したまま安定した速度でデータの送受信が行える。


## AWS PrivateLink

**AWS PrivateLink**は、トラフィックをパブリックインターネットに公開することなく、VPC、AWS のサービス、およびオンプレミスネットワーク間のプライベート接続を実現するサービス。異なるVPC同士の接続や、VPCとPrivateLinkに対応したサービスとの接続などに用いられる（インタフェースエンドポイント）。それぞれのサービスにENIを追加するため、グローバルIPアドレスではなくプライベートIPアドレスを用いて接続が可能。


## AWS CloudFront

**AWS CloudFront**は、静的なコンテンツをキャッシュしておき、低レイテンシでユーザにコンテンツを配信するCDNサービス。世界中にエッジサーバが存在しており、あらゆる場所からのアクセスに対しても対応できる。また、オリジンサービスの負荷を軽減にもつながる。


## Amazon Route 53

**Amazon Route 53**は、ドメインの登録・管理やルーティングを行う、フルマネージドな権威DNSサービス。

### ホストゾーン

**ホストゾーン**は、Route 53におけるレコード情報（ドメイン名とIPアドレスの対応）を管理するコンテナ。

### Aliasレコード

**Aliasレコード**は、Route 53特有のレコードで、CloudFrontやELB、S3などのAWSリソースFQDN、Zone Apex（最上位ドメイン）を指定できる。

### ルーティングポリシー

**ルーティングポリシー**は、ゾーン情報の名前解決の問い合わせに対する応答の方針のこと。Route 53では次のようなポリシーを指定することができる。

- **シンプルルーティングポリシー** : 特別なルーティングポリシーを使わない1対1のルーティング。
- **フェイルオーバルーティングポリシー** : アクティブ/スタンバイ方式で、アクティブ側へのヘルスチェックが失敗したときにスタンバイ側のシステムへルーティングする。本番システム障害時にSorryサーバ（Webサイトやサービスが停止していることを知らせるサーバ）のIPアドレスをセカンダリレコードとして登録しておくなどの使い方。
- **位置情報ルーティングポリシー** : ユーザの位置情報に基づいてトラフィックをルーティングする。
- **地理的近接性ルーティングポリシー** : リソースの場所に基づいてトラフィックをルーティングする。
- **レイテンシルーティングポリシー** : 遅延が最も少ないサーバにリクエストをルーティングする。
- **複数値回答ルーティングポリシー** : 1つのレコードに異なるIPアドレスを複数登録して、ランダムに返却されたIPアドレスに接続する。ヘルスチェックがNGになったサーバのIPアドレスは返却されない。
- **加重ルーティングポリシー** : 指定した比率で複数のリソースにトラフィックをルーティングする。


## ELB

**ELB**(**Elastic Load Balancing**)は、AWSで提供されているロードバランササービス。

### ALB

**ALB**(**Application Load Balancer**)は、L7レイヤでの負荷分散を行うロードバランサ。IPアドレス、インスタンス、Lambdaなどをターゲットとして指定することができ、プロトコルとしてはHTTPやHTTPS、gRPCをサポートしている。Webサービスに最適なロードバランサ。

### NLB

**NLB**(**Network Load Balancer**)は、L4レイヤでの負荷分散を行うロードバランサ。IPアドレス、インスタンス、ALBなどをターゲットとして指定することができ、プロトコルとしてはTCPやUDP、TLSをサポートしている。HTTPプロトコル以外を扱いたい場合に最適なロードバランサ。

### CLB

**CLB**(**Classic Load Balancer**)は、L4-L7レイヤでの負荷分散を行うロードバランサ。クラシックなEC2インスタンスを対象としているため、新しいサービスを構築する場合は、用途に合わせてALBかNLBを用いることが推奨されている。

### GWLB

**GWLB**(**Gateway Load Balancer**)は、VPCのGateway Load Balancerエンドポイントに用いられるロードバランサ。VPCでサードパーティのセキュリティ製品を利用したい場合などに最適。
