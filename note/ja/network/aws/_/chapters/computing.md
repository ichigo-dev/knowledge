# 『コンピューティング』ノート

（最終更新： 2023-05-21）


## 目次

1. [EC2](#ec2)
	1. [AMI](#ami)
	1. [インスタンスタイプ](#インスタンスタイプ)
	1. [インスタンスファミリー](#インスタンスファミリー)
	1. [スポットインスタンス](#スポットインスタンス)
	1. [リザーブドインスタンス](#リザーブドインスタンス)
	1. [EBS最適化オプション](#ebs最適化オプション)
1. [Auto Scaling](#auto-scaling)
	1. [スケーリングポリシー](#スケーリングポリシー)
	1. [猶予期間](#猶予期間)
	1. [ウォームアップ](#ウォームアップ)
	1. [クールダウン](#クールダウン)
	1. [ライフサイクルフック](#ライフサイクルフック)
	1. [終了ポリシー](#終了ポリシー)
1. [ECS](#ecs)
1. [Lambda](#lambda)
1. [Elastic Beanstalk](#elastic-beanstalk)


## EC2

**EC2**(**Amazon Elastic Compute Cloud**)は、仮想[サーバ](../../../../computer/_/chapters/computer.md#サーバ)を提供するコンピューティングサービス。[AMI](#ami)を元にして容易に新しい[コンピュータ](../../../../computer/_/chapters/computer.md#コンピュータ)を構築することができ、**インスタンス**という単位で[サーバ](../../../../computer/_/chapters/computer.md#サーバ)が管理される。インスタンスには起動中(**Running**)、停止中(**Stopped**)、削除済み(**Terminated**)の3つの状態がある。

EC2は**従量課金型**のサービスで、[インスタンスタイプ](#インスタンスタイプ)や[リージョン](./aws.md#リージョン)と、インスタンスがRunning状態だった時間でコストが決まる。

### AMI

**AMI**(**Amazon Machine Image**)は、[EC2インスタンス](#ec2)の構築に必要な情報を集めたテンプレート。

### インスタンスタイプ

**インスタンスタイプ**は、[EC2インスタンス](#ec2)の性能を決定するもので、様々なユースケースに対応した[CPU](../../../../computer/hardware/_/chapters/processor.md#cpu)や[メモリ](../../../../computer/hardware/_/chapters/memory.md#メモリ)、[ストレージ](../../../../computer/hardware/_/chapters/hardware.md#記憶装置)、[ネットワーク](../../../_/chapters/network.md#ネットワーク)キャパシティの組み合わせが用意されている。

[インスタンス](#ec2)が何に最適化されているかを表す[インスタンスファミリー](#インスタンスファミリー)、そのインスタンスの**世代**、 `medium` や `xlarge` といった**インスタンスサイズ**の組み合わせで表現される。

### インスタンスファミリー

**インスタンスファミリー**は、その[インスタンス](#ec2)が何に最適化された[インスタンス](#ec2)であるかという分類を表し、[インスタンスタイプ](#インスタンスタイプ)の先頭に付与される。

| 種類                     | 特徴                                     | ファミリー       |
|--------------------------|------------------------------------------|------------------|
| 汎用                     | バランスの取れた汎用タイプで、比較的安価 | `T/M/A/Mac`      |
| コンピューティング最適化 | 高い計算能力                             | `C`              |
| メモリ最適化             | メモリを多く搭載                         | `R/X/z`          |
| 高速コンピューティング   | グラフィック演算や推論処理などに最適化   | `P/DL/G/F/V/Inf` |
| ストレージ最適化         | I/Oパフォーマンスが高く、大容量          | `I/D/H`          |

### スポットインスタンス

**スポットインスタンス**は、[AWS](./aws.md#aws)が余らせている[EC2](#ec2)リソースを入札形式で安く利用する形式。ただし、他の利用者からの利用リクエストが増えて余剰なリソースがなくなってしまうと、自動的に[インスタンス](#ec2)が中断される。開発用や学習用に相性のよいオプションといえる。

### リザーブドインスタンス

**リザーブドインスタンス**は、長期間利用することを約束することで割引を受けられるオプション。[インスタンスタイプ](#インスタンスタイプ)を固定してしまうことになるので、サービスのリリース後、安定してきてから購入することを検討するのがよい。

### EBS最適化オプション

**EBS最適化オプション**は、通常の[ネットワーク](../../../_/chapters/network.md#ネットワーク)[帯域](../../../_/chapters/network.md#帯域)とは別に、[EBS](./storage.md#ebs)用の[帯域](../../../_/chapters/network.md#帯域)を確保する[EC2インスタンス](#ec2)のオプション。[EBS](./storage.md#ebs)は[AWS](./aws.md#aws)のディスク機能であり、ディスクIOが頻繁な[システム](../../../../system/_/chapters/system.md#システム)ではこのオプションを有効にすることで[帯域](../../../_/chapters/network.md#帯域)が足りなくなることを防げる。


## Auto Scaling

**Auto Scaling**は、[システム](../../../../system/_/chapters/system.md#システム)の利用状況に応じて自動的に[ELB](./networking_and_content_delivery.md)に紐づく[インスタンス](#ec2)の台数を増減させる（[スケールアウト](../../../../system/_/chapters/system_performance_evaluation.md#スケールアウト)/[スケールイン](../../../../system/_/chapters/system_performance_evaluation.md#スケールイン)）機能。[インスタンス](#ec2)の最小・最大台数を設定しておき、障害発生などによって[インスタンス](#ec2)が[ヘルスチェック](../../../../system/_/chapters/reliability_design.md#ヘルスチェック)に失敗した場合に、自動的に[インスタンス](#ec2)数をキープする。

### スケーリングポリシー

**スケーリングポリシー**は、[Auto Scaling](#auto-scaling)による自動スケーリングを行う際の方針。スケーリングポリシーには、動的なスケーリング、予測スケーリング、スケジュールスケーリングなどがあり、動的なスケーリングのポリシーは更に以下のように分けられる。

- **簡易スケーリング** : 「CPU使用率が70%を超えたらスケールアウトする」といったように、1つのメトリクスに対して1つの閾値を設定してスケーリングを行う。
- **ステップスケーリング** : 1つのメトリクスに対して複数の閾値を設定することで、段階的にスケーリングの設定を行う。
- **ターゲット追跡スケーリング** : 1つのメトリクスに目標値を設定しておき、そのメトリクスを維持できるように動的にスケーリングする。

### 猶予期間

**猶予期間**は、[Auto Scaling](#auto-scaling)の[スケールアウト](../../../../system/_/chapters/system_performance_evaluation.md#スケールアウト)中に[ヘルスチェック](../../../../system/_/chapters/reliability_design.md#ヘルスチェック)を停止する機能。[スケールアウト](../../../../system/_/chapters/system_performance_evaluation.md#スケールアウト)による新しい[インスタンス](#ec2)の起動中に、別の新たな[インスタンス](#ec2)が起動されてしまうことを防ぐための仕組み。

### ウォームアップ

**ウォームアップ**は、新しい[インスタンス](#ec2)がサービスを開始してからトラフィックを受信できるまでの期間を設定しておき、その期間中に別の[スケーリングポリシー](#スケーリングポリシー)が適用される場合は2つのポリシーの差分のみが起動されるようにする機能。

[ステップスケーリング](#スケーリングポリシー)において、1つ目の[スケーリングポリシー](#スケーリングポリシー)によって[インスタンス](#ec2)が起動している途中で2つ目の[スケーリングポリシー](#スケーリングポリシー)によって更に[インスタンス](#インスタンス)が追加されるということが考えられる。例えば、1つ目の[スケーリングポリシー](#スケーリングポリシー)で[インスタンス](#ec2)が1台、2つ目の[スケーリングポリシー](#スケーリングポリシー)で[インスタンス](#ec2)が4台増える設定の場合、これらのポリシーが連続で適用された場合には5台の[インスタンス](#ec2)が起動される。しかし、最新の負荷状況を考えると、2つ目のポリシーのみを適用して4台の[インスタンス](#ec2)を起動したい。これを防ぐために、ウォームアップの機能を利用する。

### クールダウン

**クールダウン**は、[インスタンス](#ec2)の起動指示直後に待ち時間を設けることで、複数のアラートがきても次々に[インスタンス](#ec2)が立ち上がることを防ぐ機能。

[Auto Scaling](#auto-scaling)により新しい[インスタンス](#ec2)が起動された直後、ブートストラップなどの処理によって準備が整うまでに数分かかる場合があり、準備が整うまでの間に新しいアラートがくると連鎖的に複数の[インスタンス](#ec2)が起動されてしまう。これを防ぐために、クールダウンの機能を利用する。

### ライフサイクルフック

**ライフサイクルフック**は、[Auto Scaling](#auto-scaling)による[インスタンス](#ec2)の起動・削除時に、[インスタンス](#ec2)を一時停止してカスタムアクションを実行する機能。[インスタンス](#ec2)の削除時のログやデータの退避などに利用される。

### 終了ポリシー

**終了ポリシー**は、負荷が下がったときに[インスタンス](#ec2)を減らす（[スケールイン](../../../../system/_/chapters/system_performance_evaluation.md#スケールイン)）設定。


## ECS

**ECS**(**Amazon Elastic Container Service**)は、[Docker](../../../../development/docker/_/chapters/docker.md#docker)[コンテナ](../../../../development/docker/_/chapters/container.md#コンテナ)環境を提供するサービス。[EC2](#ec2)に[Docker](../../../../development/docker/_/chapters/docker.md#docker)[ソフトウェア](../../../../computer/software/_/chapters/software.md#ソフトウェア)の導入作業や継続したメンテナンス作業などを加えたもので、その管理を[AWS](./aws.md#aws)がサポートしてくれる。

[EC2インスタンス](#ec2)上で実行される[コンテナ](../../../../development/docker/_/chapters/container.md#コンテナ)のことを**Task**と呼び、[EC2インスタンス](#ec2)のことを**Cluster**と呼ぶ。1つのCluster上では複数のTaskを実行することができる。Cluster上で動作するTaskの定義は**Task Definition**で行う。**Service**は1つ以上の同じTaskをまとめたもので、[ELB](./networking_and_content_delivery.md#elb)によって負荷分散をする際には、[EC2](#ec2)の代わりにServiceを指定する。

また、セキュリティ面では、Taskごとに[IAMロール](./security_and_identity.md#iamロール)を割り当てられるという特徴がある。[EC2](#ec2)では[インスタンス](#ec2)単位でしか設定できない。


## Lambda

**AWS Lambda**は、[サーバ](../../../../computer/_/chapters/computer.md#サーバ)をプロビジョニングしなくても[プログラム](../../../../programming/_/chapters/programming.md#プログラム)を実行できるコンピューティングサービスで、サーバレスアーキテクチャの中核を担う。利用者は[ソースコード](../../../../programming/_/chapters/programming.md#ソースコード)だけを用意すればすぐに[プログラム](../../../../programming/_/chapters/programming.md#プログラム)が実行できる。LambdaはNode.jsや[Python](../../../../programming/_/chapters/programming_language.md#python)、[Java](../../../../programming/_/chapters/programming_language.md#java)、Ruby、[C#](../../../../programming/_/chapters/programming_language.md#c-1)、[Go](../../../../programming/_/chapters/programming_language.md#go)、Powershellといった多数の言語に対応している。

Lambdaは**Lambda関数**という単位で、実行する[プログラム](../../../../programming/_/chapters/programming.md#プログラム)とその実行トリガーとなるイベントを事前に定義する。Lambda関数を実行することを、**キック**という。


## Elastic Beanstalk

**Elastic Beanstalk**は、一般的な[アプリケーション](../../../../computer/software/_/chapters/software.md#応用ソフトウェア)のインフラストラクチャに必要な[AWS](./aws.md#aws)機能を自動的に構成して提供するサービス。[アプリケーション](../../../../computer/software/_/chapters/software.md#応用ソフトウェア)の運用に必要な環境の作成からデプロイを容易に行えるため、[ネットワーク](../../../_/chapters/network.md#ネットワーク)やインフラの知識に乏しい開発チームでも利用しやすい。
