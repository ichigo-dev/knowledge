# Gitの基礎知識


## 目次

1. [バージョン管理システム](#バージョン管理システム)
	1. [集中管理方式](#集中管理方式)
	1. [分散管理方式](#分散管理方式)
1. [Git](#git)
	1. [作業の流れ](#作業の流れ)
	1. [ローカルの領域](#ローカルの領域)
1. [基本用語](#基本用語)
	1. [リポジトリ](#リポジトリ)
	1. [コミット](#コミット)
	1. [クローン](#クローン)
	1. [ブランチ](#ブランチ)
	1. [マージ](#マージ)
	1. [プッシュとプル](#プッシュとプル)
1. [Gitホスティングサービス](#gitホスティングサービス)
1. [Gitのインストール](#gitのインストール)
	1. [初期設定](#初期設定)
	1. [CUIとGUI](#cuiとgui)


## バージョン管理システム

**バージョン管理システム**(VCS: Version Control System)はファイルの変更履歴を管理するためのシステム。プログラムのソースコードやドキュメントなどの電子ファイルは普通、段階を経て編集されていく。この編集の過程を履歴として記録しておけば、ファイルの過去の状態を確認したり、ファイルを過去の状態に戻したりすることができる。また、複数人で同じファイルを編集したいような場合には、ファイルの同じ行を変更してしまうことによる競合などの問題が発生する可能性があり、バージョン管理システムはこのような状況を解決する仕組みを持つ。バージョン管理システムはプログラムの開発にとどまらず、電子データを扱うすべてのケースで活用できるツールである。

VCSは複数人でバージョン管理を行う際の方式により集中管理方式と分散管理方式に分類できる。

### 集中管理方式

**集中管理方式**（**集中型**）のバージョン管理システムでは、バージョン管理のための専用サーバにリポジトリを用意して、そのサーバ上で履歴を一元管理する。ユーザはサーバから自身のコンピュータにファイルのコピーをダウンロードし、変更を加えたらその変更をサーバ上のリポジトリに記録する。

ユーザはネットワークに繋がっていない状態だと変更履歴を記録することができない。またサーバが単一障害点となっており、サーバ上のリポジトリが破損するとデータが復旧できない可能性がある、という欠点もある。

集中管理方式のバージョン管理システムとしては、**CVS**や**SVN**が代表的。

### 分散管理方式

**分散管理方式**（**分散型**）のバージョン管理システムでは、全ユーザの変更を集約する中央サーバにリポジトリを設置し、個々の作業用コンピュータにはそのリポジトリの複製（ローカルリポジトリ）を作成する。変更履歴の管理は各々のローカルリポジトリ上で行われ、リモートリポジトリと同期することで変更内容を共有する。

ユーザはネットワークに接続されていなくてもローカルリポジトリ上でほとんどの操作を行うことができる。また、各コンピュータ上に複製されたリポジトリが存在するため、中央サーバのリポジトリが破損した場合の復旧が容易であるという利点がある。

分散管理方式のバージョン管理システムとしては、[Git](#git)や**Mercurial**が代表的。


## Git

**Git**は現在デファクトスタンダードとなっている分散型バージョン管理システム。もともとはLinuxの開発のためにLinus Torvaldsによって開発され、巨大なソースコードであっても変更点の抽出やリポジトリ操作が高速にできるように工夫されている。

### 作業の流れ

Gitを用いたバージョン管理を行う場合には、次のような流れで作業を行う開発スタイルが一般的。

1. 中央サーバにあるリモートリポジトリの複製をローカル環境に作成する
1. ローカル環境にてファイルの修正や追加、削除などを行い、ローカルリポジトリに変更履歴を記録する
1. ローカルリポジトリの変更履歴をリモートリポジトリに反映する
1. 定期的に中央サーバのリポジトリに他者が加えた作業内容をローカルリポジトリに反映し最新の状態にする

### ローカルの領域

Gitによる管理では、ローカル環境に3つの領域があることを意識する必要がある。

**ワーキングディレクトリ**（**ワーキングツリー**）はファイルの編集作業を行うディレクトリ。この領域での変更内容はまだリポジトリには記録されていない状態となる。

**ステージングエリア**（**インデックス**）は変更履歴を作成するための中間領域。コミットに含めたいファイルやディレクトリは一度ステージングエリアに移動する必要がある。

**ローカルリポジトリ**は実際にコミット履歴が記録される領域。


## 基本用語

### リポジトリ

Git（あるいは他のバージョン管理システム）のバージョン管理の対象となるディレクトリのことを**リポジトリ**という。リポジトリ配下に設置されたファイルやディレクトリは変更履歴が記録されるようになる。

Gitを用いて複数人で開発を行う際は、リモートリポジトリとローカルリポジトリを用意する必要がある。**リモートリポジトリ**はインターネットやサーバ上に用意するリポジトリで、開発者間で変更内容を集約したり、開発したプログラムをOSSとして公開するために用いる。**ローカルリポジトリ**は各開発者がリモートリポジトリを複製したもので、実際に作業した内容を記録する。また、個人のみでの利用の場合は必ずしもリモートリポジトリを用意する必要はない。

ローカルリポジトリにはリモートリポジトリを複数紐づけることもできる。ローカルリポジトリをクローンにより作成した場合には、複製元となるリモートリポジトリがデフォルトでは `origin` という名前で登録される。

### コミット

ファイルやディレクトリに対して加えた変更履歴を記録すること、あるいはその変更履歴のことを**コミット**という。リポジトリの変更履歴は**リビジョン**と呼ぶ場合もある。Gitではコミットごとに差分のみを記録するのではなく、毎回すべてのファイルの**スナップショット**（ある時点でのソースコードやファイル、ディレクトリなどの状態を抜き出したもの）を作成しているため、古いリビジョンのファイルでも高速に再現することができる。

コミット時には作業内容を記した**コミットメッセージ**を付与する。コミットメッセージの書き方は開発チームごとに文化やルールなどが存在するが、次のようなフォーマットで記述するのが一般的。

- 1行目にコミットの概要を50文字以内で記述
- 2行目は空行
- 3行目以降にコミットの詳細説明を記述
- コミットメッセージを英語で記述する場合、現在形の文章を使用

また、現在のブランチにおける最新のコミットのことを**HEAD**という。

### クローン

リモートリポジトリの複製をローカルに作成する操作を**クローン**という。基本的にはプロジェクトに加わってから最初に1度だけ実行する操作であり、それ以降のリモートリポジトリからの差分の取得にはフェッチやプルを用いる。

### ブランチ

**ブランチ**はリポジトリのコミット履歴を分岐させる機能、あるいは枝分かれした流れのこと。Gitでは管理の本流となるブランチがデフォルトで `master` となっており（一部のGitホスティングサービスでは `main` が用いられる）、分岐させるブランチ（**トピックブランチ**）には任意の識別子を用いることができる。複数人が各自バグ修正や新機能の開発を並行して行うような場合に、各々がトピックブランチ上で作業を進めることで他の開発者の変更の影響を受けることなく独立した状態を保つことができる。

### マージ

あるブランチの最新の状態を別のブランチに取り込む操作のことを**マージ**という。トピックブランチの変更を本流となるブランチに統合したり、本流の変更点をトピックブランチに取り込んだりする際に用いられる。

### プッシュとプル

ローカルリポジトリのコミット履歴をリモートリポジトリにアップロードする操作を**プッシュ**という。反対に、リモートリポジトリ上のコミット履歴をローカルリポジトリに反映する操作を**プル**という。

プルでは最初に、リモートリポジトリの最新の変更履歴がローカルリポジトリの `origin/master` あるいは `origin/main` ブランチに取り込まれる（**フェッチ**）。これらのブランチを `master` あるいは `main` ブランチにマージすることで、ローカルのワーキングディレクトリを最新の状態としている。


## Gitホスティングサービス

リモートリポジトリを設置するサーバは自前で用意する他に、Gitの環境が整えられたサーバをサービスとして提供している**Gitホスティングサービス**を利用することもできる。またサービスによっては、Gitと連携したIssueやPull Requestといった機能を提供しているものもある。

有名なGitホスティングサービスとしては**GitHub**や**GitLab**、**BitBucket**などがある。

- [GitHub](https://github.co.jp/)
- [GitLab](https://about.gitlab.com/)
- [BitBucket](https://bitbucket.org/)


## Gitのインストール

Gitが既にコンピュータにインストールされているかを確認するには、ターミナルソフトウェア（Macのターミナル、Windowsのコマンドプロンプトなど）を起動し、次のコマンドを実行する。

```sh
$ git --version
git version 2.39.0
```

上の例のようにGitのバージョン情報が表示されればGitは既に使用できる状態となっている。コマンドが存在しない旨のエラーが表示される場合、Gitをインストールする必要がある。

- [Gitのダウンロード](https://git-scm.com/download)

上記サイトより自身の環境のOSにあったインストール手順を実施し、改めて `git --version` を実行してバージョンが表示されることを確認する。

### 初期設定

Gitではファイルに対して誰が変更を加えたかを追跡して記録する。そのため、最初に自身の名前とメールアドレスを設定しておく必要がある。これらはターミナルソフトウェアを開き、次のコマンドを実行すれば設定できる。

```sh
$ git config --global user.name <name>
$ git config --global user.email <email>
```

それぞれ次のコマンドを実行すると、正しく設定できている場合は上のコマンドで設定した名前やメールアドレスが表示される。

```sh
$ git config --global user.name
$ git config --global user.email
```

また、これら以外の全ての設定値については次のコマンドで確認できるので、必要に応じて適宜変更するとよい。

```sh
$ git config --list
```

## CUIとGUI

Gitの機能は全て**CUI**(Character User Interface)から利用でき、ターミナルソフトウェア上でコマンドを通して実行できる。コマンドによる操作が慣れていない場合はGit用の**GUI**(Graphical User Interface)ソフトウェアを導入することもできる。

代表的なGitのGUIクライアントソフトウェアは以下の通り。

- [SourceTree](https://www.sourcetreeapp.com/)
- [Git Fork](https://git-fork.com/)
- [GitKraken](https://www.gitkraken.com/)
