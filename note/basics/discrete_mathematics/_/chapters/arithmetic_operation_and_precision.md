# 『算術演算と精度』ノート

（最終更新： 2023-09-29）


## 目次

1. [シフト演算](#シフト演算)
	1. [論理シフト](#論理シフト)
	1. [算術シフト](#算術シフト)
1. [誤差](#誤差)
	1. [桁落ち](#桁落ち)
	1. [情報落ち](#情報落ち)
	1. [丸め誤差](#丸め誤差)
	1. [打ち切り誤差](#打ち切り誤差)
	1. [オーバフロー](#オーバフロー)
	1. [アンダーフロー](#アンダーフロー)


## シフト演算

**シフト演算**は、ある数の各桁の数値を左あるいは右にずらすことで、その数のべき乗を計算する方法。[n進法](./radix.md#基数)において、桁を左へシフトすると数は元の $n$ 倍に、右へシフトすると数は元の $\frac{1}{n}$ 倍になる。

[2進数](./radix.md#2進数)の[ビット](../../../_/chapters/computer_and_number.md#ビット)列は、左に $k$ [ビット](../../../_/chapters/computer_and_number.md#ビット)シフトすることで元の数の $2^k$ 倍に、右に $k$ [ビット](../../../_/chapters/computer_and_number.md#ビット)シフトすることで元の数の $2^{-k}$ 倍になる。ただし、あらかじめ決められた[ビット](../../../_/chapters/computer_and_number.md#ビット)幅をあふれた[ビット](../../../_/chapters/computer_and_number.md#ビット)は捨てられるため、必ず正しい結果になるとは限らない（[オーバフロー](#オーバフロー)や[アンダーフロー](#アンダーフロー)）。

### 論理シフト

**論理シフト**は、[最上位ビット](../../../_/chapters/computer_and_number.md#msb)を[符号ビット](./numeric_representation.md#符号ビット)として扱わずに[シフト演算](#シフト演算)を行う方法。[符号ビット](./numeric_representation.md#符号ビット)が存在しないため、負の数を扱うことはできない。

**論理右シフト**は、[ビット](../../../_/chapters/computer_and_number.md#ビット)列を右に指定された数だけシフトし、左端には $0$ を埋める演算。

**論理左シフト**は、[ビット](../../../_/chapters/computer_and_number.md#ビット)列を左に指定された数だけシフトし、右端には $0$ を埋める演算。

### 算術シフト

**算術シフト**は、[最上位ビット](../../../_/chapters/computer_and_number.md#msb)を[符号ビット](./numeric_representation.md#符号ビット)として固定して[シフト演算](#シフト演算)を行う方法。

**算術右シフト**は、符号付き[ビット](../../../_/chapters/computer_and_number.md#ビット)列の[符号ビット](./numeric_representation.md#符号ビット)以外の[ビット](../../../_/chapters/computer_and_number.md#ビット)を右に指定された数だけシフトし、左端には[符号ビット](./numeric_representation.md#符号ビット)と同じ値を繰り返して埋める演算。

**算術左シフト**は、符号付き[ビット](../../../_/chapters/computer_and_number.md#ビット)列の[符号ビット](./numeric_representation.md#符号ビット)以外の[ビット](../../../_/chapters/computer_and_number.md#ビット)を左に指定された数だけシフトし、右端には $0$ を埋める演算。


## 誤差

**誤差**は、正確な値と計算結果の差異を指す用語。[コンピュータ](../../../../computer/_/chapters/computer.md#コンピュータ)は有限の桁数でしか数値を扱うことができないので、扱える数の範囲が決まっている。そのため、[コンピュータ](../../../../computer/_/chapters/computer.md#コンピュータ)が内部で扱う値と真の値の間には、誤差を生じる可能性がある。

[浮動小数点数](./numeric_representation.md#浮動小数点数)は表現できる数の精度が限られているため、小数点以下の値が正確に表現できない可能性がある。[10進数](./radix.md#10進数)で表したときに有限小数であっても、[2進数](./radix.md#2進数)に変換すると無限小数となる場合もあるので注意が必要（ $0.01_{10}$ など）。

整数の四則演算や[シフト演算](#シフト演算)においても、[オーバフロー](#オーバフロー)などの誤差が発生する場合がある。

これらの誤差を最小限に抑えるためには、適切なビット数で数を表現したり、演算の順序を変えるといった工夫が必要になる。

### 桁落ち

**桁落ち**は、値がほぼ等しい2つの数値の差を求めたときに、元の数より有効桁数が減ってしまうことで生じる[誤差](#誤差)。次の例では、元の数の有効桁数は10桁であるが、計算後の有効桁数は2桁になっている。

$$
\begin{eqnarray}
0.00123456789_{10} - 0.001234567_{10} & = & 0.00000000089_{10} \
1.23456789_{10} \times 10^{-3} - 1.234567_{10} \times 10^{-3} & = & 8.9_{10} \times 10^{-10}
\end{eqnarray}
$$

[コンピュータ](../../../../computer/_/chapters/computer.md#コンピュータ)が扱う[浮動小数点数](./numeric_representation.md#浮動小数点数)は、[基数部](./numeric_representation.md#浮動小数点数)が[正規化](./numeric_representation.md#浮動小数点数)されるため、数の右側にある $0$ が正しい値であるか[正規化](./numeric_representation.md#浮動小数点数)によって付与された値であるかが保証できない。

### 情報落ち

**情報落ち**は、有効桁数が限られた計算において、絶対値が非常に大きい数と小さい数で加算や減算を行った時に、小さい方の数が計算結果に反映されない[誤差](#誤差)。次の例では、有効桁数が8桁であるとすると、計算結果に小さい方の数の情報が失われている。

$$
\begin{eqnarray}
1234.5678_{10} + 0.0000001_{10} & = & 1234.5678001_{10} \simeq 1234.5678_{10} \
1.2345678_{10} \times 10^3 + 1_{10} \times 10^{-7} & = & 1.2345678001_{10} \times 10^3 \simeq 1.2345678_{10} \times 10^3
\end{eqnarray}
$$

### 丸め誤差

**丸め誤差**は、有効桁数が限られた数値の表現において、切り捨て、切り上げ、四捨五入などを行うことによって、下位の桁が削除されて発生する[誤差](#誤差)。例えば、[10進数](./radix.md#10進数)の $\frac{1}{3}$ は、3桁までの有効桁数で表現すると $0.333_{10}$ となり、本来の値から近似された値となっている。また、 $0.1_{10}$ を10回足し合わせると、[10進数](./radix.md#10進数)では $1_{10}$ となるが、[2進数](./radix.md#2進数)では丸め誤差により $1_{10}$ よりもわずかに小さくなる。

### 打ち切り誤差

**打ち切り誤差**は、有効桁数が限られた計算において、計算結果の小数部を切り捨てることで生じる[誤差](#誤差)。小数点以下の桁数が多い演算においては、打ち切り誤差が顕著になる。

### オーバフロー

**オーバフロー**（**桁あふれ**）は、演算の結果が、決められた桁数の中で表すことができる数値の範囲を超えることで発生する[誤差](#誤差)。例えば、1[バイト](../../../_/chapters/computer_and_number.md#バイト)の符号付き整数データであれば、表現できる範囲は $-128 \sim 127$ であるが、上限である $127$ を超える結果、あるいは下限である $-128$ を下回る結果となるような演算を行うと、オーバフローが発生する。

### アンダーフロー

**アンダーフロー**は、[浮動小数点数](./numeric_representation.md#浮動小数点数)の演算において、演算結果の[指数部](./numeric_representation.md#浮動小数点数)が小さくなりすぎることで数値を表現できなくなるような[誤差](#誤差)。[浮動小数点数](./numeric_representation.md#浮動小数点数)の[指数部](./numeric_representation.md#浮動小数点数)で表現可能な範囲の最小値よりも小さくなった場合に発生する。 $0$ に限りなく近い数値を扱う場合などにアンダーフローが発生することがある。


## 参考文献

- [角谷一成.令和05年 基本情報技術者合格教本.株式会社技術評論社, 2022, 575](https://gihyo.jp/book/2022/978-4-297-13164-7)
- [瀬戸美月.徹底攻略 応用情報技術者教科書 令和4年度.株式会社インプレス, 2021, 814](https://book.impress.co.jp/books/1121101057)
